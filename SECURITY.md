# Безопасность мессенджера AIST

## Что уже учтено

- **Нет `dangerouslySetInnerHTML`** — пользовательский контент (сообщения, имена) выводится как текст, что защищает от XSS.
- **Вложения** — при выборе файла проверяются MIME-тип (image/jpeg, image/png, image/gif, image/webp, video/mp4, video/webm) и размер (лимит 16 МБ).
- **API** — запросы к бэкенду с заголовком `Authorization: Bearer <token>`; бэкенд проверяет JWT и привязывает операции к `userId`.

## Рекомендации

### Токен авторизации

- Сейчас токен хранится в `localStorage`. При уязвимости XSS его можно прочитать.
- Для продакшена предпочтительно: выдавать **httpOnly cookie** с refresh token и короткоживущий access token в памяти; бэкенд читает cookie и не отдаёт токен в теле ответа в открытом виде.

### Бэкенд

- Все маршруты чатов/сообщений защищены middleware `auth` (JWT).
- Проверка членства в чате перед чтением/записью сообщений.
- В продакшене: лимиты на размер тела запроса, rate limiting на запрос кода и отправку сообщений.

### Загрузка файлов

- Сейчас изображения/видео отправляются как base64 в JSON. Для больших файлов лучше загрузка через `multipart/form-data` на отдельный endpoint с проверкой типа и размера на сервере и сохранением в хранилище (S3 и т.п.), а в сообщении хранить только URL.
- На бэкенде проверять MIME-тип по содержимому, не доверять заголовку от клиента.

### Заголовки и инфраструктура

- **HTTPS** обязателен в продакшене.
- Рекомендуется настроить **Content-Security-Policy** (CSP) в Vercel/nginx (ограничение источников скриптов, стилей, подключений).
- CORS на бэкенде настроен; в продакшене лучше указывать конкретный `Access-Control-Allow-Origin` (домен фронта), а не `*` для учётных данных.

### Каналы и чаты

- Метаданные канала (описание, ссылка) хранятся локально и при синхронизации с сервером — в БД. Не подставляйте пользовательский ввод в ссылки без проверки (например, валидация формата URL).
