{"ast":null,"code":"import _objectSpread from\"C:/Users/Vladislav/Documents/GitHub/aist-messenger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";/**\r\n * Хранение чатов и сообщений на устройстве пользователя.\r\n * Чаты хранятся только локально (localStorage). Синхронизация с сервером — отдельный этап.\r\n */const PREFIX='aist_chat_';const LIST_KEY='aist_chat_list';function getChatKey(chatId){return PREFIX+chatId;}export function getChatList(){try{const raw=localStorage.getItem(LIST_KEY);return raw?JSON.parse(raw):[];}catch(_unused){return[];}}export function saveChatList(list){try{localStorage.setItem(LIST_KEY,JSON.stringify(list));}catch(_unused2){}}export function getMessages(chatId){try{const raw=localStorage.getItem(getChatKey(chatId));return raw?JSON.parse(raw):[];}catch(_unused3){return[];}}export function appendMessage(chatId,message){const messages=getMessages(chatId);const next=[...messages,_objectSpread(_objectSpread({},message),{},{id:message.id||\"m_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9))})];try{localStorage.setItem(getChatKey(chatId),JSON.stringify(next));return next;}catch(_unused4){return messages;}}export function addOrUpdateChat(chat){const list=getChatList();const idx=list.findIndex(c=>c.id===chat.id);const next=[...list];if(idx>=0){next[idx]=_objectSpread(_objectSpread(_objectSpread({},next[idx]),chat),{},{updatedAt:Date.now()});}else{next.unshift(_objectSpread(_objectSpread({},chat),{},{updatedAt:Date.now()}));}saveChatList(next);return next;}const CHANNEL_META_PREFIX='aist_channel_meta_';export function getChannelMeta(chatId){try{const raw=localStorage.getItem(CHANNEL_META_PREFIX+chatId);return raw?JSON.parse(raw):{description:'',shareLink:'',admins:[],moderators:[]};}catch(_unused5){return{description:'',shareLink:'',admins:[],moderators:[]};}}export function saveChannelMeta(chatId,meta){try{localStorage.setItem(CHANNEL_META_PREFIX+chatId,JSON.stringify(meta));}catch(_unused6){}}export function createChat(_ref){let{id,name,type='user',avatar,description,shareLink,admins,moderators}=_ref;const chatId=id||\"chat_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));const link=shareLink||(type==='channel'?\"https://aist-messenger.vercel.app/c/\".concat(chatId):'');addOrUpdateChat({id:chatId,name:name||'Чат',type,avatar:avatar||(type==='channel'?'channel':'group'),lastMessage:'',lastTime:null,unread:0});if(type==='channel'){saveChannelMeta(chatId,{description:description||'',shareLink:link,admins:admins||[],moderators:moderators||[]});}return chatId;}","map":{"version":3,"names":["PREFIX","LIST_KEY","getChatKey","chatId","getChatList","raw","localStorage","getItem","JSON","parse","_unused","saveChatList","list","setItem","stringify","_unused2","getMessages","_unused3","appendMessage","message","messages","next","_objectSpread","id","concat","Date","now","Math","random","toString","slice","_unused4","addOrUpdateChat","chat","idx","findIndex","c","updatedAt","unshift","CHANNEL_META_PREFIX","getChannelMeta","description","shareLink","admins","moderators","_unused5","saveChannelMeta","meta","_unused6","createChat","_ref","name","type","avatar","link","lastMessage","lastTime","unread"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/lib/chatStorage.js"],"sourcesContent":["/**\r\n * Хранение чатов и сообщений на устройстве пользователя.\r\n * Чаты хранятся только локально (localStorage). Синхронизация с сервером — отдельный этап.\r\n */\r\n\r\nconst PREFIX = 'aist_chat_';\r\nconst LIST_KEY = 'aist_chat_list';\r\n\r\nfunction getChatKey(chatId) {\r\n  return PREFIX + chatId;\r\n}\r\n\r\nexport function getChatList() {\r\n  try {\r\n    const raw = localStorage.getItem(LIST_KEY);\r\n    return raw ? JSON.parse(raw) : [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function saveChatList(list) {\r\n  try {\r\n    localStorage.setItem(LIST_KEY, JSON.stringify(list));\r\n  } catch {}\r\n}\r\n\r\nexport function getMessages(chatId) {\r\n  try {\r\n    const raw = localStorage.getItem(getChatKey(chatId));\r\n    return raw ? JSON.parse(raw) : [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function appendMessage(chatId, message) {\r\n  const messages = getMessages(chatId);\r\n  const next = [...messages, { ...message, id: message.id || `m_${Date.now()}_${Math.random().toString(36).slice(2, 9)}` }];\r\n  try {\r\n    localStorage.setItem(getChatKey(chatId), JSON.stringify(next));\r\n    return next;\r\n  } catch {\r\n    return messages;\r\n  }\r\n}\r\n\r\nexport function addOrUpdateChat(chat) {\r\n  const list = getChatList();\r\n  const idx = list.findIndex((c) => c.id === chat.id);\r\n  const next = [...list];\r\n  if (idx >= 0) {\r\n    next[idx] = { ...next[idx], ...chat, updatedAt: Date.now() };\r\n  } else {\r\n    next.unshift({ ...chat, updatedAt: Date.now() });\r\n  }\r\n  saveChatList(next);\r\n  return next;\r\n}\r\n\r\nconst CHANNEL_META_PREFIX = 'aist_channel_meta_';\r\n\r\nexport function getChannelMeta(chatId) {\r\n  try {\r\n    const raw = localStorage.getItem(CHANNEL_META_PREFIX + chatId);\r\n    return raw ? JSON.parse(raw) : { description: '', shareLink: '', admins: [], moderators: [] };\r\n  } catch {\r\n    return { description: '', shareLink: '', admins: [], moderators: [] };\r\n  }\r\n}\r\n\r\nexport function saveChannelMeta(chatId, meta) {\r\n  try {\r\n    localStorage.setItem(CHANNEL_META_PREFIX + chatId, JSON.stringify(meta));\r\n  } catch {}\r\n}\r\n\r\nexport function createChat({ id, name, type = 'user', avatar, description, shareLink, admins, moderators }) {\r\n  const chatId = id || `chat_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\r\n  const link = shareLink || (type === 'channel' ? `https://aist-messenger.vercel.app/c/${chatId}` : '');\r\n  addOrUpdateChat({\r\n    id: chatId,\r\n    name: name || 'Чат',\r\n    type,\r\n    avatar: avatar || (type === 'channel' ? 'channel' : 'group'),\r\n    lastMessage: '',\r\n    lastTime: null,\r\n    unread: 0,\r\n  });\r\n  if (type === 'channel') {\r\n    saveChannelMeta(chatId, {\r\n      description: description || '',\r\n      shareLink: link,\r\n      admins: admins || [],\r\n      moderators: moderators || [],\r\n    });\r\n  }\r\n  return chatId;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}