{"ast":null,"code":"var _window$location;/**\r\n * API для синхронизации чатов и сообщений. Один аккаунт (телефон) — одни чаты на всех устройствах.\r\n */const API_BASE=process.env.REACT_APP_API_URL||(typeof window!=='undefined'&&((_window$location=window.location)===null||_window$location===void 0?void 0:_window$location.hostname)==='localhost'?'http://localhost:3001':'https://api.get-aist.ru');/** URL WebSocket для звонков: тот же хост что и API, путь /ws */export function getWsUrl(){if(process.env.REACT_APP_WS_URL)return process.env.REACT_APP_WS_URL;const base=API_BASE.replace(/^https?/,s=>s==='https'?'wss':'ws');return\"\".concat(base.replace(/\\/$/,''),\"/ws\");}function getToken(){try{return localStorage.getItem('aist_token')||null;}catch(_unused){return null;}}async function request(method,path){let body=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;const token=getToken();const opts={method,headers:{'Content-Type':'application/json'}};if(token)opts.headers.Authorization=\"Bearer \".concat(token);if(body!=null)opts.body=JSON.stringify(body);const res=await fetch(\"\".concat(API_BASE).concat(path),opts);let json=null;try{const text=await res.text();if(text)json=JSON.parse(text);}catch(_unused2){}if(!res.ok){const err=new Error(json&&(json.message||json.error)||res.statusText||'Request failed');err.status=res.status;err.payload=json;throw err;}if(res.status===204)return null;return json||{};}/** Список чатов с сервера (по userId из токена). При ошибке или без токена — null. */export async function apiGetChats(){if(!getToken())return null;try{return await request('GET','/api/chats');}catch(_unused3){return null;}}/** Сообщения чата с сервера. При ошибке — null. */export async function apiGetMessages(chatId){if(!getToken()||!chatId)return null;try{const list=await request('GET',\"/api/chats/\".concat(encodeURIComponent(chatId),\"/messages\"));return Array.isArray(list)?list:null;}catch(_unused4){return null;}}/** Отправить сообщение на сервер. Возвращает созданное сообщение или null при ошибке. */export async function apiSendMessage(chatId,_ref){let{text,attachment}=_ref;if(!getToken()||!chatId)return null;try{return await request('POST',\"/api/chats/\".concat(encodeURIComponent(chatId),\"/messages\"),{text:text||'',attachment:attachment||null});}catch(e){if((e===null||e===void 0?void 0:e.status)===404)console.warn('Chat not found on server:',chatId);return null;}}/** Создать чат на сервере. Возвращает чат или null. Для личного чата передайте peerUsername или peerUserId. */export async function apiCreateChat(payload){if(!getToken())return null;try{return await request('POST','/api/chats',{name:payload.name||'Чат',type:payload.type||'user',photo:payload.photo||null,peerUsername:payload.peerUsername||null,peerUserId:payload.peerUserId||null,description:payload.description||null,shareLink:payload.shareLink||null,admins:payload.admins||[],moderators:payload.moderators||[]});}catch(_unused5){return null;}}","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_URL","window","_window$location","location","hostname","getWsUrl","REACT_APP_WS_URL","base","replace","s","concat","getToken","localStorage","getItem","_unused","request","method","path","body","arguments","length","undefined","token","opts","headers","Authorization","JSON","stringify","res","fetch","json","text","parse","_unused2","ok","err","Error","message","error","statusText","status","payload","apiGetChats","_unused3","apiGetMessages","chatId","list","encodeURIComponent","Array","isArray","_unused4","apiSendMessage","_ref","attachment","e","console","warn","apiCreateChat","name","type","photo","peerUsername","peerUserId","description","shareLink","admins","moderators","_unused5"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/lib/api.js"],"sourcesContent":["/**\r\n * API для синхронизации чатов и сообщений. Один аккаунт (телефон) — одни чаты на всех устройствах.\r\n */\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || (typeof window !== 'undefined' && window.location?.hostname === 'localhost' ? 'http://localhost:3001' : 'https://api.get-aist.ru');\r\n\r\n/** URL WebSocket для звонков: тот же хост что и API, путь /ws */\r\nexport function getWsUrl() {\r\n  if (process.env.REACT_APP_WS_URL) return process.env.REACT_APP_WS_URL;\r\n  const base = API_BASE.replace(/^https?/, (s) => (s === 'https' ? 'wss' : 'ws'));\r\n  return `${base.replace(/\\/$/, '')}/ws`;\r\n}\r\n\r\nfunction getToken() {\r\n  try {\r\n    return localStorage.getItem('aist_token') || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function request(method, path, body = null) {\r\n  const token = getToken();\r\n  const opts = {\r\n    method,\r\n    headers: { 'Content-Type': 'application/json' },\r\n  };\r\n  if (token) opts.headers.Authorization = `Bearer ${token}`;\r\n  if (body != null) opts.body = JSON.stringify(body);\r\n  const res = await fetch(`${API_BASE}${path}`, opts);\r\n  let json = null;\r\n  try {\r\n    const text = await res.text();\r\n    if (text) json = JSON.parse(text);\r\n  } catch {}\r\n  if (!res.ok) {\r\n    const err = new Error((json && (json.message || json.error)) || res.statusText || 'Request failed');\r\n    err.status = res.status;\r\n    err.payload = json;\r\n    throw err;\r\n  }\r\n  if (res.status === 204) return null;\r\n  return json || {};\r\n}\r\n\r\n/** Список чатов с сервера (по userId из токена). При ошибке или без токена — null. */\r\nexport async function apiGetChats() {\r\n  if (!getToken()) return null;\r\n  try {\r\n    return await request('GET', '/api/chats');\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Сообщения чата с сервера. При ошибке — null. */\r\nexport async function apiGetMessages(chatId) {\r\n  if (!getToken() || !chatId) return null;\r\n  try {\r\n    const list = await request('GET', `/api/chats/${encodeURIComponent(chatId)}/messages`);\r\n    return Array.isArray(list) ? list : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Отправить сообщение на сервер. Возвращает созданное сообщение или null при ошибке. */\r\nexport async function apiSendMessage(chatId, { text, attachment }) {\r\n  if (!getToken() || !chatId) return null;\r\n  try {\r\n    return await request('POST', `/api/chats/${encodeURIComponent(chatId)}/messages`, { text: text || '', attachment: attachment || null });\r\n  } catch (e) {\r\n    if (e?.status === 404) console.warn('Chat not found on server:', chatId);\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Создать чат на сервере. Возвращает чат или null. Для личного чата передайте peerUsername или peerUserId. */\r\nexport async function apiCreateChat(payload) {\r\n  if (!getToken()) return null;\r\n  try {\r\n    return await request('POST', '/api/chats', {\r\n      name: payload.name || 'Чат',\r\n      type: payload.type || 'user',\r\n      photo: payload.photo || null,\r\n      peerUsername: payload.peerUsername || null,\r\n      peerUserId: payload.peerUserId || null,\r\n      description: payload.description || null,\r\n      shareLink: payload.shareLink || null,\r\n      admins: payload.admins || [],\r\n      moderators: payload.moderators || [],\r\n    });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"mappings":"qBAAA;AACA;AACA,GAEA,KAAM,CAAAA,QAAQ,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,GAAK,MAAO,CAAAC,MAAM,GAAK,WAAW,EAAI,EAAAC,gBAAA,CAAAD,MAAM,CAACE,QAAQ,UAAAD,gBAAA,iBAAfA,gBAAA,CAAiBE,QAAQ,IAAK,WAAW,CAAG,uBAAuB,CAAG,yBAAyB,CAAC,CAEpL,iEACA,MAAO,SAAS,CAAAC,QAAQA,CAAA,CAAG,CACzB,GAAIP,OAAO,CAACC,GAAG,CAACO,gBAAgB,CAAE,MAAO,CAAAR,OAAO,CAACC,GAAG,CAACO,gBAAgB,CACrE,KAAM,CAAAC,IAAI,CAAGV,QAAQ,CAACW,OAAO,CAAC,SAAS,CAAGC,CAAC,EAAMA,CAAC,GAAK,OAAO,CAAG,KAAK,CAAG,IAAK,CAAC,CAC/E,SAAAC,MAAA,CAAUH,IAAI,CAACC,OAAO,CAAC,KAAK,CAAE,EAAE,CAAC,QACnC,CAEA,QAAS,CAAAG,QAAQA,CAAA,CAAG,CAClB,GAAI,CACF,MAAO,CAAAC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,EAAI,IAAI,CACnD,CAAE,MAAAC,OAAA,CAAM,CACN,MAAO,KAAI,CACb,CACF,CAEA,cAAe,CAAAC,OAAOA,CAACC,MAAM,CAAEC,IAAI,CAAe,IAAb,CAAAC,IAAI,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,CAC9C,KAAM,CAAAG,KAAK,CAAGX,QAAQ,CAAC,CAAC,CACxB,KAAM,CAAAY,IAAI,CAAG,CACXP,MAAM,CACNQ,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAChD,CAAC,CACD,GAAIF,KAAK,CAAEC,IAAI,CAACC,OAAO,CAACC,aAAa,WAAAf,MAAA,CAAaY,KAAK,CAAE,CACzD,GAAIJ,IAAI,EAAI,IAAI,CAAEK,IAAI,CAACL,IAAI,CAAGQ,IAAI,CAACC,SAAS,CAACT,IAAI,CAAC,CAClD,KAAM,CAAAU,GAAG,CAAG,KAAM,CAAAC,KAAK,IAAAnB,MAAA,CAAIb,QAAQ,EAAAa,MAAA,CAAGO,IAAI,EAAIM,IAAI,CAAC,CACnD,GAAI,CAAAO,IAAI,CAAG,IAAI,CACf,GAAI,CACF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAAH,GAAG,CAACG,IAAI,CAAC,CAAC,CAC7B,GAAIA,IAAI,CAAED,IAAI,CAAGJ,IAAI,CAACM,KAAK,CAACD,IAAI,CAAC,CACnC,CAAE,MAAAE,QAAA,CAAM,CAAC,CACT,GAAI,CAACL,GAAG,CAACM,EAAE,CAAE,CACX,KAAM,CAAAC,GAAG,CAAG,GAAI,CAAAC,KAAK,CAAEN,IAAI,GAAKA,IAAI,CAACO,OAAO,EAAIP,IAAI,CAACQ,KAAK,CAAC,EAAKV,GAAG,CAACW,UAAU,EAAI,gBAAgB,CAAC,CACnGJ,GAAG,CAACK,MAAM,CAAGZ,GAAG,CAACY,MAAM,CACvBL,GAAG,CAACM,OAAO,CAAGX,IAAI,CAClB,KAAM,CAAAK,GAAG,CACX,CACA,GAAIP,GAAG,CAACY,MAAM,GAAK,GAAG,CAAE,MAAO,KAAI,CACnC,MAAO,CAAAV,IAAI,EAAI,CAAC,CAAC,CACnB,CAEA,sFACA,MAAO,eAAe,CAAAY,WAAWA,CAAA,CAAG,CAClC,GAAI,CAAC/B,QAAQ,CAAC,CAAC,CAAE,MAAO,KAAI,CAC5B,GAAI,CACF,MAAO,MAAM,CAAAI,OAAO,CAAC,KAAK,CAAE,YAAY,CAAC,CAC3C,CAAE,MAAA4B,QAAA,CAAM,CACN,MAAO,KAAI,CACb,CACF,CAEA,mDACA,MAAO,eAAe,CAAAC,cAAcA,CAACC,MAAM,CAAE,CAC3C,GAAI,CAAClC,QAAQ,CAAC,CAAC,EAAI,CAACkC,MAAM,CAAE,MAAO,KAAI,CACvC,GAAI,CACF,KAAM,CAAAC,IAAI,CAAG,KAAM,CAAA/B,OAAO,CAAC,KAAK,eAAAL,MAAA,CAAgBqC,kBAAkB,CAACF,MAAM,CAAC,aAAW,CAAC,CACtF,MAAO,CAAAG,KAAK,CAACC,OAAO,CAACH,IAAI,CAAC,CAAGA,IAAI,CAAG,IAAI,CAC1C,CAAE,MAAAI,QAAA,CAAM,CACN,MAAO,KAAI,CACb,CACF,CAEA,yFACA,MAAO,eAAe,CAAAC,cAAcA,CAACN,MAAM,CAAAO,IAAA,CAAwB,IAAtB,CAAErB,IAAI,CAAEsB,UAAW,CAAC,CAAAD,IAAA,CAC/D,GAAI,CAACzC,QAAQ,CAAC,CAAC,EAAI,CAACkC,MAAM,CAAE,MAAO,KAAI,CACvC,GAAI,CACF,MAAO,MAAM,CAAA9B,OAAO,CAAC,MAAM,eAAAL,MAAA,CAAgBqC,kBAAkB,CAACF,MAAM,CAAC,cAAa,CAAEd,IAAI,CAAEA,IAAI,EAAI,EAAE,CAAEsB,UAAU,CAAEA,UAAU,EAAI,IAAK,CAAC,CAAC,CACzI,CAAE,MAAOC,CAAC,CAAE,CACV,GAAI,CAAAA,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEd,MAAM,IAAK,GAAG,CAAEe,OAAO,CAACC,IAAI,CAAC,2BAA2B,CAAEX,MAAM,CAAC,CACxE,MAAO,KAAI,CACb,CACF,CAEA,+GACA,MAAO,eAAe,CAAAY,aAAaA,CAAChB,OAAO,CAAE,CAC3C,GAAI,CAAC9B,QAAQ,CAAC,CAAC,CAAE,MAAO,KAAI,CAC5B,GAAI,CACF,MAAO,MAAM,CAAAI,OAAO,CAAC,MAAM,CAAE,YAAY,CAAE,CACzC2C,IAAI,CAAEjB,OAAO,CAACiB,IAAI,EAAI,KAAK,CAC3BC,IAAI,CAAElB,OAAO,CAACkB,IAAI,EAAI,MAAM,CAC5BC,KAAK,CAAEnB,OAAO,CAACmB,KAAK,EAAI,IAAI,CAC5BC,YAAY,CAAEpB,OAAO,CAACoB,YAAY,EAAI,IAAI,CAC1CC,UAAU,CAAErB,OAAO,CAACqB,UAAU,EAAI,IAAI,CACtCC,WAAW,CAAEtB,OAAO,CAACsB,WAAW,EAAI,IAAI,CACxCC,SAAS,CAAEvB,OAAO,CAACuB,SAAS,EAAI,IAAI,CACpCC,MAAM,CAAExB,OAAO,CAACwB,MAAM,EAAI,EAAE,CAC5BC,UAAU,CAAEzB,OAAO,CAACyB,UAAU,EAAI,EACpC,CAAC,CAAC,CACJ,CAAE,MAAAC,QAAA,CAAM,CACN,MAAO,KAAI,CACb,CACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}