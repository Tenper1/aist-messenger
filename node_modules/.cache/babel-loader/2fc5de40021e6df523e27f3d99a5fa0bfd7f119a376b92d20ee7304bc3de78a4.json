{"ast":null,"code":"import _objectSpread from\"C:/Users/Vladislav/Documents/GitHub/aist-messenger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useMemo,useState,useEffect}from'react';import{isReservedUsername,normalizeUsernameInput}from'../constants/reservedUsernames';import{jsx as _jsx}from\"react/jsx-runtime\";const STORAGE_KEY_PROFILE='aist_profile';const STORAGE_KEY_PHOTO='aist_profile_photo';const defaultProfile={displayName:'',username:''};function loadProfile(){try{var _parsed$displayName,_parsed$username;const raw=localStorage.getItem(STORAGE_KEY_PROFILE);if(!raw)return _objectSpread({},defaultProfile);const parsed=JSON.parse(raw);return{displayName:(_parsed$displayName=parsed.displayName)!==null&&_parsed$displayName!==void 0?_parsed$displayName:defaultProfile.displayName,username:(_parsed$username=parsed.username)!==null&&_parsed$username!==void 0?_parsed$username:defaultProfile.username};}catch(_unused){return _objectSpread({},defaultProfile);}}function loadPhoto(){try{return localStorage.getItem(STORAGE_KEY_PHOTO)||'';}catch(_unused2){return'';}}function saveProfile(profile){try{localStorage.setItem(STORAGE_KEY_PROFILE,JSON.stringify(profile));}catch(_unused3){}}function savePhoto(dataUrl){try{if(dataUrl)localStorage.setItem(STORAGE_KEY_PHOTO,dataUrl);else localStorage.removeItem(STORAGE_KEY_PHOTO);}catch(_unused4){}}const UserContext=/*#__PURE__*/createContext(null);export function UserProvider(_ref){let{children}=_ref;const[profile,setProfileState]=useState(loadProfile);const[profilePhoto,setProfilePhotoState]=useState(loadPhoto);useEffect(()=>{saveProfile(profile);},[profile]);useEffect(()=>{savePhoto(profilePhoto);},[profilePhoto]);const setProfile=next=>{setProfileState(prev=>typeof next==='function'?next(prev):_objectSpread(_objectSpread({},prev),next));};const setProfilePhoto=dataUrl=>{setProfilePhotoState(dataUrl||'');savePhoto(dataUrl||'');};const setDisplayName=name=>setProfile({displayName:String(name!==null&&name!==void 0?name:'').trim().slice(0,64)});const setUsername=value=>{const normalized=normalizeUsernameInput(value);setProfile({username:normalized});};const usernameError=useMemo(()=>{const u=profile.username;if(!u)return null;if(u.length<2)return'Никнейм не менее 2 символов';if(isReservedUsername(u))return'Это имя зарезервировано';return null;},[profile.username]);const value=useMemo(()=>({profile,setProfile,setDisplayName,setUsername,setProfilePhoto,usernameError,displayName:profile.displayName,username:profile.username,usernameFormatted:profile.username?\"@\".concat(profile.username):'',profilePhoto}),[profile,profilePhoto,usernameError]);return/*#__PURE__*/_jsx(UserContext.Provider,{value:value,children:children});}export function useUser(){const ctx=useContext(UserContext);if(!ctx)throw new Error('useUser must be used within UserProvider');return ctx;}","map":{"version":3,"names":["React","createContext","useContext","useMemo","useState","useEffect","isReservedUsername","normalizeUsernameInput","jsx","_jsx","STORAGE_KEY_PROFILE","STORAGE_KEY_PHOTO","defaultProfile","displayName","username","loadProfile","_parsed$displayName","_parsed$username","raw","localStorage","getItem","_objectSpread","parsed","JSON","parse","_unused","loadPhoto","_unused2","saveProfile","profile","setItem","stringify","_unused3","savePhoto","dataUrl","removeItem","_unused4","UserContext","UserProvider","_ref","children","setProfileState","profilePhoto","setProfilePhotoState","setProfile","next","prev","setProfilePhoto","setDisplayName","name","String","trim","slice","setUsername","value","normalized","usernameError","u","length","usernameFormatted","concat","Provider","useUser","ctx","Error"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/context/UserContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useMemo, useState, useEffect } from 'react';\r\nimport { isReservedUsername, normalizeUsernameInput } from '../constants/reservedUsernames';\r\n\r\nconst STORAGE_KEY_PROFILE = 'aist_profile';\r\nconst STORAGE_KEY_PHOTO = 'aist_profile_photo';\r\n\r\nconst defaultProfile = {\r\n  displayName: '',\r\n  username: '',\r\n};\r\n\r\nfunction loadProfile() {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY_PROFILE);\r\n    if (!raw) return { ...defaultProfile };\r\n    const parsed = JSON.parse(raw);\r\n    return {\r\n      displayName: parsed.displayName ?? defaultProfile.displayName,\r\n      username: parsed.username ?? defaultProfile.username,\r\n    };\r\n  } catch {\r\n    return { ...defaultProfile };\r\n  }\r\n}\r\n\r\nfunction loadPhoto() {\r\n  try {\r\n    return localStorage.getItem(STORAGE_KEY_PHOTO) || '';\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n\r\nfunction saveProfile(profile) {\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile));\r\n  } catch {}\r\n}\r\n\r\nfunction savePhoto(dataUrl) {\r\n  try {\r\n    if (dataUrl) localStorage.setItem(STORAGE_KEY_PHOTO, dataUrl);\r\n    else localStorage.removeItem(STORAGE_KEY_PHOTO);\r\n  } catch {}\r\n}\r\n\r\nconst UserContext = createContext(null);\r\n\r\nexport function UserProvider({ children }) {\r\n  const [profile, setProfileState] = useState(loadProfile);\r\n  const [profilePhoto, setProfilePhotoState] = useState(loadPhoto);\r\n\r\n  useEffect(() => {\r\n    saveProfile(profile);\r\n  }, [profile]);\r\n  useEffect(() => {\r\n    savePhoto(profilePhoto);\r\n  }, [profilePhoto]);\r\n\r\n  const setProfile = (next) => {\r\n    setProfileState((prev) => (typeof next === 'function' ? next(prev) : { ...prev, ...next }));\r\n  };\r\n  const setProfilePhoto = (dataUrl) => {\r\n    setProfilePhotoState(dataUrl || '');\r\n    savePhoto(dataUrl || '');\r\n  };\r\n\r\n  const setDisplayName = (name) => setProfile({ displayName: String(name ?? '').trim().slice(0, 64) });\r\n  const setUsername = (value) => {\r\n    const normalized = normalizeUsernameInput(value);\r\n    setProfile({ username: normalized });\r\n  };\r\n\r\n  const usernameError = useMemo(() => {\r\n    const u = profile.username;\r\n    if (!u) return null;\r\n    if (u.length < 2) return 'Никнейм не менее 2 символов';\r\n    if (isReservedUsername(u)) return 'Это имя зарезервировано';\r\n    return null;\r\n  }, [profile.username]);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      profile,\r\n      setProfile,\r\n      setDisplayName,\r\n      setUsername,\r\n      setProfilePhoto,\r\n      usernameError,\r\n      displayName: profile.displayName,\r\n      username: profile.username,\r\n      usernameFormatted: profile.username ? `@${profile.username}` : '',\r\n      profilePhoto,\r\n    }),\r\n    [profile, profilePhoto, usernameError]\r\n  );\r\n\r\n  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;\r\n}\r\n\r\nexport function useUser() {\r\n  const ctx = useContext(UserContext);\r\n  if (!ctx) throw new Error('useUser must be used within UserProvider');\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}