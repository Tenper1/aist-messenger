{"ast":null,"code":"var _window$location;/**\r\n * API для синхронизации чатов и сообщений. Один аккаунт (телефон) — одни чаты на всех устройствах.\r\n */const API_BASE=process.env.REACT_APP_API_URL||(typeof window!=='undefined'&&((_window$location=window.location)===null||_window$location===void 0?void 0:_window$location.hostname)==='localhost'?'http://localhost:3001':'https://api.get-aist.ru');/** URL WebSocket для звонков: тот же хост что и API, путь /ws */export function getWsUrl(){if(process.env.REACT_APP_WS_URL)return process.env.REACT_APP_WS_URL;const base=API_BASE.replace(/^https?/,s=>s==='https'?'wss':'ws');return\"\".concat(base.replace(/\\/$/,''),\"/ws\");}function getToken(){try{return localStorage.getItem('aist_token')||null;}catch(_unused){return null;}}async function request(method,path){let body=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;const token=getToken();const opts={method,headers:{'Content-Type':'application/json'}};if(token)opts.headers.Authorization=\"Bearer \".concat(token);if(body!=null)opts.body=JSON.stringify(body);const res=await fetch(\"\".concat(API_BASE).concat(path),opts);if(!res.ok){const err=new Error(res.statusText||'Request failed');err.status=res.status;throw err;}if(res.status===204)return null;return res.json();}/** Список чатов с сервера (по userId из токена). При ошибке или без токена — null. */export async function apiGetChats(){if(!getToken())return null;try{return await request('GET','/api/chats');}catch(_unused2){return null;}}/** Сообщения чата с сервера. При ошибке — null. */export async function apiGetMessages(chatId){if(!getToken()||!chatId)return null;try{const list=await request('GET',\"/api/chats/\".concat(encodeURIComponent(chatId),\"/messages\"));return Array.isArray(list)?list:null;}catch(_unused3){return null;}}/** Отправить сообщение на сервер. Возвращает созданное сообщение или null. */export async function apiSendMessage(chatId,_ref){let{text,attachment}=_ref;if(!getToken()||!chatId)return null;try{return await request('POST',\"/api/chats/\".concat(encodeURIComponent(chatId),\"/messages\"),{text:text||'',attachment:attachment||null});}catch(_unused4){return null;}}/** Создать чат на сервере. Возвращает чат или null. */export async function apiCreateChat(payload){if(!getToken())return null;try{return await request('POST','/api/chats',{name:payload.name||'Чат',type:payload.type||'user',photo:payload.photo||null,description:payload.description||null,shareLink:payload.shareLink||null,admins:payload.admins||[],moderators:payload.moderators||[]});}catch(_unused5){return null;}}","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_URL","window","_window$location","location","hostname","getWsUrl","REACT_APP_WS_URL","base","replace","s","concat","getToken","localStorage","getItem","_unused","request","method","path","body","arguments","length","undefined","token","opts","headers","Authorization","JSON","stringify","res","fetch","ok","err","Error","statusText","status","json","apiGetChats","_unused2","apiGetMessages","chatId","list","encodeURIComponent","Array","isArray","_unused3","apiSendMessage","_ref","text","attachment","_unused4","apiCreateChat","payload","name","type","photo","description","shareLink","admins","moderators","_unused5"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/lib/api.js"],"sourcesContent":["/**\r\n * API для синхронизации чатов и сообщений. Один аккаунт (телефон) — одни чаты на всех устройствах.\r\n */\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || (typeof window !== 'undefined' && window.location?.hostname === 'localhost' ? 'http://localhost:3001' : 'https://api.get-aist.ru');\r\n\r\n/** URL WebSocket для звонков: тот же хост что и API, путь /ws */\r\nexport function getWsUrl() {\r\n  if (process.env.REACT_APP_WS_URL) return process.env.REACT_APP_WS_URL;\r\n  const base = API_BASE.replace(/^https?/, (s) => (s === 'https' ? 'wss' : 'ws'));\r\n  return `${base.replace(/\\/$/, '')}/ws`;\r\n}\r\n\r\nfunction getToken() {\r\n  try {\r\n    return localStorage.getItem('aist_token') || null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nasync function request(method, path, body = null) {\r\n  const token = getToken();\r\n  const opts = {\r\n    method,\r\n    headers: { 'Content-Type': 'application/json' },\r\n  };\r\n  if (token) opts.headers.Authorization = `Bearer ${token}`;\r\n  if (body != null) opts.body = JSON.stringify(body);\r\n  const res = await fetch(`${API_BASE}${path}`, opts);\r\n  if (!res.ok) {\r\n    const err = new Error(res.statusText || 'Request failed');\r\n    err.status = res.status;\r\n    throw err;\r\n  }\r\n  if (res.status === 204) return null;\r\n  return res.json();\r\n}\r\n\r\n/** Список чатов с сервера (по userId из токена). При ошибке или без токена — null. */\r\nexport async function apiGetChats() {\r\n  if (!getToken()) return null;\r\n  try {\r\n    return await request('GET', '/api/chats');\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Сообщения чата с сервера. При ошибке — null. */\r\nexport async function apiGetMessages(chatId) {\r\n  if (!getToken() || !chatId) return null;\r\n  try {\r\n    const list = await request('GET', `/api/chats/${encodeURIComponent(chatId)}/messages`);\r\n    return Array.isArray(list) ? list : null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Отправить сообщение на сервер. Возвращает созданное сообщение или null. */\r\nexport async function apiSendMessage(chatId, { text, attachment }) {\r\n  if (!getToken() || !chatId) return null;\r\n  try {\r\n    return await request('POST', `/api/chats/${encodeURIComponent(chatId)}/messages`, { text: text || '', attachment: attachment || null });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Создать чат на сервере. Возвращает чат или null. */\r\nexport async function apiCreateChat(payload) {\r\n  if (!getToken()) return null;\r\n  try {\r\n    return await request('POST', '/api/chats', {\r\n      name: payload.name || 'Чат',\r\n      type: payload.type || 'user',\r\n      photo: payload.photo || null,\r\n      description: payload.description || null,\r\n      shareLink: payload.shareLink || null,\r\n      admins: payload.admins || [],\r\n      moderators: payload.moderators || [],\r\n    });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}