{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Vladislav\\\\Documents\\\\GitHub\\\\aist-messenger\\\\src\\\\components\\\\CallScreen.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useTheme } from '../context/ThemeContext';\nimport { useCall } from '../context/CallContext';\nimport { getWsUrl } from '../lib/api';\nimport { IconBack, IconMic, IconMicOff, IconSpeaker, IconKeypad } from './Icons';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function CallScreen({\n  peerName,\n  isVideo,\n  onEnd,\n  peerUserId,\n  isIncoming = false,\n  remoteOffer = null\n}) {\n  _s();\n  var _callCtx$wsReady;\n  const {\n    theme\n  } = useTheme();\n  const callCtx = useCall();\n  const [localStream, setLocalStream] = useState(null);\n  const [remoteStream, setRemoteStream] = useState(null);\n  const [muted, setMuted] = useState(false);\n  const [speaker, setSpeaker] = useState(false);\n  const [showKeypad, setShowKeypad] = useState(false);\n  const [error, setError] = useState(null);\n  const [status, setStatus] = useState(isIncoming ? 'connecting' : 'calling');\n  const [wsOpen, setWsOpen] = useState(false);\n  const localRef = useRef(null);\n  const remoteRef = useRef(null);\n  const pcRef = useRef(null);\n  const wsRef = useRef(null);\n  const offerSentRef = useRef(false);\n  const useSharedWs = isIncoming && !!callCtx;\n  const useCtxForOutgoing = !isIncoming && !!(callCtx !== null && callCtx !== void 0 && callCtx.wsReady) && !!(callCtx !== null && callCtx !== void 0 && callCtx.send);\n  const effectiveWsOpen = useSharedWs || useCtxForOutgoing ? (_callCtx$wsReady = callCtx === null || callCtx === void 0 ? void 0 : callCtx.wsReady) !== null && _callCtx$wsReady !== void 0 ? _callCtx$wsReady : false : wsOpen;\n  useEffect(() => {\n    const wantVideo = !!isVideo;\n    let stream = null;\n    navigator.mediaDevices.getUserMedia({\n      video: wantVideo,\n      audio: true\n    }).then(s => {\n      stream = s;\n      setLocalStream(s);\n      if (muted) s.getAudioTracks().forEach(t => t.enabled = false);\n    }).catch(e => setError('Нет доступа к камере или микрофону'));\n    return () => {\n      if (stream) stream.getTracks().forEach(t => t.stop());\n    };\n  }, [isVideo]);\n  useEffect(() => {\n    if (!localRef.current || !localStream) return;\n    localRef.current.srcObject = localStream;\n  }, [localStream]);\n  useEffect(() => {\n    if (!remoteRef.current || !remoteStream) return;\n    remoteRef.current.srcObject = remoteStream;\n  }, [remoteStream]);\n  useEffect(() => {\n    if (remoteRef.current) remoteRef.current.volume = speaker ? 1 : 0.6;\n  }, [speaker, remoteStream]);\n  useEffect(() => {\n    if (muted && localStream) localStream.getAudioTracks().forEach(t => t.enabled = false);\n    if (!muted && localStream) localStream.getAudioTracks().forEach(t => t.enabled = true);\n  }, [muted, localStream]);\n  const wsUrl = getWsUrl();\n  const token = typeof localStorage !== 'undefined' ? localStorage.getItem('aist_token') : null;\n  useEffect(() => {\n    if (useSharedWs || useCtxForOutgoing) return;\n    if (!peerUserId || !wsUrl || !token) return;\n    setWsOpen(false);\n    const base = wsUrl.startsWith('ws') ? wsUrl : wsUrl.replace(/^https?/, s => s === 'https' ? 'wss' : 'ws');\n    const url = `${base}?token=${encodeURIComponent(token)}`;\n    let ws = null;\n    try {\n      ws = new WebSocket(url);\n      wsRef.current = ws;\n      ws.onopen = () => setWsOpen(true);\n      ws.onmessage = ev => {\n        try {\n          var _msg$payload, _msg$payload4;\n          const msg = JSON.parse(ev.data);\n          if (msg.event === 'call:answer' && ((_msg$payload = msg.payload) !== null && _msg$payload !== void 0 && _msg$payload.sdp || msg.payload)) {\n            var _msg$payload2, _msg$payload3;\n            setStatus('connected');\n            const desc = (_msg$payload2 = msg.payload) !== null && _msg$payload2 !== void 0 && _msg$payload2.type ? msg.payload : {\n              type: 'answer',\n              sdp: ((_msg$payload3 = msg.payload) === null || _msg$payload3 === void 0 ? void 0 : _msg$payload3.sdp) || msg.payload\n            };\n            if (pcRef.current) pcRef.current.setRemoteDescription(new RTCSessionDescription(desc)).catch(() => {});\n          }\n          if (msg.event === 'call:ice' && (_msg$payload4 = msg.payload) !== null && _msg$payload4 !== void 0 && _msg$payload4.candidate) {\n            if (pcRef.current) pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\n          }\n          if (msg.event === 'call:hangup') onEnd();\n        } catch {}\n      };\n      ws.onerror = () => setError('Ошибка соединения');\n      ws.onclose = () => setWsOpen(false);\n    } catch (e) {\n      setError('WebSocket недоступен');\n    }\n    return () => {\n      if (pcRef.current) {\n        pcRef.current.close();\n        pcRef.current = null;\n      }\n      if (ws && ws.readyState === WebSocket.OPEN) ws.close();\n      wsRef.current = null;\n      setWsOpen(false);\n      offerSentRef.current = false;\n    };\n  }, [useSharedWs, useCtxForOutgoing, peerUserId, wsUrl, token, onEnd]);\n  useEffect(() => {\n    if (useSharedWs && callCtx && isIncoming && remoteOffer && localStream) {\n      callCtx.setMessageReceiver(msg => {\n        var _msg$payload5;\n        if (msg.event === 'call:ice' && (_msg$payload5 = msg.payload) !== null && _msg$payload5 !== void 0 && _msg$payload5.candidate && pcRef.current) {\n          pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\n        }\n        if (msg.event === 'call:hangup') onEnd();\n      });\n      return () => callCtx.setMessageReceiver(null);\n    }\n  }, [useSharedWs, isIncoming, remoteOffer, localStream, callCtx, onEnd]);\n  useEffect(() => {\n    if (!localStream || !peerUserId) return;\n    if (isIncoming && remoteOffer && callCtx !== null && callCtx !== void 0 && callCtx.wsReady && callCtx.send) {\n      const pc = new RTCPeerConnection({\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      });\n      pcRef.current = pc;\n      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));\n      pc.ontrack = e => setRemoteStream(e.streams[0] || e.stream);\n      pc.onicecandidate = e => {\n        if (e.candidate && callCtx !== null && callCtx !== void 0 && callCtx.send) callCtx.send('call:ice', {\n          candidate: e.candidate\n        });\n      };\n      pc.setRemoteDescription(new RTCSessionDescription(remoteOffer)).then(() => pc.createAnswer()).then(answer => pc.setLocalDescription(answer).then(() => answer)).then(answer => {\n        callCtx.send('call:answer', {\n          sdp: answer\n        });\n        setStatus('connected');\n      }).catch(() => setError('Ошибка соединения'));\n      return () => {\n        pc.close();\n        pcRef.current = null;\n      };\n    }\n    const sendOffer = offer => {\n      var _wsRef$current;\n      if (useCtxForOutgoing && callCtx !== null && callCtx !== void 0 && callCtx.send) {\n        callCtx.send('call:offer', {\n          userId: peerUserId,\n          targetUserId: peerUserId,\n          sdp: offer,\n          isVideo: !!isVideo\n        });\n        offerSentRef.current = true;\n      } else if (((_wsRef$current = wsRef.current) === null || _wsRef$current === void 0 ? void 0 : _wsRef$current.readyState) === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          event: 'call:offer',\n          payload: {\n            userId: peerUserId,\n            targetUserId: peerUserId,\n            sdp: offer,\n            isVideo: !!isVideo\n          }\n        }));\n        offerSentRef.current = true;\n      }\n    };\n    if (!isIncoming && effectiveWsOpen && !offerSentRef.current && (wsRef.current || useCtxForOutgoing)) {\n      if (useCtxForOutgoing) {\n        callCtx.setMessageReceiver(msg => {\n          var _msg$payload6, _msg$payload9;\n          if (msg.event === 'call:answer' && ((_msg$payload6 = msg.payload) !== null && _msg$payload6 !== void 0 && _msg$payload6.sdp || msg.payload)) {\n            var _msg$payload7, _msg$payload8;\n            setStatus('connected');\n            const desc = (_msg$payload7 = msg.payload) !== null && _msg$payload7 !== void 0 && _msg$payload7.type ? msg.payload : {\n              type: 'answer',\n              sdp: ((_msg$payload8 = msg.payload) === null || _msg$payload8 === void 0 ? void 0 : _msg$payload8.sdp) || msg.payload\n            };\n            if (pcRef.current) pcRef.current.setRemoteDescription(new RTCSessionDescription(desc)).catch(() => {});\n          }\n          if (msg.event === 'call:ice' && (_msg$payload9 = msg.payload) !== null && _msg$payload9 !== void 0 && _msg$payload9.candidate && pcRef.current) {\n            pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\n          }\n          if (msg.event === 'call:hangup') onEnd();\n        });\n      }\n      const pc = new RTCPeerConnection({\n        iceServers: [{\n          urls: 'stun:stun.l.google.com:19302'\n        }]\n      });\n      pcRef.current = pc;\n      localStream.getTracks().forEach(track => pc.addTrack(track, localStream));\n      pc.ontrack = e => setRemoteStream(e.streams[0] || e.stream);\n      pc.onicecandidate = e => {\n        var _wsRef$current2;\n        if (e.candidate && useCtxForOutgoing && callCtx !== null && callCtx !== void 0 && callCtx.send) callCtx.send('call:ice', {\n          candidate: e.candidate\n        });else if (e.candidate && ((_wsRef$current2 = wsRef.current) === null || _wsRef$current2 === void 0 ? void 0 : _wsRef$current2.readyState) === WebSocket.OPEN) wsRef.current.send(JSON.stringify({\n          event: 'call:ice',\n          payload: {\n            candidate: e.candidate\n          }\n        }));\n      };\n      pc.createOffer().then(offer => pc.setLocalDescription(offer).then(() => offer)).then(sendOffer).catch(() => setError('Ошибка создания предложения'));\n      return () => {\n        if (useCtxForOutgoing) callCtx.setMessageReceiver(null);\n        if (pcRef.current === pc) {\n          pc.close();\n          pcRef.current = null;\n        }\n        offerSentRef.current = false;\n      };\n    }\n  }, [localStream, effectiveWsOpen, wsOpen, peerUserId, isIncoming, remoteOffer, callCtx, isVideo, useCtxForOutgoing, onEnd]);\n  const controlBtn = (Icon, active, onClick, label) => /*#__PURE__*/_jsxDEV(\"button\", {\n    type: \"button\",\n    onClick: onClick,\n    style: {\n      width: 56,\n      height: 56,\n      borderRadius: '50%',\n      border: 'none',\n      background: active ? theme.accent : theme.sidebarBg || 'rgba(255,255,255,.12)',\n      color: active ? theme.accentText : theme.text,\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      cursor: 'pointer'\n    },\n    title: label,\n    \"aria-label\": label,\n    children: /*#__PURE__*/_jsxDEV(Icon, {\n      width: 24,\n      height: 24\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 196,\n    columnNumber: 5\n  }, this);\n  const styles = {\n    overlay: {\n      position: 'fixed',\n      inset: 0,\n      background: theme.isDark ? '#0c0c0e' : '#f5f5f7',\n      zIndex: 1000,\n      display: 'flex',\n      flexDirection: 'column',\n      color: theme.text\n    },\n    header: {\n      padding: '12px 16px',\n      display: 'flex',\n      alignItems: 'center',\n      gap: 12,\n      borderBottom: `1px solid ${theme.border}`,\n      background: theme.headerBg\n    },\n    center: {\n      flex: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 24\n    },\n    avatar: {\n      width: 88,\n      height: 88,\n      borderRadius: '50%',\n      background: theme.accent,\n      color: theme.accentText,\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      fontSize: 36,\n      fontWeight: 600,\n      marginBottom: 16\n    },\n    name: {\n      fontSize: 22,\n      fontWeight: 600,\n      marginBottom: 4\n    },\n    statusText: {\n      fontSize: 15,\n      color: theme.textMuted\n    },\n    remoteVideo: {\n      position: 'absolute',\n      inset: 0,\n      width: '100%',\n      height: '100%',\n      objectFit: 'cover'\n    },\n    localVideo: {\n      position: 'absolute',\n      bottom: 100,\n      right: 16,\n      width: 100,\n      height: 140,\n      borderRadius: 12,\n      objectFit: 'cover',\n      border: `2px solid ${theme.border}`\n    },\n    controls: {\n      padding: '24px 16px 32px',\n      paddingBottom: 'max(32px, env(safe-area-inset-bottom))',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      gap: 28\n    },\n    endBtn: {\n      width: 64,\n      height: 64,\n      borderRadius: '50%',\n      border: 'none',\n      background: '#e53935',\n      color: '#fff',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      cursor: 'pointer'\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: styles.overlay,\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      style: styles.header,\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        style: {\n          border: 'none',\n          background: 'transparent',\n          color: theme.accent,\n          padding: 8\n        },\n        onClick: onEnd,\n        \"aria-label\": \"\\u041D\\u0430\\u0437\\u0430\\u0434\",\n        children: /*#__PURE__*/_jsxDEV(IconBack, {\n          width: 24,\n          height: 24\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          flex: 1,\n          fontSize: 17,\n          fontWeight: 600\n        },\n        children: [isVideo ? 'Видеозвонок' : 'Голосовой звонок', \" \\u2014 \", peerName]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        flex: 1,\n        position: 'relative'\n      },\n      children: [error && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          padding: 16,\n          textAlign: 'center',\n          color: '#e53935'\n        },\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 11\n      }, this), !error && isVideo && localStream && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [remoteStream && /*#__PURE__*/_jsxDEV(\"video\", {\n          ref: remoteRef,\n          autoPlay: true,\n          playsInline: true,\n          style: styles.remoteVideo\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 315,\n          columnNumber: 30\n        }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localRef,\n          autoPlay: true,\n          muted: true,\n          playsInline: true,\n          style: styles.localVideo\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true), !error && (!isVideo || !localStream) && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: styles.center,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.avatar,\n          children: peerName ? peerName[0].toUpperCase() : '?'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.name,\n          children: peerName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.statusText,\n          children: status === 'connected' ? 'Разговор' : isIncoming ? 'Подключение...' : 'Вызов...'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: styles.controls,\n      children: [controlBtn(muted ? IconMicOff : IconMic, muted, () => setMuted(!muted), muted ? 'Включить микрофон' : 'Выключить микрофон'), controlBtn(IconSpeaker, speaker, () => setSpeaker(!speaker), speaker ? 'Телефон' : 'Громкая связь'), controlBtn(IconKeypad, showKeypad, () => setShowKeypad(!showKeypad), 'Клавиатура'), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        style: styles.endBtn,\n        onClick: () => {\n          if (useSharedWs && callCtx) callCtx.send('call:hangup');\n          onEnd();\n        },\n        title: \"\\u0417\\u0430\\u0432\\u0435\\u0440\\u0448\\u0438\\u0442\\u044C\",\n        \"aria-label\": \"\\u0417\\u0430\\u0432\\u0435\\u0440\\u0448\\u0438\\u0442\\u044C \\u0437\\u0432\\u043E\\u043D\\u043E\\u043A\",\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          style: {\n            fontSize: 28,\n            lineHeight: 1,\n            color: '#fff'\n          },\n          children: \"\\u2715\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 299,\n    columnNumber: 5\n  }, this);\n}\n_s(CallScreen, \"z+DprtOMXldtNsx6AqG6RF2kmdA=\", false, function () {\n  return [useTheme, useCall];\n});\n_c = CallScreen;\nvar _c;\n$RefreshReg$(_c, \"CallScreen\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useTheme","useCall","getWsUrl","IconBack","IconMic","IconMicOff","IconSpeaker","IconKeypad","jsxDEV","_jsxDEV","Fragment","_Fragment","CallScreen","peerName","isVideo","onEnd","peerUserId","isIncoming","remoteOffer","_s","_callCtx$wsReady","theme","callCtx","localStream","setLocalStream","remoteStream","setRemoteStream","muted","setMuted","speaker","setSpeaker","showKeypad","setShowKeypad","error","setError","status","setStatus","wsOpen","setWsOpen","localRef","remoteRef","pcRef","wsRef","offerSentRef","useSharedWs","useCtxForOutgoing","wsReady","send","effectiveWsOpen","wantVideo","stream","navigator","mediaDevices","getUserMedia","video","audio","then","s","getAudioTracks","forEach","t","enabled","catch","e","getTracks","stop","current","srcObject","volume","wsUrl","token","localStorage","getItem","base","startsWith","replace","url","encodeURIComponent","ws","WebSocket","onopen","onmessage","ev","_msg$payload","_msg$payload4","msg","JSON","parse","data","event","payload","sdp","_msg$payload2","_msg$payload3","desc","type","setRemoteDescription","RTCSessionDescription","candidate","addIceCandidate","RTCIceCandidate","onerror","onclose","close","readyState","OPEN","setMessageReceiver","_msg$payload5","pc","RTCPeerConnection","iceServers","urls","track","addTrack","ontrack","streams","onicecandidate","createAnswer","answer","setLocalDescription","sendOffer","offer","_wsRef$current","userId","targetUserId","stringify","_msg$payload6","_msg$payload9","_msg$payload7","_msg$payload8","_wsRef$current2","createOffer","controlBtn","Icon","active","onClick","label","style","width","height","borderRadius","border","background","accent","sidebarBg","color","accentText","text","display","alignItems","justifyContent","cursor","title","children","fileName","_jsxFileName","lineNumber","columnNumber","styles","overlay","position","inset","isDark","zIndex","flexDirection","header","padding","gap","borderBottom","headerBg","center","flex","avatar","fontSize","fontWeight","marginBottom","name","statusText","textMuted","remoteVideo","objectFit","localVideo","bottom","right","controls","paddingBottom","endBtn","textAlign","ref","autoPlay","playsInline","toUpperCase","lineHeight","_c","$RefreshReg$"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/components/CallScreen.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useTheme } from '../context/ThemeContext';\r\nimport { useCall } from '../context/CallContext';\r\nimport { getWsUrl } from '../lib/api';\r\nimport { IconBack, IconMic, IconMicOff, IconSpeaker, IconKeypad } from './Icons';\r\n\r\nexport default function CallScreen({\r\n  peerName,\r\n  isVideo,\r\n  onEnd,\r\n  peerUserId,\r\n  isIncoming = false,\r\n  remoteOffer = null,\r\n}) {\r\n  const { theme } = useTheme();\r\n  const callCtx = useCall();\r\n  const [localStream, setLocalStream] = useState(null);\r\n  const [remoteStream, setRemoteStream] = useState(null);\r\n  const [muted, setMuted] = useState(false);\r\n  const [speaker, setSpeaker] = useState(false);\r\n  const [showKeypad, setShowKeypad] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [status, setStatus] = useState(isIncoming ? 'connecting' : 'calling');\r\n  const [wsOpen, setWsOpen] = useState(false);\r\n  const localRef = useRef(null);\r\n  const remoteRef = useRef(null);\r\n  const pcRef = useRef(null);\r\n  const wsRef = useRef(null);\r\n  const offerSentRef = useRef(false);\r\n  const useSharedWs = isIncoming && !!callCtx;\r\n  const useCtxForOutgoing = !isIncoming && !!callCtx?.wsReady && !!callCtx?.send;\r\n  const effectiveWsOpen = useSharedWs || useCtxForOutgoing ? (callCtx?.wsReady ?? false) : wsOpen;\r\n\r\n  useEffect(() => {\r\n    const wantVideo = !!isVideo;\r\n    let stream = null;\r\n    navigator.mediaDevices\r\n      .getUserMedia({ video: wantVideo, audio: true })\r\n      .then((s) => {\r\n        stream = s;\r\n        setLocalStream(s);\r\n        if (muted) s.getAudioTracks().forEach((t) => (t.enabled = false));\r\n      })\r\n      .catch((e) => setError('Нет доступа к камере или микрофону'));\r\n    return () => {\r\n      if (stream) stream.getTracks().forEach((t) => t.stop());\r\n    };\r\n  }, [isVideo]);\r\n\r\n  useEffect(() => {\r\n    if (!localRef.current || !localStream) return;\r\n    localRef.current.srcObject = localStream;\r\n  }, [localStream]);\r\n\r\n  useEffect(() => {\r\n    if (!remoteRef.current || !remoteStream) return;\r\n    remoteRef.current.srcObject = remoteStream;\r\n  }, [remoteStream]);\r\n\r\n  useEffect(() => {\r\n    if (remoteRef.current) remoteRef.current.volume = speaker ? 1 : 0.6;\r\n  }, [speaker, remoteStream]);\r\n\r\n  useEffect(() => {\r\n    if (muted && localStream) localStream.getAudioTracks().forEach((t) => (t.enabled = false));\r\n    if (!muted && localStream) localStream.getAudioTracks().forEach((t) => (t.enabled = true));\r\n  }, [muted, localStream]);\r\n\r\n  const wsUrl = getWsUrl();\r\n  const token = typeof localStorage !== 'undefined' ? localStorage.getItem('aist_token') : null;\r\n\r\n  useEffect(() => {\r\n    if (useSharedWs || useCtxForOutgoing) return;\r\n    if (!peerUserId || !wsUrl || !token) return;\r\n    setWsOpen(false);\r\n    const base = wsUrl.startsWith('ws') ? wsUrl : wsUrl.replace(/^https?/, (s) => (s === 'https' ? 'wss' : 'ws'));\r\n    const url = `${base}?token=${encodeURIComponent(token)}`;\r\n    let ws = null;\r\n    try {\r\n      ws = new WebSocket(url);\r\n      wsRef.current = ws;\r\n      ws.onopen = () => setWsOpen(true);\r\n      ws.onmessage = (ev) => {\r\n        try {\r\n          const msg = JSON.parse(ev.data);\r\n          if (msg.event === 'call:answer' && (msg.payload?.sdp || msg.payload)) {\r\n            setStatus('connected');\r\n            const desc = msg.payload?.type ? msg.payload : { type: 'answer', sdp: msg.payload?.sdp || msg.payload };\r\n            if (pcRef.current) pcRef.current.setRemoteDescription(new RTCSessionDescription(desc)).catch(() => {});\r\n          }\r\n          if (msg.event === 'call:ice' && msg.payload?.candidate) {\r\n            if (pcRef.current) pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\r\n          }\r\n          if (msg.event === 'call:hangup') onEnd();\r\n        } catch {}\r\n      };\r\n      ws.onerror = () => setError('Ошибка соединения');\r\n      ws.onclose = () => setWsOpen(false);\r\n    } catch (e) {\r\n      setError('WebSocket недоступен');\r\n    }\r\n    return () => {\r\n      if (pcRef.current) {\r\n        pcRef.current.close();\r\n        pcRef.current = null;\r\n      }\r\n      if (ws && ws.readyState === WebSocket.OPEN) ws.close();\r\n      wsRef.current = null;\r\n      setWsOpen(false);\r\n      offerSentRef.current = false;\r\n    };\r\n  }, [useSharedWs, useCtxForOutgoing, peerUserId, wsUrl, token, onEnd]);\r\n\r\n  useEffect(() => {\r\n    if (useSharedWs && callCtx && isIncoming && remoteOffer && localStream) {\r\n      callCtx.setMessageReceiver((msg) => {\r\n        if (msg.event === 'call:ice' && msg.payload?.candidate && pcRef.current) {\r\n          pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\r\n        }\r\n        if (msg.event === 'call:hangup') onEnd();\r\n      });\r\n      return () => callCtx.setMessageReceiver(null);\r\n    }\r\n  }, [useSharedWs, isIncoming, remoteOffer, localStream, callCtx, onEnd]);\r\n\r\n  useEffect(() => {\r\n    if (!localStream || !peerUserId) return;\r\n    if (isIncoming && remoteOffer && callCtx?.wsReady && callCtx.send) {\r\n      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });\r\n      pcRef.current = pc;\r\n      localStream.getTracks().forEach((track) => pc.addTrack(track, localStream));\r\n      pc.ontrack = (e) => setRemoteStream(e.streams[0] || e.stream);\r\n      pc.onicecandidate = (e) => {\r\n        if (e.candidate && callCtx?.send) callCtx.send('call:ice', { candidate: e.candidate });\r\n      };\r\n      pc.setRemoteDescription(new RTCSessionDescription(remoteOffer))\r\n        .then(() => pc.createAnswer())\r\n        .then((answer) => pc.setLocalDescription(answer).then(() => answer))\r\n        .then((answer) => {\r\n          callCtx.send('call:answer', { sdp: answer });\r\n          setStatus('connected');\r\n        })\r\n        .catch(() => setError('Ошибка соединения'));\r\n      return () => {\r\n        pc.close();\r\n        pcRef.current = null;\r\n      };\r\n    }\r\n    const sendOffer = (offer) => {\r\n      if (useCtxForOutgoing && callCtx?.send) {\r\n        callCtx.send('call:offer', { userId: peerUserId, targetUserId: peerUserId, sdp: offer, isVideo: !!isVideo });\r\n        offerSentRef.current = true;\r\n      } else if (wsRef.current?.readyState === WebSocket.OPEN) {\r\n        wsRef.current.send(JSON.stringify({ event: 'call:offer', payload: { userId: peerUserId, targetUserId: peerUserId, sdp: offer, isVideo: !!isVideo } }));\r\n        offerSentRef.current = true;\r\n      }\r\n    };\r\n    if (!isIncoming && effectiveWsOpen && !offerSentRef.current && (wsRef.current || useCtxForOutgoing)) {\r\n      if (useCtxForOutgoing) {\r\n        callCtx.setMessageReceiver((msg) => {\r\n          if (msg.event === 'call:answer' && (msg.payload?.sdp || msg.payload)) {\r\n            setStatus('connected');\r\n            const desc = msg.payload?.type ? msg.payload : { type: 'answer', sdp: msg.payload?.sdp || msg.payload };\r\n            if (pcRef.current) pcRef.current.setRemoteDescription(new RTCSessionDescription(desc)).catch(() => {});\r\n          }\r\n          if (msg.event === 'call:ice' && msg.payload?.candidate && pcRef.current) {\r\n            pcRef.current.addIceCandidate(new RTCIceCandidate(msg.payload.candidate)).catch(() => {});\r\n          }\r\n          if (msg.event === 'call:hangup') onEnd();\r\n        });\r\n      }\r\n      const pc = new RTCPeerConnection({ iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] });\r\n      pcRef.current = pc;\r\n      localStream.getTracks().forEach((track) => pc.addTrack(track, localStream));\r\n      pc.ontrack = (e) => setRemoteStream(e.streams[0] || e.stream);\r\n      pc.onicecandidate = (e) => {\r\n        if (e.candidate && useCtxForOutgoing && callCtx?.send) callCtx.send('call:ice', { candidate: e.candidate });\r\n        else if (e.candidate && wsRef.current?.readyState === WebSocket.OPEN) wsRef.current.send(JSON.stringify({ event: 'call:ice', payload: { candidate: e.candidate } }));\r\n      };\r\n      pc.createOffer()\r\n        .then((offer) => pc.setLocalDescription(offer).then(() => offer))\r\n        .then(sendOffer)\r\n        .catch(() => setError('Ошибка создания предложения'));\r\n      return () => {\r\n        if (useCtxForOutgoing) callCtx.setMessageReceiver(null);\r\n        if (pcRef.current === pc) {\r\n          pc.close();\r\n          pcRef.current = null;\r\n        }\r\n        offerSentRef.current = false;\r\n      };\r\n    }\r\n  }, [localStream, effectiveWsOpen, wsOpen, peerUserId, isIncoming, remoteOffer, callCtx, isVideo, useCtxForOutgoing, onEnd]);\r\n\r\n  const controlBtn = (Icon, active, onClick, label) => (\r\n    <button\r\n      type=\"button\"\r\n      onClick={onClick}\r\n      style={{\r\n        width: 56,\r\n        height: 56,\r\n        borderRadius: '50%',\r\n        border: 'none',\r\n        background: active ? theme.accent : (theme.sidebarBg || 'rgba(255,255,255,.12)'),\r\n        color: active ? theme.accentText : theme.text,\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        cursor: 'pointer',\r\n      }}\r\n      title={label}\r\n      aria-label={label}\r\n    >\r\n      <Icon width={24} height={24} />\r\n    </button>\r\n  );\r\n\r\n  const styles = {\r\n    overlay: {\r\n      position: 'fixed',\r\n      inset: 0,\r\n      background: theme.isDark ? '#0c0c0e' : '#f5f5f7',\r\n      zIndex: 1000,\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      color: theme.text,\r\n    },\r\n    header: {\r\n      padding: '12px 16px',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      gap: 12,\r\n      borderBottom: `1px solid ${theme.border}`,\r\n      background: theme.headerBg,\r\n    },\r\n    center: {\r\n      flex: 1,\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      padding: 24,\r\n    },\r\n    avatar: {\r\n      width: 88,\r\n      height: 88,\r\n      borderRadius: '50%',\r\n      background: theme.accent,\r\n      color: theme.accentText,\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      fontSize: 36,\r\n      fontWeight: 600,\r\n      marginBottom: 16,\r\n    },\r\n    name: { fontSize: 22, fontWeight: 600, marginBottom: 4 },\r\n    statusText: { fontSize: 15, color: theme.textMuted },\r\n    remoteVideo: {\r\n      position: 'absolute',\r\n      inset: 0,\r\n      width: '100%',\r\n      height: '100%',\r\n      objectFit: 'cover',\r\n    },\r\n    localVideo: {\r\n      position: 'absolute',\r\n      bottom: 100,\r\n      right: 16,\r\n      width: 100,\r\n      height: 140,\r\n      borderRadius: 12,\r\n      objectFit: 'cover',\r\n      border: `2px solid ${theme.border}`,\r\n    },\r\n    controls: {\r\n      padding: '24px 16px 32px',\r\n      paddingBottom: 'max(32px, env(safe-area-inset-bottom))',\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n      gap: 28,\r\n    },\r\n    endBtn: {\r\n      width: 64,\r\n      height: 64,\r\n      borderRadius: '50%',\r\n      border: 'none',\r\n      background: '#e53935',\r\n      color: '#fff',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      cursor: 'pointer',\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div style={styles.overlay}>\r\n      <header style={styles.header}>\r\n        <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 8 }} onClick={onEnd} aria-label=\"Назад\">\r\n          <IconBack width={24} height={24} />\r\n        </button>\r\n        <span style={{ flex: 1, fontSize: 17, fontWeight: 600 }}>\r\n          {isVideo ? 'Видеозвонок' : 'Голосовой звонок'} — {peerName}\r\n        </span>\r\n      </header>\r\n\r\n      <div style={{ flex: 1, position: 'relative' }}>\r\n        {error && (\r\n          <div style={{ padding: 16, textAlign: 'center', color: '#e53935' }}>{error}</div>\r\n        )}\r\n        {!error && isVideo && localStream && (\r\n          <>\r\n            {remoteStream && <video ref={remoteRef} autoPlay playsInline style={styles.remoteVideo} />}\r\n            <video ref={localRef} autoPlay muted playsInline style={styles.localVideo} />\r\n          </>\r\n        )}\r\n        {!error && (!isVideo || !localStream) && (\r\n          <div style={styles.center}>\r\n            <div style={styles.avatar}>{peerName ? peerName[0].toUpperCase() : '?'}</div>\r\n            <div style={styles.name}>{peerName}</div>\r\n            <div style={styles.statusText}>{status === 'connected' ? 'Разговор' : isIncoming ? 'Подключение...' : 'Вызов...'}</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      <div style={styles.controls}>\r\n        {controlBtn(muted ? IconMicOff : IconMic, muted, () => setMuted(!muted), muted ? 'Включить микрофон' : 'Выключить микрофон')}\r\n        {controlBtn(IconSpeaker, speaker, () => setSpeaker(!speaker), speaker ? 'Телефон' : 'Громкая связь')}\r\n        {controlBtn(IconKeypad, showKeypad, () => setShowKeypad(!showKeypad), 'Клавиатура')}\r\n        <button type=\"button\" style={styles.endBtn} onClick={() => { if (useSharedWs && callCtx) callCtx.send('call:hangup'); onEnd(); }} title=\"Завершить\" aria-label=\"Завершить звонок\">\r\n          <span style={{ fontSize: 28, lineHeight: 1, color: '#fff' }}>✕</span>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}