{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Vladislav\\\\Documents\\\\GitHub\\\\aist-messenger\\\\src\\\\context\\\\UserContext.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useMemo, useState, useEffect } from 'react';\nimport { isReservedUsername, normalizeUsernameInput } from '../constants/reservedUsernames';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst STORAGE_KEY_PROFILE = 'aist_profile';\nconst STORAGE_KEY_PHOTO = 'aist_profile_photo';\nconst defaultProfile = {\n  displayName: '',\n  username: ''\n};\nfunction loadProfile() {\n  try {\n    var _parsed$displayName, _parsed$username;\n    const raw = localStorage.getItem(STORAGE_KEY_PROFILE);\n    if (!raw) return {\n      ...defaultProfile\n    };\n    const parsed = JSON.parse(raw);\n    return {\n      displayName: (_parsed$displayName = parsed.displayName) !== null && _parsed$displayName !== void 0 ? _parsed$displayName : defaultProfile.displayName,\n      username: (_parsed$username = parsed.username) !== null && _parsed$username !== void 0 ? _parsed$username : defaultProfile.username\n    };\n  } catch {\n    return {\n      ...defaultProfile\n    };\n  }\n}\nfunction loadPhoto() {\n  try {\n    return localStorage.getItem(STORAGE_KEY_PHOTO) || '';\n  } catch {\n    return '';\n  }\n}\nfunction saveProfile(profile) {\n  try {\n    localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile));\n  } catch {}\n}\nfunction savePhoto(dataUrl) {\n  try {\n    if (dataUrl) localStorage.setItem(STORAGE_KEY_PHOTO, dataUrl);else localStorage.removeItem(STORAGE_KEY_PHOTO);\n  } catch {}\n}\nconst UserContext = /*#__PURE__*/createContext(null);\nexport function UserProvider({\n  children\n}) {\n  _s();\n  const [profile, setProfileState] = useState(loadProfile);\n  const [profilePhoto, setProfilePhotoState] = useState(loadPhoto);\n  useEffect(() => {\n    saveProfile(profile);\n  }, [profile]);\n  useEffect(() => {\n    savePhoto(profilePhoto);\n  }, [profilePhoto]);\n  const setProfile = next => {\n    setProfileState(prev => typeof next === 'function' ? next(prev) : {\n      ...prev,\n      ...next\n    });\n  };\n  const setProfilePhoto = dataUrl => {\n    setProfilePhotoState(dataUrl || '');\n    savePhoto(dataUrl || '');\n  };\n  const setDisplayName = name => setProfile({\n    displayName: String(name !== null && name !== void 0 ? name : '').trim().slice(0, 64)\n  });\n  const setUsername = value => {\n    const normalized = normalizeUsernameInput(value);\n    setProfile({\n      username: normalized\n    });\n  };\n  const usernameError = useMemo(() => {\n    const u = profile.username;\n    if (!u) return null;\n    if (u.length < 2) return 'Никнейм не менее 2 символов';\n    if (isReservedUsername(u)) return 'Это имя зарезервировано';\n    return null;\n  }, [profile.username]);\n  const value = useMemo(() => ({\n    profile,\n    setProfile,\n    setDisplayName,\n    setUsername,\n    setProfilePhoto,\n    usernameError,\n    displayName: profile.displayName,\n    username: profile.username,\n    usernameFormatted: profile.username ? `@${profile.username}` : '',\n    profilePhoto\n  }), [profile, profilePhoto, usernameError]);\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 10\n  }, this);\n}\n_s(UserProvider, \"epZt6Rr3yoIJHl/ggHZgPUkb/k0=\");\n_c = UserProvider;\nexport function useUser() {\n  _s2();\n  const ctx = useContext(UserContext);\n  if (!ctx) throw new Error('useUser must be used within UserProvider');\n  return ctx;\n}\n_s2(useUser, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"names":["React","createContext","useContext","useMemo","useState","useEffect","isReservedUsername","normalizeUsernameInput","jsxDEV","_jsxDEV","STORAGE_KEY_PROFILE","STORAGE_KEY_PHOTO","defaultProfile","displayName","username","loadProfile","_parsed$displayName","_parsed$username","raw","localStorage","getItem","parsed","JSON","parse","loadPhoto","saveProfile","profile","setItem","stringify","savePhoto","dataUrl","removeItem","UserContext","UserProvider","children","_s","setProfileState","profilePhoto","setProfilePhotoState","setProfile","next","prev","setProfilePhoto","setDisplayName","name","String","trim","slice","setUsername","value","normalized","usernameError","u","length","usernameFormatted","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useUser","_s2","ctx","Error","$RefreshReg$"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/context/UserContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useMemo, useState, useEffect } from 'react';\r\nimport { isReservedUsername, normalizeUsernameInput } from '../constants/reservedUsernames';\r\n\r\nconst STORAGE_KEY_PROFILE = 'aist_profile';\r\nconst STORAGE_KEY_PHOTO = 'aist_profile_photo';\r\n\r\nconst defaultProfile = {\r\n  displayName: '',\r\n  username: '',\r\n};\r\n\r\nfunction loadProfile() {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY_PROFILE);\r\n    if (!raw) return { ...defaultProfile };\r\n    const parsed = JSON.parse(raw);\r\n    return {\r\n      displayName: parsed.displayName ?? defaultProfile.displayName,\r\n      username: parsed.username ?? defaultProfile.username,\r\n    };\r\n  } catch {\r\n    return { ...defaultProfile };\r\n  }\r\n}\r\n\r\nfunction loadPhoto() {\r\n  try {\r\n    return localStorage.getItem(STORAGE_KEY_PHOTO) || '';\r\n  } catch {\r\n    return '';\r\n  }\r\n}\r\n\r\nfunction saveProfile(profile) {\r\n  try {\r\n    localStorage.setItem(STORAGE_KEY_PROFILE, JSON.stringify(profile));\r\n  } catch {}\r\n}\r\n\r\nfunction savePhoto(dataUrl) {\r\n  try {\r\n    if (dataUrl) localStorage.setItem(STORAGE_KEY_PHOTO, dataUrl);\r\n    else localStorage.removeItem(STORAGE_KEY_PHOTO);\r\n  } catch {}\r\n}\r\n\r\nconst UserContext = createContext(null);\r\n\r\nexport function UserProvider({ children }) {\r\n  const [profile, setProfileState] = useState(loadProfile);\r\n  const [profilePhoto, setProfilePhotoState] = useState(loadPhoto);\r\n\r\n  useEffect(() => {\r\n    saveProfile(profile);\r\n  }, [profile]);\r\n  useEffect(() => {\r\n    savePhoto(profilePhoto);\r\n  }, [profilePhoto]);\r\n\r\n  const setProfile = (next) => {\r\n    setProfileState((prev) => (typeof next === 'function' ? next(prev) : { ...prev, ...next }));\r\n  };\r\n  const setProfilePhoto = (dataUrl) => {\r\n    setProfilePhotoState(dataUrl || '');\r\n    savePhoto(dataUrl || '');\r\n  };\r\n\r\n  const setDisplayName = (name) => setProfile({ displayName: String(name ?? '').trim().slice(0, 64) });\r\n  const setUsername = (value) => {\r\n    const normalized = normalizeUsernameInput(value);\r\n    setProfile({ username: normalized });\r\n  };\r\n\r\n  const usernameError = useMemo(() => {\r\n    const u = profile.username;\r\n    if (!u) return null;\r\n    if (u.length < 2) return 'Никнейм не менее 2 символов';\r\n    if (isReservedUsername(u)) return 'Это имя зарезервировано';\r\n    return null;\r\n  }, [profile.username]);\r\n\r\n  const value = useMemo(\r\n    () => ({\r\n      profile,\r\n      setProfile,\r\n      setDisplayName,\r\n      setUsername,\r\n      setProfilePhoto,\r\n      usernameError,\r\n      displayName: profile.displayName,\r\n      username: profile.username,\r\n      usernameFormatted: profile.username ? `@${profile.username}` : '',\r\n      profilePhoto,\r\n    }),\r\n    [profile, profilePhoto, usernameError]\r\n  );\r\n\r\n  return <UserContext.Provider value={value}>{children}</UserContext.Provider>;\r\n}\r\n\r\nexport function useUser() {\r\n  const ctx = useContext(UserContext);\r\n  if (!ctx) throw new Error('useUser must be used within UserProvider');\r\n  return ctx;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}