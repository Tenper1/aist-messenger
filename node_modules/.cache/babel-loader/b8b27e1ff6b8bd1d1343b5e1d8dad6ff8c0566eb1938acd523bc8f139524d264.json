{"ast":null,"code":"import _objectSpread from\"C:/Users/Vladislav/Documents/GitHub/aist-messenger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useMemo,useEffect,useCallback,useRef}from'react';import{useNavigate,useLocation}from'react-router-dom';import{useTheme}from'../context/ThemeContext';import{useUser}from'../context/UserContext';import{IconBack,IconSearch,IconPen,IconChannel,IconChevronRight,IconPhone,IconVideo,IconAttach}from'./Icons';import CallScreen from'./CallScreen';import{getChatList,saveChatList,getMessages,appendMessage,saveMessages,addOrUpdateChat,createChat,getChannelMeta,saveChannelMeta}from'../lib/chatStorage';import{apiGetChats,apiGetMessages,apiSendMessage,apiCreateChat}from'../lib/api';import{getFolders,addChatToFolder,removeChatFromFolder,getChatFolderIds}from'../lib/folderStorage';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const APP_DOMAIN='https://aist-messenger.vercel.app';const FOLDER_ALL='all';function ChatView(_ref){let{chat,onBack}=_ref;const{theme,chatBg}=useTheme();const{displayName}=useUser();const[messages,setMessages]=useState([]);const[inputValue,setInputValue]=useState('');const[attachPreview,setAttachPreview]=useState(null);const[callMode,setCallMode]=useState(null);const[showChannelInfo,setShowChannelInfo]=useState(false);const isMobile=typeof window!=='undefined'&&window.matchMedia('(max-width: 768px)').matches;const messagesAreaBg=chatBg||(theme.isDark?'#0e1621':'#e8ecf1');const messagesAreaPattern=theme.isDark?'radial-gradient(circle at 1px 1px, rgba(255,255,255,.03) 1px, transparent 0); background-size: 24px 24px':'radial-gradient(circle at 1px 1px, rgba(0,0,0,.04) 1px, transparent 0); background-size: 24px 24px';const channelMeta=chat.type==='channel'?getChannelMeta(chat.id):null;const channelLink=(channelMeta===null||channelMeta===void 0?void 0:channelMeta.shareLink)||\"\".concat(APP_DOMAIN,\"/c/\").concat(chat.id);// Локальное хранение: сначала показываем с устройства, затем синхронизируем с сервером при открытии\nuseEffect(()=>{setMessages(getMessages(chat.id));let cancelled=false;(async()=>{const fromApi=await apiGetMessages(chat.id);if(cancelled)return;if(Array.isArray(fromApi)){const merged=saveMessages(chat.id,fromApi);setMessages(merged);}})();return()=>{cancelled=true;};},[chat.id]);const sendMessage=useCallback(async textOrAttachment=>{const isAttach=typeof textOrAttachment==='object';const text=isAttach?textOrAttachment.caption||'':(textOrAttachment||'').trim();const attachment=isAttach?textOrAttachment:null;if(!text&&!attachment)return;const localId=\"m_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9));const localMsg={id:localId,fromMe:true,text:text||(attachment?attachment.type==='image'?'Фото':'Видео':''),time:new Date().toISOString(),senderName:displayName||'Вы',attachment:attachment?{type:attachment.type,url:attachment.url}:undefined};// Сначала сохраняем на устройстве и сразу показываем\nconst next=appendMessage(chat.id,localMsg);setMessages(next);setInputValue('');setAttachPreview(null);addOrUpdateChat(_objectSpread(_objectSpread({},chat),{},{lastMessage:text||'Медиа',lastTime:Date.now()}));// Затем отправляем на сервер для синхронизации с другими устройствами\nconst fromApi=await apiSendMessage(chat.id,{text:localMsg.text,attachment:attachment?{type:attachment.type,url:attachment.url}:null});if(fromApi&&fromApi.id!==localId){const list=getMessages(chat.id);const idx=list.findIndex(m=>m.id===localId);if(idx>=0){const updated=[...list];updated[idx]=_objectSpread(_objectSpread({},list[idx]),{},{id:fromApi.id,time:fromApi.time||list[idx].time});saveMessages(chat.id,updated);setMessages(updated);}}},[chat,displayName]);const MAX_FILE_MB=16;const ALLOWED_IMAGE=['image/jpeg','image/png','image/gif','image/webp'];const ALLOWED_VIDEO=['video/mp4','video/webm'];const onAttach=e=>{var _e$target$files;const f=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(!f)return;const sizeMB=f.size/(1024*1024);if(sizeMB>MAX_FILE_MB)return;if(ALLOWED_IMAGE.includes(f.type)){const r=new FileReader();r.onload=()=>setAttachPreview({type:'image',url:r.result});r.readAsDataURL(f);}else if(ALLOWED_VIDEO.includes(f.type)){const r=new FileReader();r.onload=()=>setAttachPreview({type:'video',url:r.result});r.readAsDataURL(f);}};const bubbleIn=theme.bubbleIn||theme.sidebarBg;const bubbleOut=theme.bubbleOut||theme.accent;const bubbleStyleIn={padding:'8px 12px 6px 12px',borderRadius:'12px 12px 12px 4px',background:bubbleIn,color:theme.text,fontSize:15,lineHeight:1.35,maxWidth:'100%'};const bubbleStyleOut=_objectSpread(_objectSpread({},bubbleStyleIn),{},{borderRadius:'12px 12px 4px 12px',background:bubbleOut,color:theme.accentText||'#fff'});const formatDateKey=t=>new Date(t).toDateString();const messagesWithDates=useMemo(()=>{const out=[];let lastDate=null;messages.forEach(m=>{const d=formatDateKey(m.time);if(d!==lastDate){lastDate=d;out.push({type:'date',key:\"date-\".concat(d),date:m.time});}out.push(m);});return out;},[messages]);return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',height:'100%'},children:[/*#__PURE__*/_jsxs(\"header\",{style:{height:54,padding:'0 8px 0 4px',display:'flex',alignItems:'center',gap:8,background:theme.headerBg,borderBottom:'1px solid rgba(255,255,255,.06)'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:10,cursor:'pointer',display:isMobile?'flex':'none',alignItems:'center',justifyContent:'center'},onClick:onBack,\"aria-label\":\"\\u041D\\u0430\\u0437\\u0430\\u0434\",children:/*#__PURE__*/_jsx(IconBack,{width:24,height:24})}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>chat.type==='channel'&&setShowChannelInfo(true),style:{flex:1,border:'none',background:'transparent',padding:'8px 4px',cursor:chat.type==='channel'?'pointer':'default',textAlign:'left',minWidth:0},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600,fontSize:16,color:theme.text,display:'block'},children:chat.name}),chat.type!=='channel'&&/*#__PURE__*/_jsx(\"span\",{style:{fontSize:13,color:theme.textMuted,fontWeight:400},children:\"\\u0431\\u044B\\u043B(\\u0430) \\u043D\\u0435\\u0434\\u0430\\u0432\\u043D\\u043E\"})]}),chat.type!=='channel'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',padding:10,color:theme.textMuted,cursor:'pointer'},\"aria-label\":\"\\u0413\\u043E\\u043B\\u043E\\u0441\\u043E\\u0432\\u043E\\u0439 \\u0437\\u0432\\u043E\\u043D\\u043E\\u043A\",onClick:()=>setCallMode('voice'),children:/*#__PURE__*/_jsx(IconPhone,{width:22,height:22})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',padding:10,color:theme.textMuted,cursor:'pointer'},\"aria-label\":\"\\u0412\\u0438\\u0434\\u0435\\u043E\\u0437\\u0432\\u043E\\u043D\\u043E\\u043A\",onClick:()=>setCallMode('video'),children:/*#__PURE__*/_jsx(IconVideo,{width:22,height:22})})]})]}),showChannelInfo&&channelMeta&&/*#__PURE__*/_jsx(\"div\",{role:\"dialog\",\"aria-modal\":\"true\",\"aria-label\":\"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E \\u043A\\u0430\\u043D\\u0430\\u043B\\u0435\",style:{position:'fixed',inset:0,zIndex:1000,display:'flex',alignItems:'center',justifyContent:'center',padding:16,background:'rgba(0,0,0,.5)'},onClick:()=>setShowChannelInfo(false),children:/*#__PURE__*/_jsxs(\"div\",{style:{background:theme.cardBg,borderRadius:16,padding:20,maxWidth:360,width:'100%',border:\"1px solid \".concat(theme.border),boxShadow:'0 8px 32px rgba(0,0,0,.2)'},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:18,fontWeight:600,marginBottom:12,color:theme.text},children:chat.name}),channelMeta.description?/*#__PURE__*/_jsx(\"p\",{style:{fontSize:14,color:theme.textMuted,marginBottom:12,whiteSpace:'pre-wrap'},children:channelMeta.description}):null,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:theme.textMuted,marginBottom:8},children:\"\\u0421\\u0441\\u044B\\u043B\\u043A\\u0430 \\u043D\\u0430 \\u043A\\u0430\\u043D\\u0430\\u043B:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{readOnly:true,value:channelLink,style:{flex:1,padding:'8px 12px',borderRadius:8,border:\"1px solid \".concat(theme.border),background:theme.inputBg,color:theme.text,fontSize:13}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{var _navigator$clipboard;(_navigator$clipboard=navigator.clipboard)===null||_navigator$clipboard===void 0?void 0:_navigator$clipboard.writeText(channelLink);},style:{padding:'8px 16px',borderRadius:8,border:'none',background:theme.accent,color:theme.accentText,cursor:'pointer',fontSize:14},children:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowChannelInfo(false),style:{marginTop:16,width:'100%',padding:10,borderRadius:8,border:'none',background:theme.sidebarBg,color:theme.text,cursor:'pointer'},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]})}),callMode&&/*#__PURE__*/_jsx(CallScreen,{peerName:chat.name,isVideo:callMode==='video',onEnd:()=>setCallMode(null),peerUserId:chat.peerUserId||chat.otherUserId}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto',padding:'10px 16px 16px',display:'flex',flexDirection:'column',gap:4,background:messagesAreaBg,backgroundImage:messagesAreaPattern},children:[messages.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{color:theme.textMuted,fontSize:14,textAlign:'center',padding:40},children:\"\\u041D\\u0435\\u0442 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439\"}),messagesWithDates.map(item=>{var _m$attachment;if(item.type==='date'){const label=new Date(item.date).toLocaleDateString('ru-RU',{day:'numeric',month:'long',year:'numeric'});return/*#__PURE__*/_jsx(\"div\",{style:{alignSelf:'center',margin:'12px 0 6px',padding:'5px 14px',borderRadius:8,background:theme.isDark?'rgba(255,255,255,.07)':'rgba(0,0,0,.06)',fontSize:12,color:theme.textMuted,fontWeight:500},children:label},item.key);}const m=item;const timeStr=new Date(m.time).toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});return/*#__PURE__*/_jsxs(\"div\",{style:{alignSelf:m.fromMe?'flex-end':'flex-start',maxWidth:'82%',display:'flex',flexDirection:'column',alignItems:m.fromMe?'flex-end':'flex-start'},children:[((_m$attachment=m.attachment)===null||_m$attachment===void 0?void 0:_m$attachment.url)&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:2,borderRadius:12,overflow:'hidden',boxShadow:'0 1px 3px rgba(0,0,0,.2)'},children:m.attachment.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:m.attachment.url,alt:\"\",style:{maxWidth:260,maxHeight:260,display:'block'}}):/*#__PURE__*/_jsx(\"video\",{src:m.attachment.url,controls:true,style:{maxWidth:260,maxHeight:180}})}),/*#__PURE__*/_jsxs(\"div\",{style:m.fromMe?bubbleStyleOut:bubbleStyleIn,children:[m.text?/*#__PURE__*/_jsx(\"span\",{style:{display:'block',marginBottom:2},children:m.text}):null,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:11,opacity:0.8},children:timeStr})]})]},m.id);})]}),attachPreview&&/*#__PURE__*/_jsx(\"div\",{style:{padding:8,borderTop:\"1px solid \".concat(theme.border),background:theme.headerBg},children:/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'inline-block'},children:[attachPreview.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:attachPreview.url,alt:\"\",style:{maxHeight:120,borderRadius:8}}):/*#__PURE__*/_jsx(\"video\",{src:attachPreview.url,style:{maxHeight:120,borderRadius:8}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setAttachPreview(null),style:{position:'absolute',top:4,right:4,border:'none',background:'rgba(0,0,0,.5)',color:'#fff',borderRadius:4,padding:4},children:\"\\xD7\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'10px 12px 14px',borderTop:'1px solid rgba(255,255,255,.06)',background:theme.headerBg,display:'flex',gap:10,alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{cursor:'pointer',color:theme.textMuted,padding:8,flexShrink:0},\"aria-label\":\"\\u041F\\u0440\\u0438\\u043A\\u0440\\u0435\\u043F\\u0438\\u0442\\u044C \\u0444\\u0430\\u0439\\u043B\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*,video/*,.pdf,.doc,.docx\",style:{display:'none'},onChange:onAttach}),/*#__PURE__*/_jsx(IconAttach,{width:24,height:24})]}),/*#__PURE__*/_jsx(\"input\",{style:{flex:1,minWidth:0,padding:'10px 16px',borderRadius:20,border:'none',background:theme.inputBg,color:theme.text,fontSize:15,outline:'none'},placeholder:\"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",value:inputValue,onChange:e=>setInputValue(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();if(attachPreview)sendMessage(_objectSpread(_objectSpread({},attachPreview),{},{caption:inputValue}));else sendMessage(inputValue);}}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>attachPreview?sendMessage(_objectSpread(_objectSpread({},attachPreview),{},{caption:inputValue})):sendMessage(inputValue),style:{width:44,height:44,minWidth:44,minHeight:44,flexShrink:0,padding:0,borderRadius:'50%',border:'none',background:theme.accent,color:theme.accentText||'#fff',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',fontSize:18},\"aria-label\":\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\",children:\"\\u27A4\"})]})]});}export default function Chats(){var _location$state2;const navigate=useNavigate();const location=useLocation();const{theme}=useTheme();const[chatList,setChatList]=useState(getChatList);const[selectedChat,setSelectedChat]=useState(null);const[searchQuery,setSearchQuery]=useState('');const[newChatOpen,setNewChatOpen]=useState(false);const[activeFolderId,setActiveFolderId]=useState(FOLDER_ALL);const[foldersRefresh,setFoldersRefresh]=useState(0);const[folderMenuChatId,setFolderMenuChatId]=useState(null);const folderMenuRef=useRef(null);const folders=useMemo(()=>getFolders(),[foldersRefresh]);useEffect(()=>{if(!folderMenuChatId)return;const onDocClick=e=>{var _folderMenuRef$curren;if((_folderMenuRef$curren=folderMenuRef.current)!==null&&_folderMenuRef$curren!==void 0&&_folderMenuRef$curren.contains(e.target)||e.target.closest('[data-folder-trigger]'))return;setFolderMenuChatId(null);};document.addEventListener('click',onDocClick);return()=>document.removeEventListener('click',onDocClick);},[folderMenuChatId]);useEffect(()=>{var _location$state;const id=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.openChatId;if(id){const c=getChatList().find(ch=>ch.id===id);if(c)setSelectedChat(c);navigate('/messenger',{replace:true,state:{}});}},[(_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.openChatId,navigate]);const refreshList=useCallback(async()=>{const fromApi=await apiGetChats();if(Array.isArray(fromApi)&&fromApi.length>=0){try{saveChatList(fromApi);}catch(_unused){}setChatList(fromApi);return;}setChatList(getChatList());},[]);useEffect(()=>{refreshList();},[refreshList]);// Синхронизация при возврате на вкладку (другое устройство могло отправить сообщения)\nuseEffect(()=>{const onVisible=()=>refreshList();document.addEventListener('visibilitychange',onVisible);return()=>document.removeEventListener('visibilitychange',onVisible);},[refreshList]);const filteredChats=useMemo(()=>{const q=searchQuery.trim().toLowerCase().replace(/^@/,'');if(!q)return chatList;return chatList.filter(c=>c.name&&c.name.toLowerCase().includes(q)||c.username&&c.username.toLowerCase().includes(q));},[chatList,searchQuery]);const chatsByFolder=useMemo(()=>{var _folder$chatIds;if(activeFolderId===FOLDER_ALL)return filteredChats;const folder=folders.find(f=>f.id===activeFolderId);if(!(folder!==null&&folder!==void 0&&(_folder$chatIds=folder.chatIds)!==null&&_folder$chatIds!==void 0&&_folder$chatIds.length))return[];return filteredChats.filter(c=>folder.chatIds.includes(c.id));},[activeFolderId,filteredChats,folders]);const createNewChat=async type=>{if(type==='channel'){setNewChatOpen(false);navigate('/messenger/new-channel');return;}if(type==='group'){setNewChatOpen(false);navigate('/messenger/new-group');return;}const name=window.prompt('Введите ник @ или имя пользователя');if(!(name!==null&&name!==void 0&&name.trim()))return;const peerUsername=name.trim().replace(/^@/,'');const created=await apiCreateChat({name:name.trim(),type:'user',peerUsername});if(created!==null&&created!==void 0&&created.id){addOrUpdateChat({id:created.id,name:created.name||name.trim(),type:'user',lastMessage:'',lastTime:null,unread:0,peerUserId:created.peerUserId});await refreshList();setSelectedChat(created);setNewChatOpen(false);}else{window.alert('Пользователь с таким ником не найден. Убедитесь, что он зарегистрирован в AIST и указал никнейм в настройках.');}};useEffect(()=>{if(!selectedChat)refreshList();},[selectedChat,refreshList]);const isMobile=typeof window!=='undefined'&&window.matchMedia('(max-width: 768px)').matches;const showListOnly=isMobile&&selectedChat;// Двухколоночный макет: слева — только список чатов, справа — окно чата (как в Telegram Desktop)\nconst s={container:{display:'flex',flexDirection:'row',height:'100%',minHeight:0,background:theme.pageBg},header:{height:54,padding:'0 12px 0 16px',display:'flex',alignItems:'center',justifyContent:'space-between',background:theme.headerBg},headerTitle:{fontSize:20,fontWeight:700,color:theme.text},search:{padding:'8px 12px 12px'},searchInput:{width:'100%',padding:'10px 12px 10px 36px',borderRadius:20,border:'none',background:theme.inputBg,color:theme.text,fontSize:14,outline:'none'},searchWrap:{position:'relative'},searchIcon:{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:theme.textMuted,pointerEvents:'none'},sidebar:{width:360,minWidth:280,maxWidth:420,flexShrink:0,background:theme.sidebarBg,display:'flex',flexDirection:'column',overflow:'hidden',position:'relative',borderRight:\"1px solid \".concat(theme.border||'rgba(255,255,255,.06)')},chatList:{flex:1,overflowY:'auto',overflowX:'hidden'},chatItem:{padding:'10px 12px 10px 16px',display:'flex',alignItems:'center',gap:12,cursor:'pointer',transition:'background .12s ease',borderBottom:theme.border?\"1px solid \".concat(theme.border):'1px solid rgba(255,255,255,.04)'},chatItemActive:{background:'rgba(255,255,255,.08)'},avatar:{width:54,height:54,borderRadius:'50%',background:theme.accent,color:theme.accentText,display:'flex',alignItems:'center',justifyContent:'center',fontSize:22,fontWeight:600,flexShrink:0},chatInfo:{flex:1,minWidth:0},chatName:{fontSize:16,fontWeight:500,color:theme.text,marginBottom:2,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},lastMsg:{fontSize:14,color:theme.textMuted,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},chatMeta:{flexShrink:0,display:'flex',flexDirection:'column',alignItems:'flex-end',gap:4},chatTime:{fontSize:12,color:theme.textMuted},unreadBadge:{minWidth:18,height:18,borderRadius:9,background:theme.accent,color:theme.accentText||'#fff',fontSize:11,fontWeight:600,display:'flex',alignItems:'center',justifyContent:'center',padding:'0 5px'},mainArea:{flex:1,display:'flex',flexDirection:'column',minWidth:0,minHeight:0,background:theme.cardBg,transition:'opacity .2s ease'},empty:{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:48,textAlign:'center'},emptyIconWrap:{width:96,height:96,borderRadius:48,background:'rgba(255,255,255,.06)',display:'flex',alignItems:'center',justifyContent:'center',marginBottom:24},emptyTitle:{fontSize:22,fontWeight:600,color:theme.text,marginBottom:10},emptySub:{fontSize:15,lineHeight:1.5,color:theme.textMuted,maxWidth:260},emptyTagline:{fontSize:14,color:theme.textMuted,marginTop:28}};if(newChatOpen){return/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},s.container),{},{flexDirection:'column',width:'100%'}),children:[/*#__PURE__*/_jsxs(\"header\",{style:s.header,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:8},onClick:()=>setNewChatOpen(false),children:/*#__PURE__*/_jsx(IconBack,{width:24,height:24})}),/*#__PURE__*/_jsx(\"span\",{style:s.headerTitle,children:\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"span\",{style:{width:40}})]}),/*#__PURE__*/_jsx(\"div\",{style:s.search,children:/*#__PURE__*/_jsxs(\"div\",{style:s.searchWrap,children:[/*#__PURE__*/_jsx(\"span\",{style:s.searchIcon,children:/*#__PURE__*/_jsx(IconSearch,{width:20,height:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",style:s.searchInput,placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A \\u043F\\u043E \\u043D\\u0438\\u043A\\u0443 \\u0438\\u043B\\u0438 \\u0438\\u043C\\u0435\\u043D\\u0438\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.chatItem),{},{flexDirection:'column',alignItems:'flex-start'}),onClick:()=>createNewChat('group'),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.avatar),{},{background:theme.sidebarBg,color:theme.text,fontSize:24}),children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0433\\u0440\\u0443\\u043F\\u043F\\u0443\"}),/*#__PURE__*/_jsx(\"div\",{style:s.lastMsg,children:\"\\u041E\\u0431\\u0449\\u0438\\u0439 \\u0447\\u0430\\u0442 \\u0441 \\u043D\\u0435\\u0441\\u043A\\u043E\\u043B\\u044C\\u043A\\u0438\\u043C\\u0438 \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\\u043C\\u0438\"})]}),/*#__PURE__*/_jsx(IconChevronRight,{width:20,height:20,style:{marginLeft:'auto',color:theme.textMuted}})]})}),/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.chatItem),{},{flexDirection:'column',alignItems:'flex-start'}),onClick:()=>createNewChat('channel'),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.avatar),{},{background:theme.sidebarBg,color:theme.text}),children:/*#__PURE__*/_jsx(IconChannel,{width:24,height:24})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B\"}),/*#__PURE__*/_jsx(\"div\",{style:s.lastMsg,children:\"\\u041F\\u0443\\u0431\\u043B\\u0438\\u043A\\u0430\\u0446\\u0438\\u044F \\u043D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0435\\u0439 \\u0434\\u043B\\u044F \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u0447\\u0438\\u043A\\u043E\\u0432\"})]}),/*#__PURE__*/_jsx(IconChevronRight,{width:20,height:20,style:{marginLeft:'auto',color:theme.textMuted}})]})})]})]});}return/*#__PURE__*/_jsxs(\"div\",{style:s.container,children:[/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},s.sidebar),{},{display:showListOnly?'none':'flex'},isMobile?{width:'100%',maxWidth:'100%'}:{}),children:[/*#__PURE__*/_jsxs(\"header\",{style:s.header,children:[/*#__PURE__*/_jsx(\"span\",{style:s.headerTitle,children:\"\\u0427\\u0430\\u0442\\u044B\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:8},onClick:()=>setNewChatOpen(true),\"aria-label\":\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",children:/*#__PURE__*/_jsx(IconPen,{width:24,height:24})})]}),/*#__PURE__*/_jsx(\"div\",{style:s.search,children:/*#__PURE__*/_jsxs(\"div\",{style:s.searchWrap,children:[/*#__PURE__*/_jsx(\"span\",{style:s.searchIcon,children:/*#__PURE__*/_jsx(IconSearch,{width:20,height:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",style:s.searchInput,placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'6px 12px 10px',display:'flex',gap:6,overflowX:'auto',flexShrink:0},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{padding:'6px 14px',borderRadius:18,border:'none',background:activeFolderId===FOLDER_ALL?theme.accent:'rgba(255,255,255,.08)',color:activeFolderId===FOLDER_ALL?'#fff':theme.textMuted,fontSize:13,fontWeight:500,cursor:'pointer',whiteSpace:'nowrap'},onClick:()=>{setFolderMenuChatId(null);setActiveFolderId(FOLDER_ALL);},children:\"\\u0412\\u0441\\u0435 \\u0447\\u0430\\u0442\\u044B\"}),folders.map(f=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{padding:'6px 14px',borderRadius:18,border:'none',background:activeFolderId===f.id?theme.accent:'rgba(255,255,255,.08)',color:activeFolderId===f.id?'#fff':theme.textMuted,fontSize:13,fontWeight:500,cursor:'pointer',whiteSpace:'nowrap'},onClick:()=>{setFolderMenuChatId(null);setActiveFolderId(f.id);},children:f.name},f.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"scrollable\",style:s.chatList,children:[chatsByFolder.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:24,textAlign:'center',color:theme.textMuted,fontSize:15},children:\"\\u041D\\u0435\\u0442 \\u0447\\u0430\\u0442\\u043E\\u0432 \\u0432 \\u044D\\u0442\\u043E\\u0439 \\u043F\\u0430\\u043F\\u043A\\u0435\"}),chatsByFolder.map(chat=>{var _chat$name,_chat$name$;return/*#__PURE__*/_jsxs(\"div\",{role:\"button\",tabIndex:0,onClick:()=>{setFolderMenuChatId(null);setSelectedChat(chat);},onKeyDown:e=>e.key==='Enter'&&setSelectedChat(chat),onMouseEnter:e=>{if((selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)!==chat.id)e.currentTarget.style.background=theme.isDark?'rgba(255,255,255,.04)':'rgba(0,0,0,.03)';},onMouseLeave:e=>{if((selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)!==chat.id)e.currentTarget.style.background='transparent';},style:_objectSpread(_objectSpread(_objectSpread({},s.chatItem),(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===chat.id?s.chatItemActive:{}),{},{position:'relative'}),children:[/*#__PURE__*/_jsx(\"div\",{style:s.avatar,children:chat.photo?/*#__PURE__*/_jsx(\"img\",{src:chat.photo,alt:\"\",style:{width:'100%',height:'100%',borderRadius:'50%',objectFit:'cover'}}):chat.type==='channel'?/*#__PURE__*/_jsx(IconChannel,{width:22,height:22}):((_chat$name=chat.name)===null||_chat$name===void 0?void 0:(_chat$name$=_chat$name[0])===null||_chat$name$===void 0?void 0:_chat$name$.toUpperCase())||'?'}),/*#__PURE__*/_jsxs(\"div\",{style:s.chatInfo,children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:chat.name}),/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.lastMsg),chat.unread>0?{fontWeight:500,color:theme.text}:{}),children:chat.lastMessage||(chat.type==='channel'?'Канал':'Нет сообщений')})]}),/*#__PURE__*/_jsxs(\"div\",{style:s.chatMeta,children:[/*#__PURE__*/_jsx(\"span\",{style:s.chatTime,children:chat.lastTime?(()=>{const d=new Date(chat.lastTime);const now=new Date();if(d.toDateString()===now.toDateString())return d.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});if(d.getTime()>now.getTime()-7*86400000)return d.toLocaleDateString('ru-RU',{weekday:'short'});return d.toLocaleDateString('ru-RU',{day:'numeric',month:'short'});})():''}),chat.unread>0&&/*#__PURE__*/_jsx(\"span\",{style:s.unreadBadge,children:chat.unread>99?'99+':chat.unread})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",\"data-folder-trigger\":true,\"aria-label\":\"\\u041F\\u0430\\u043F\\u043A\\u0438\",style:{border:'none',background:'transparent',color:theme.textMuted,padding:6,borderRadius:8,cursor:'pointer',flexShrink:0},onClick:e=>{e.stopPropagation();setFolderMenuChatId(folderMenuChatId===chat.id?null:chat.id);},children:\"\\u22EF\"}),folderMenuChatId===chat.id&&/*#__PURE__*/_jsxs(\"div\",{ref:folderMenuRef,style:{position:'absolute',right:8,top:'100%',zIndex:10,marginTop:2,padding:8,borderRadius:12,background:theme.cardBg||theme.sidebarBg,boxShadow:'0 4px 12px rgba(0,0,0,.2)',minWidth:180},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12,color:theme.textMuted,marginBottom:6},children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432 \\u043F\\u0430\\u043F\\u043A\\u0443\"}),folders.length===0?/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:theme.textMuted},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0439\\u0442\\u0435 \\u043F\\u0430\\u043F\\u043A\\u0438 \\u0432 \\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0430\\u0445\"}):folders.map(f=>{const inFolder=(f.chatIds||[]).includes(chat.id);return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",style:{display:'block',width:'100%',padding:'8px 10px',border:'none',background:inFolder?'rgba(0,136,204,.15)':'transparent',color:theme.text,borderRadius:8,cursor:'pointer',textAlign:'left',fontSize:14},onClick:()=>{if(inFolder)removeChatFromFolder(f.id,chat.id);else addChatToFolder(f.id,chat.id);setFoldersRefresh(k=>k+1);},children:[inFolder?'✓ ':'',f.name]},f.id);})]})]},chat.id);})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",\"aria-label\":\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",onClick:()=>setNewChatOpen(true),style:{position:'absolute',bottom:20,right:16,width:54,height:54,borderRadius:27,border:'none',background:theme.accent,color:'#fff',boxShadow:'0 2px 12px rgba(0,0,0,.35)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(IconPen,{width:24,height:24})})]}),/*#__PURE__*/_jsx(\"div\",{style:s.mainArea,children:selectedChat?/*#__PURE__*/_jsx(ChatView,{chat:selectedChat,onBack:()=>setSelectedChat(null)}):/*#__PURE__*/_jsxs(\"div\",{style:s.empty,children:[/*#__PURE__*/_jsx(\"div\",{style:s.emptyIconWrap,children:/*#__PURE__*/_jsx(IconPen,{width:36,height:36,style:{color:theme.textMuted}})}),/*#__PURE__*/_jsx(\"div\",{style:s.emptyTitle,children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0447\\u0430\\u0442\"}),/*#__PURE__*/_jsx(\"div\",{style:s.emptySub,children:\"\\u0418\\u043B\\u0438 \\u043D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \\u043A\\u043D\\u043E\\u043F\\u043A\\u0443 \\u0441 \\u0440\\u0443\\u0447\\u043A\\u043E\\u0439 \\u0432\\u044B\\u0448\\u0435, \\u0447\\u0442\\u043E\\u0431\\u044B \\u043D\\u0430\\u0447\\u0430\\u0442\\u044C \\u043D\\u043E\\u0432\\u044B\\u0439 \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433\"}),/*#__PURE__*/_jsx(\"div\",{style:s.emptyTagline,children:\"AIST \\u2014 \\u0443\\u0434\\u043E\\u0431\\u043D\\u044B\\u0439, \\u043A\\u043E\\u043C\\u0444\\u043E\\u0440\\u0442\\u043D\\u044B\\u0439 \\u0438 \\u0431\\u0435\\u0437\\u043E\\u043F\\u0430\\u0441\\u043D\\u044B\\u0439 \\u043C\\u0435\\u0441\\u0441\\u0435\\u043D\\u0434\\u0436\\u0435\\u0440\"})]})})]});}","map":{"version":3,"names":["React","useState","useMemo","useEffect","useCallback","useRef","useNavigate","useLocation","useTheme","useUser","IconBack","IconSearch","IconPen","IconChannel","IconChevronRight","IconPhone","IconVideo","IconAttach","CallScreen","getChatList","saveChatList","getMessages","appendMessage","saveMessages","addOrUpdateChat","createChat","getChannelMeta","saveChannelMeta","apiGetChats","apiGetMessages","apiSendMessage","apiCreateChat","getFolders","addChatToFolder","removeChatFromFolder","getChatFolderIds","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","APP_DOMAIN","FOLDER_ALL","ChatView","_ref","chat","onBack","theme","chatBg","displayName","messages","setMessages","inputValue","setInputValue","attachPreview","setAttachPreview","callMode","setCallMode","showChannelInfo","setShowChannelInfo","isMobile","window","matchMedia","matches","messagesAreaBg","isDark","messagesAreaPattern","channelMeta","type","id","channelLink","shareLink","concat","cancelled","fromApi","Array","isArray","merged","sendMessage","textOrAttachment","isAttach","text","caption","trim","attachment","localId","Date","now","Math","random","toString","slice","localMsg","fromMe","time","toISOString","senderName","url","undefined","next","_objectSpread","lastMessage","lastTime","list","idx","findIndex","m","updated","MAX_FILE_MB","ALLOWED_IMAGE","ALLOWED_VIDEO","onAttach","e","_e$target$files","f","target","files","sizeMB","size","includes","r","FileReader","onload","result","readAsDataURL","bubbleIn","sidebarBg","bubbleOut","accent","bubbleStyleIn","padding","borderRadius","background","color","fontSize","lineHeight","maxWidth","bubbleStyleOut","accentText","formatDateKey","t","toDateString","messagesWithDates","out","lastDate","forEach","d","push","key","date","style","display","flexDirection","height","children","alignItems","gap","headerBg","borderBottom","border","cursor","justifyContent","onClick","width","flex","textAlign","minWidth","fontWeight","name","textMuted","role","position","inset","zIndex","cardBg","boxShadow","stopPropagation","marginBottom","description","whiteSpace","readOnly","value","inputBg","_navigator$clipboard","navigator","clipboard","writeText","marginTop","peerName","isVideo","onEnd","peerUserId","otherUserId","overflowY","backgroundImage","length","map","item","_m$attachment","label","toLocaleDateString","day","month","year","alignSelf","margin","timeStr","toLocaleTimeString","hour","minute","overflow","src","alt","maxHeight","controls","opacity","borderTop","top","right","flexShrink","accept","onChange","outline","placeholder","onKeyDown","shiftKey","preventDefault","minHeight","Chats","_location$state2","navigate","location","chatList","setChatList","selectedChat","setSelectedChat","searchQuery","setSearchQuery","newChatOpen","setNewChatOpen","activeFolderId","setActiveFolderId","foldersRefresh","setFoldersRefresh","folderMenuChatId","setFolderMenuChatId","folderMenuRef","folders","onDocClick","_folderMenuRef$curren","current","contains","closest","document","addEventListener","removeEventListener","_location$state","state","openChatId","c","find","ch","replace","refreshList","_unused","onVisible","filteredChats","q","toLowerCase","filter","username","chatsByFolder","_folder$chatIds","folder","chatIds","createNewChat","prompt","peerUsername","created","unread","alert","showListOnly","s","container","pageBg","header","headerTitle","search","searchInput","searchWrap","searchIcon","left","transform","pointerEvents","sidebar","borderRight","overflowX","chatItem","transition","chatItemActive","avatar","chatInfo","chatName","textOverflow","lastMsg","chatMeta","chatTime","unreadBadge","mainArea","empty","emptyIconWrap","emptyTitle","emptySub","emptyTagline","marginLeft","className","_chat$name","_chat$name$","tabIndex","onMouseEnter","currentTarget","onMouseLeave","photo","objectFit","toUpperCase","getTime","weekday","ref","inFolder","k","bottom"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/components/Chats.jsx"],"sourcesContent":["import React, { useState, useMemo, useEffect, useCallback, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useTheme } from '../context/ThemeContext';\r\nimport { useUser } from '../context/UserContext';\r\nimport { IconBack, IconSearch, IconPen, IconChannel, IconChevronRight, IconPhone, IconVideo, IconAttach } from './Icons';\r\nimport CallScreen from './CallScreen';\r\nimport {\r\n  getChatList,\r\n  saveChatList,\r\n  getMessages,\r\n  appendMessage,\r\n  saveMessages,\r\n  addOrUpdateChat,\r\n  createChat,\r\n  getChannelMeta,\r\n  saveChannelMeta,\r\n} from '../lib/chatStorage';\r\nimport { apiGetChats, apiGetMessages, apiSendMessage, apiCreateChat } from '../lib/api';\r\nimport { getFolders, addChatToFolder, removeChatFromFolder, getChatFolderIds } from '../lib/folderStorage';\r\n\r\nconst APP_DOMAIN = 'https://aist-messenger.vercel.app';\r\nconst FOLDER_ALL = 'all';\r\n\r\nfunction ChatView({ chat, onBack }) {\r\n  const { theme, chatBg } = useTheme();\r\n  const { displayName } = useUser();\r\n  const [messages, setMessages] = useState([]);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [attachPreview, setAttachPreview] = useState(null);\r\n  const [callMode, setCallMode] = useState(null);\r\n  const [showChannelInfo, setShowChannelInfo] = useState(false);\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia('(max-width: 768px)').matches;\r\n  const messagesAreaBg = chatBg || (theme.isDark\r\n    ? '#0e1621'\r\n    : '#e8ecf1');\r\n  const messagesAreaPattern = theme.isDark\r\n    ? 'radial-gradient(circle at 1px 1px, rgba(255,255,255,.03) 1px, transparent 0); background-size: 24px 24px'\r\n    : 'radial-gradient(circle at 1px 1px, rgba(0,0,0,.04) 1px, transparent 0); background-size: 24px 24px';\r\n  const channelMeta = chat.type === 'channel' ? getChannelMeta(chat.id) : null;\r\n  const channelLink = channelMeta?.shareLink || `${APP_DOMAIN}/c/${chat.id}`;\r\n\r\n  // Локальное хранение: сначала показываем с устройства, затем синхронизируем с сервером при открытии\r\n  useEffect(() => {\r\n    setMessages(getMessages(chat.id));\r\n    let cancelled = false;\r\n    (async () => {\r\n      const fromApi = await apiGetMessages(chat.id);\r\n      if (cancelled) return;\r\n      if (Array.isArray(fromApi)) {\r\n        const merged = saveMessages(chat.id, fromApi);\r\n        setMessages(merged);\r\n      }\r\n    })();\r\n    return () => { cancelled = true; };\r\n  }, [chat.id]);\r\n\r\n  const sendMessage = useCallback(async (textOrAttachment) => {\r\n    const isAttach = typeof textOrAttachment === 'object';\r\n    const text = isAttach ? textOrAttachment.caption || '' : (textOrAttachment || '').trim();\r\n    const attachment = isAttach ? textOrAttachment : null;\r\n    if (!text && !attachment) return;\r\n    const localId = `m_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\r\n    const localMsg = {\r\n      id: localId,\r\n      fromMe: true,\r\n      text: text || (attachment ? (attachment.type === 'image' ? 'Фото' : 'Видео') : ''),\r\n      time: new Date().toISOString(),\r\n      senderName: displayName || 'Вы',\r\n      attachment: attachment ? { type: attachment.type, url: attachment.url } : undefined,\r\n    };\r\n    // Сначала сохраняем на устройстве и сразу показываем\r\n    const next = appendMessage(chat.id, localMsg);\r\n    setMessages(next);\r\n    setInputValue('');\r\n    setAttachPreview(null);\r\n    addOrUpdateChat({ ...chat, lastMessage: text || 'Медиа', lastTime: Date.now() });\r\n    // Затем отправляем на сервер для синхронизации с другими устройствами\r\n    const fromApi = await apiSendMessage(chat.id, {\r\n      text: localMsg.text,\r\n      attachment: attachment ? { type: attachment.type, url: attachment.url } : null,\r\n    });\r\n    if (fromApi && fromApi.id !== localId) {\r\n      const list = getMessages(chat.id);\r\n      const idx = list.findIndex((m) => m.id === localId);\r\n      if (idx >= 0) {\r\n        const updated = [...list];\r\n        updated[idx] = { ...list[idx], id: fromApi.id, time: fromApi.time || list[idx].time };\r\n        saveMessages(chat.id, updated);\r\n        setMessages(updated);\r\n      }\r\n    }\r\n  }, [chat, displayName]);\r\n\r\n  const MAX_FILE_MB = 16;\r\n  const ALLOWED_IMAGE = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\r\n  const ALLOWED_VIDEO = ['video/mp4', 'video/webm'];\r\n  const onAttach = (e) => {\r\n    const f = e.target.files?.[0];\r\n    if (!f) return;\r\n    const sizeMB = f.size / (1024 * 1024);\r\n    if (sizeMB > MAX_FILE_MB) return;\r\n    if (ALLOWED_IMAGE.includes(f.type)) {\r\n      const r = new FileReader();\r\n      r.onload = () => setAttachPreview({ type: 'image', url: r.result });\r\n      r.readAsDataURL(f);\r\n    } else if (ALLOWED_VIDEO.includes(f.type)) {\r\n      const r = new FileReader();\r\n      r.onload = () => setAttachPreview({ type: 'video', url: r.result });\r\n      r.readAsDataURL(f);\r\n    }\r\n  };\r\n\r\n  const bubbleIn = theme.bubbleIn || theme.sidebarBg;\r\n  const bubbleOut = theme.bubbleOut || theme.accent;\r\n  const bubbleStyleIn = {\r\n    padding: '8px 12px 6px 12px',\r\n    borderRadius: '12px 12px 12px 4px',\r\n    background: bubbleIn,\r\n    color: theme.text,\r\n    fontSize: 15,\r\n    lineHeight: 1.35,\r\n    maxWidth: '100%',\r\n  };\r\n  const bubbleStyleOut = {\r\n    ...bubbleStyleIn,\r\n    borderRadius: '12px 12px 4px 12px',\r\n    background: bubbleOut,\r\n    color: theme.accentText || '#fff',\r\n  };\r\n\r\n  const formatDateKey = (t) => new Date(t).toDateString();\r\n  const messagesWithDates = useMemo(() => {\r\n    const out = [];\r\n    let lastDate = null;\r\n    messages.forEach((m) => {\r\n      const d = formatDateKey(m.time);\r\n      if (d !== lastDate) {\r\n        lastDate = d;\r\n        out.push({ type: 'date', key: `date-${d}`, date: m.time });\r\n      }\r\n      out.push(m);\r\n    });\r\n    return out;\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n      <header style={{ height: 54, padding: '0 8px 0 4px', display: 'flex', alignItems: 'center', gap: 8, background: theme.headerBg, borderBottom: '1px solid rgba(255,255,255,.06)' }}>\r\n        <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 10, cursor: 'pointer', display: isMobile ? 'flex' : 'none', alignItems: 'center', justifyContent: 'center' }} onClick={onBack} aria-label=\"Назад\">\r\n          <IconBack width={24} height={24} />\r\n        </button>\r\n        <button type=\"button\" onClick={() => chat.type === 'channel' && setShowChannelInfo(true)} style={{ flex: 1, border: 'none', background: 'transparent', padding: '8px 4px', cursor: chat.type === 'channel' ? 'pointer' : 'default', textAlign: 'left', minWidth: 0 }}>\r\n          <span style={{ fontWeight: 600, fontSize: 16, color: theme.text, display: 'block' }}>{chat.name}</span>\r\n          {chat.type !== 'channel' && <span style={{ fontSize: 13, color: theme.textMuted, fontWeight: 400 }}>был(а) недавно</span>}\r\n        </button>\r\n        {chat.type !== 'channel' && (\r\n          <>\r\n            <button type=\"button\" style={{ border: 'none', background: 'transparent', padding: 10, color: theme.textMuted, cursor: 'pointer' }} aria-label=\"Голосовой звонок\" onClick={() => setCallMode('voice')}><IconPhone width={22} height={22} /></button>\r\n            <button type=\"button\" style={{ border: 'none', background: 'transparent', padding: 10, color: theme.textMuted, cursor: 'pointer' }} aria-label=\"Видеозвонок\" onClick={() => setCallMode('video')}><IconVideo width={22} height={22} /></button>\r\n          </>\r\n        )}\r\n      </header>\r\n      {showChannelInfo && channelMeta && (\r\n        <div\r\n          role=\"dialog\"\r\n          aria-modal=\"true\"\r\n          aria-label=\"Информация о канале\"\r\n          style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 16, background: 'rgba(0,0,0,.5)' }}\r\n          onClick={() => setShowChannelInfo(false)}\r\n        >\r\n          <div style={{ background: theme.cardBg, borderRadius: 16, padding: 20, maxWidth: 360, width: '100%', border: `1px solid ${theme.border}`, boxShadow: '0 8px 32px rgba(0,0,0,.2)' }} onClick={(e) => e.stopPropagation()}>\r\n            <div style={{ fontSize: 18, fontWeight: 600, marginBottom: 12, color: theme.text }}>{chat.name}</div>\r\n            {channelMeta.description ? <p style={{ fontSize: 14, color: theme.textMuted, marginBottom: 12, whiteSpace: 'pre-wrap' }}>{channelMeta.description}</p> : null}\r\n            <div style={{ fontSize: 13, color: theme.textMuted, marginBottom: 8 }}>Ссылка на канал:</div>\r\n            <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n              <input readOnly value={channelLink} style={{ flex: 1, padding: '8px 12px', borderRadius: 8, border: `1px solid ${theme.border}`, background: theme.inputBg, color: theme.text, fontSize: 13 }} />\r\n              <button type=\"button\" onClick={() => { navigator.clipboard?.writeText(channelLink); }} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', background: theme.accent, color: theme.accentText, cursor: 'pointer', fontSize: 14 }}>Копировать</button>\r\n            </div>\r\n            <button type=\"button\" onClick={() => setShowChannelInfo(false)} style={{ marginTop: 16, width: '100%', padding: 10, borderRadius: 8, border: 'none', background: theme.sidebarBg, color: theme.text, cursor: 'pointer' }}>Закрыть</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {callMode && (\r\n        <CallScreen peerName={chat.name} isVideo={callMode === 'video'} onEnd={() => setCallMode(null)} peerUserId={chat.peerUserId || chat.otherUserId} />\r\n      )}\r\n      <div style={{ flex: 1, overflowY: 'auto', padding: '10px 16px 16px', display: 'flex', flexDirection: 'column', gap: 4, background: messagesAreaBg, backgroundImage: messagesAreaPattern }}>\r\n        {messages.length === 0 && (\r\n          <div style={{ color: theme.textMuted, fontSize: 14, textAlign: 'center', padding: 40 }}>Нет сообщений</div>\r\n        )}\r\n        {messagesWithDates.map((item) => {\r\n          if (item.type === 'date') {\r\n            const label = new Date(item.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });\r\n            return (\r\n              <div key={item.key} style={{ alignSelf: 'center', margin: '12px 0 6px', padding: '5px 14px', borderRadius: 8, background: theme.isDark ? 'rgba(255,255,255,.07)' : 'rgba(0,0,0,.06)', fontSize: 12, color: theme.textMuted, fontWeight: 500 }}>\r\n                {label}\r\n              </div>\r\n            );\r\n          }\r\n          const m = item;\r\n          const timeStr = new Date(m.time).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n          return (\r\n            <div key={m.id} style={{ alignSelf: m.fromMe ? 'flex-end' : 'flex-start', maxWidth: '82%', display: 'flex', flexDirection: 'column', alignItems: m.fromMe ? 'flex-end' : 'flex-start' }}>\r\n              {m.attachment?.url && (\r\n                <div style={{ marginBottom: 2, borderRadius: 12, overflow: 'hidden', boxShadow: '0 1px 3px rgba(0,0,0,.2)' }}>\r\n                  {m.attachment.type === 'image' ? (\r\n                    <img src={m.attachment.url} alt=\"\" style={{ maxWidth: 260, maxHeight: 260, display: 'block' }} />\r\n                  ) : (\r\n                    <video src={m.attachment.url} controls style={{ maxWidth: 260, maxHeight: 180 }} />\r\n                  )}\r\n                </div>\r\n              )}\r\n              <div style={m.fromMe ? bubbleStyleOut : bubbleStyleIn}>\r\n                {m.text ? <span style={{ display: 'block', marginBottom: 2 }}>{m.text}</span> : null}\r\n                <div style={{ fontSize: 11, opacity: 0.8 }}>{timeStr}</div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      {attachPreview && (\r\n        <div style={{ padding: 8, borderTop: `1px solid ${theme.border}`, background: theme.headerBg }}>\r\n          <div style={{ position: 'relative', display: 'inline-block' }}>\r\n            {attachPreview.type === 'image' ? <img src={attachPreview.url} alt=\"\" style={{ maxHeight: 120, borderRadius: 8 }} /> : <video src={attachPreview.url} style={{ maxHeight: 120, borderRadius: 8 }} />}\r\n            <button type=\"button\" onClick={() => setAttachPreview(null)} style={{ position: 'absolute', top: 4, right: 4, border: 'none', background: 'rgba(0,0,0,.5)', color: '#fff', borderRadius: 4, padding: 4 }}>×</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div style={{ padding: '10px 12px 14px', borderTop: '1px solid rgba(255,255,255,.06)', background: theme.headerBg, display: 'flex', gap: 10, alignItems: 'center' }}>\r\n        <label style={{ cursor: 'pointer', color: theme.textMuted, padding: 8, flexShrink: 0 }} aria-label=\"Прикрепить файл\">\r\n          <input type=\"file\" accept=\"image/*,video/*,.pdf,.doc,.docx\" style={{ display: 'none' }} onChange={onAttach} />\r\n          <IconAttach width={24} height={24} />\r\n        </label>\r\n        <input\r\n          style={{ flex: 1, minWidth: 0, padding: '10px 16px', borderRadius: 20, border: 'none', background: theme.inputBg, color: theme.text, fontSize: 15, outline: 'none' }}\r\n          placeholder=\"Сообщение\"\r\n          value={inputValue}\r\n          onChange={(e) => setInputValue(e.target.value)}\r\n          onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (attachPreview) sendMessage({ ...attachPreview, caption: inputValue }); else sendMessage(inputValue); } }}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => attachPreview ? sendMessage({ ...attachPreview, caption: inputValue }) : sendMessage(inputValue)}\r\n          style={{\r\n            width: 44,\r\n            height: 44,\r\n            minWidth: 44,\r\n            minHeight: 44,\r\n            flexShrink: 0,\r\n            padding: 0,\r\n            borderRadius: '50%',\r\n            border: 'none',\r\n            background: theme.accent,\r\n            color: theme.accentText || '#fff',\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            fontSize: 18,\r\n          }}\r\n          aria-label=\"Отправить\"\r\n        >\r\n          ➤\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Chats() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { theme } = useTheme();\r\n  const [chatList, setChatList] = useState(getChatList);\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [newChatOpen, setNewChatOpen] = useState(false);\r\n  const [activeFolderId, setActiveFolderId] = useState(FOLDER_ALL);\r\n  const [foldersRefresh, setFoldersRefresh] = useState(0);\r\n  const [folderMenuChatId, setFolderMenuChatId] = useState(null);\r\n  const folderMenuRef = useRef(null);\r\n  const folders = useMemo(() => getFolders(), [foldersRefresh]);\r\n\r\n  useEffect(() => {\r\n    if (!folderMenuChatId) return;\r\n    const onDocClick = (e) => {\r\n      if (folderMenuRef.current?.contains(e.target) || e.target.closest('[data-folder-trigger]')) return;\r\n      setFolderMenuChatId(null);\r\n    };\r\n    document.addEventListener('click', onDocClick);\r\n    return () => document.removeEventListener('click', onDocClick);\r\n  }, [folderMenuChatId]);\r\n\r\n  useEffect(() => {\r\n    const id = location.state?.openChatId;\r\n    if (id) {\r\n      const c = getChatList().find((ch) => ch.id === id);\r\n      if (c) setSelectedChat(c);\r\n      navigate('/messenger', { replace: true, state: {} });\r\n    }\r\n  }, [location.state?.openChatId, navigate]);\r\n\r\n  const refreshList = useCallback(async () => {\r\n    const fromApi = await apiGetChats();\r\n    if (Array.isArray(fromApi) && fromApi.length >= 0) {\r\n      try {\r\n        saveChatList(fromApi);\r\n      } catch {}\r\n      setChatList(fromApi);\r\n      return;\r\n    }\r\n    setChatList(getChatList());\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    refreshList();\r\n  }, [refreshList]);\r\n\r\n  // Синхронизация при возврате на вкладку (другое устройство могло отправить сообщения)\r\n  useEffect(() => {\r\n    const onVisible = () => refreshList();\r\n    document.addEventListener('visibilitychange', onVisible);\r\n    return () => document.removeEventListener('visibilitychange', onVisible);\r\n  }, [refreshList]);\r\n\r\n  const filteredChats = useMemo(() => {\r\n    const q = searchQuery.trim().toLowerCase().replace(/^@/, '');\r\n    if (!q) return chatList;\r\n    return chatList.filter((c) => (c.name && c.name.toLowerCase().includes(q)) || (c.username && c.username.toLowerCase().includes(q)));\r\n  }, [chatList, searchQuery]);\r\n\r\n  const chatsByFolder = useMemo(() => {\r\n    if (activeFolderId === FOLDER_ALL) return filteredChats;\r\n    const folder = folders.find((f) => f.id === activeFolderId);\r\n    if (!folder?.chatIds?.length) return [];\r\n    return filteredChats.filter((c) => folder.chatIds.includes(c.id));\r\n  }, [activeFolderId, filteredChats, folders]);\r\n\r\n  const createNewChat = async (type) => {\r\n    if (type === 'channel') {\r\n      setNewChatOpen(false);\r\n      navigate('/messenger/new-channel');\r\n      return;\r\n    }\r\n    if (type === 'group') {\r\n      setNewChatOpen(false);\r\n      navigate('/messenger/new-group');\r\n      return;\r\n    }\r\n    const name = window.prompt('Введите ник @ или имя пользователя');\r\n    if (!name?.trim()) return;\r\n    const peerUsername = name.trim().replace(/^@/, '');\r\n    const created = await apiCreateChat({ name: name.trim(), type: 'user', peerUsername });\r\n    if (created?.id) {\r\n      addOrUpdateChat({ id: created.id, name: created.name || name.trim(), type: 'user', lastMessage: '', lastTime: null, unread: 0, peerUserId: created.peerUserId });\r\n      await refreshList();\r\n      setSelectedChat(created);\r\n      setNewChatOpen(false);\r\n    } else {\r\n      window.alert('Пользователь с таким ником не найден. Убедитесь, что он зарегистрирован в AIST и указал никнейм в настройках.');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!selectedChat) refreshList();\r\n  }, [selectedChat, refreshList]);\r\n\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia('(max-width: 768px)').matches;\r\n  const showListOnly = isMobile && selectedChat;\r\n\r\n  // Двухколоночный макет: слева — только список чатов, справа — окно чата (как в Telegram Desktop)\r\n  const s = {\r\n    container: { display: 'flex', flexDirection: 'row', height: '100%', minHeight: 0, background: theme.pageBg },\r\n    header: { height: 54, padding: '0 12px 0 16px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: theme.headerBg },\r\n    headerTitle: { fontSize: 20, fontWeight: 700, color: theme.text },\r\n    search: { padding: '8px 12px 12px' },\r\n    searchInput: { width: '100%', padding: '10px 12px 10px 36px', borderRadius: 20, border: 'none', background: theme.inputBg, color: theme.text, fontSize: 14, outline: 'none' },\r\n    searchWrap: { position: 'relative' },\r\n    searchIcon: { position: 'absolute', left: 14, top: '50%', transform: 'translateY(-50%)', color: theme.textMuted, pointerEvents: 'none' },\r\n    sidebar: { width: 360, minWidth: 280, maxWidth: 420, flexShrink: 0, background: theme.sidebarBg, display: 'flex', flexDirection: 'column', overflow: 'hidden', position: 'relative', borderRight: `1px solid ${theme.border || 'rgba(255,255,255,.06)'}` },\r\n    chatList: { flex: 1, overflowY: 'auto', overflowX: 'hidden' },\r\n    chatItem: { padding: '10px 12px 10px 16px', display: 'flex', alignItems: 'center', gap: 12, cursor: 'pointer', transition: 'background .12s ease', borderBottom: theme.border ? `1px solid ${theme.border}` : '1px solid rgba(255,255,255,.04)' },\r\n    chatItemActive: { background: 'rgba(255,255,255,.08)' },\r\n    avatar: { width: 54, height: 54, borderRadius: '50%', background: theme.accent, color: theme.accentText, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 22, fontWeight: 600, flexShrink: 0 },\r\n    chatInfo: { flex: 1, minWidth: 0 },\r\n    chatName: { fontSize: 16, fontWeight: 500, color: theme.text, marginBottom: 2, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' },\r\n    lastMsg: { fontSize: 14, color: theme.textMuted, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' },\r\n    chatMeta: { flexShrink: 0, display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: 4 },\r\n    chatTime: { fontSize: 12, color: theme.textMuted },\r\n    unreadBadge: { minWidth: 18, height: 18, borderRadius: 9, background: theme.accent, color: theme.accentText || '#fff', fontSize: 11, fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '0 5px' },\r\n    mainArea: { flex: 1, display: 'flex', flexDirection: 'column', minWidth: 0, minHeight: 0, background: theme.cardBg, transition: 'opacity .2s ease' },\r\n    empty: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: 48, textAlign: 'center' },\r\n    emptyIconWrap: { width: 96, height: 96, borderRadius: 48, background: 'rgba(255,255,255,.06)', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 24 },\r\n    emptyTitle: { fontSize: 22, fontWeight: 600, color: theme.text, marginBottom: 10 },\r\n    emptySub: { fontSize: 15, lineHeight: 1.5, color: theme.textMuted, maxWidth: 260 },\r\n    emptyTagline: { fontSize: 14, color: theme.textMuted, marginTop: 28 },\r\n  };\r\n\r\n  if (newChatOpen) {\r\n    return (\r\n      <div style={{ ...s.container, flexDirection: 'column', width: '100%' }}>\r\n        <header style={s.header}>\r\n          <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 8 }} onClick={() => setNewChatOpen(false)}>\r\n            <IconBack width={24} height={24} />\r\n          </button>\r\n          <span style={s.headerTitle}>Новое сообщение</span>\r\n          <span style={{ width: 40 }} />\r\n        </header>\r\n        <div style={s.search}>\r\n          <div style={s.searchWrap}>\r\n            <span style={s.searchIcon}><IconSearch width={20} height={20} /></span>\r\n            <input type=\"text\" style={s.searchInput} placeholder=\"Поиск по нику или имени\" />\r\n          </div>\r\n        </div>\r\n        <div style={{ flex: 1, overflowY: 'auto' }}>\r\n          <div style={{ ...s.chatItem, flexDirection: 'column', alignItems: 'flex-start' }} onClick={() => createNewChat('group')}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, width: '100%' }}>\r\n              <div style={{ ...s.avatar, background: theme.sidebarBg, color: theme.text, fontSize: 24 }}>👥</div>\r\n              <div><div style={s.chatName}>Создать группу</div><div style={s.lastMsg}>Общий чат с несколькими участниками</div></div>\r\n              <IconChevronRight width={20} height={20} style={{ marginLeft: 'auto', color: theme.textMuted }} />\r\n            </div>\r\n          </div>\r\n          <div style={{ ...s.chatItem, flexDirection: 'column', alignItems: 'flex-start' }} onClick={() => createNewChat('channel')}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, width: '100%' }}>\r\n              <div style={{ ...s.avatar, background: theme.sidebarBg, color: theme.text }}><IconChannel width={24} height={24} /></div>\r\n              <div><div style={s.chatName}>Создать канал</div><div style={s.lastMsg}>Публикация новостей для подписчиков</div></div>\r\n              <IconChevronRight width={20} height={20} style={{ marginLeft: 'auto', color: theme.textMuted }} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={s.container}>\r\n      <div style={{ ...s.sidebar, display: showListOnly ? 'none' : 'flex', ...(isMobile ? { width: '100%', maxWidth: '100%' } : {}) }}>\r\n        <header style={s.header}>\r\n          <span style={s.headerTitle}>Чаты</span>\r\n          <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 8 }} onClick={() => setNewChatOpen(true)} aria-label=\"Новое сообщение\">\r\n            <IconPen width={24} height={24} />\r\n          </button>\r\n        </header>\r\n        <div style={s.search}>\r\n          <div style={s.searchWrap}>\r\n            <span style={s.searchIcon}><IconSearch width={20} height={20} /></span>\r\n            <input type=\"text\" style={s.searchInput} placeholder=\"Поиск\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />\r\n          </div>\r\n        </div>\r\n        <div style={{ padding: '6px 12px 10px', display: 'flex', gap: 6, overflowX: 'auto', flexShrink: 0 }}>\r\n          <button type=\"button\" style={{ padding: '6px 14px', borderRadius: 18, border: 'none', background: activeFolderId === FOLDER_ALL ? theme.accent : 'rgba(255,255,255,.08)', color: activeFolderId === FOLDER_ALL ? '#fff' : theme.textMuted, fontSize: 13, fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap' }} onClick={() => { setFolderMenuChatId(null); setActiveFolderId(FOLDER_ALL); }}>Все чаты</button>\r\n          {folders.map((f) => (\r\n            <button key={f.id} type=\"button\" style={{ padding: '6px 14px', borderRadius: 18, border: 'none', background: activeFolderId === f.id ? theme.accent : 'rgba(255,255,255,.08)', color: activeFolderId === f.id ? '#fff' : theme.textMuted, fontSize: 13, fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap' }} onClick={() => { setFolderMenuChatId(null); setActiveFolderId(f.id); }}>{f.name}</button>\r\n          ))}\r\n        </div>\r\n        <div className=\"scrollable\" style={s.chatList}>\r\n          {chatsByFolder.length === 0 && (\r\n            <div style={{ padding: 24, textAlign: 'center', color: theme.textMuted, fontSize: 15 }}>Нет чатов в этой папке</div>\r\n          )}\r\n          {chatsByFolder.map((chat) => (\r\n            <div\r\n              key={chat.id}\r\n              role=\"button\"\r\n              tabIndex={0}\r\n              onClick={() => { setFolderMenuChatId(null); setSelectedChat(chat); }}\r\n              onKeyDown={(e) => e.key === 'Enter' && setSelectedChat(chat)}\r\n              onMouseEnter={(e) => { if (selectedChat?.id !== chat.id) e.currentTarget.style.background = theme.isDark ? 'rgba(255,255,255,.04)' : 'rgba(0,0,0,.03)'; }}\r\n              onMouseLeave={(e) => { if (selectedChat?.id !== chat.id) e.currentTarget.style.background = 'transparent'; }}\r\n              style={{ ...s.chatItem, ...(selectedChat?.id === chat.id ? s.chatItemActive : {}), position: 'relative' }}\r\n            >\r\n              <div style={s.avatar}>{chat.photo ? <img src={chat.photo} alt=\"\" style={{ width: '100%', height: '100%', borderRadius: '50%', objectFit: 'cover' }} /> : (chat.type === 'channel' ? <IconChannel width={22} height={22} /> : (chat.name?.[0]?.toUpperCase() || '?'))}</div>\r\n              <div style={s.chatInfo}>\r\n                <div style={s.chatName}>{chat.name}</div>\r\n                <div style={{ ...s.lastMsg, ...(chat.unread > 0 ? { fontWeight: 500, color: theme.text } : {}) }}>{chat.lastMessage || (chat.type === 'channel' ? 'Канал' : 'Нет сообщений')}</div>\r\n              </div>\r\n              <div style={s.chatMeta}>\r\n                <span style={s.chatTime}>\r\n                  {chat.lastTime\r\n                    ? (() => {\r\n                        const d = new Date(chat.lastTime);\r\n                        const now = new Date();\r\n                        if (d.toDateString() === now.toDateString()) return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n                        if (d.getTime() > now.getTime() - 7 * 86400000) return d.toLocaleDateString('ru-RU', { weekday: 'short' });\r\n                        return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });\r\n                      })()\r\n                    : ''}\r\n                </span>\r\n                {chat.unread > 0 && <span style={s.unreadBadge}>{chat.unread > 99 ? '99+' : chat.unread}</span>}\r\n              </div>\r\n              <button type=\"button\" data-folder-trigger aria-label=\"Папки\" style={{ border: 'none', background: 'transparent', color: theme.textMuted, padding: 6, borderRadius: 8, cursor: 'pointer', flexShrink: 0 }} onClick={(e) => { e.stopPropagation(); setFolderMenuChatId(folderMenuChatId === chat.id ? null : chat.id); }}>⋯</button>\r\n              {folderMenuChatId === chat.id && (\r\n                <div ref={folderMenuRef} style={{ position: 'absolute', right: 8, top: '100%', zIndex: 10, marginTop: 2, padding: 8, borderRadius: 12, background: theme.cardBg || theme.sidebarBg, boxShadow: '0 4px 12px rgba(0,0,0,.2)', minWidth: 180 }} onClick={(e) => e.stopPropagation()}>\r\n                  <div style={{ fontSize: 12, color: theme.textMuted, marginBottom: 6 }}>Добавить в папку</div>\r\n                  {folders.length === 0 ? <div style={{ fontSize: 13, color: theme.textMuted }}>Создайте папки в Настройках</div> : folders.map((f) => {\r\n                    const inFolder = (f.chatIds || []).includes(chat.id);\r\n                    return (\r\n                      <button key={f.id} type=\"button\" style={{ display: 'block', width: '100%', padding: '8px 10px', border: 'none', background: inFolder ? 'rgba(0,136,204,.15)' : 'transparent', color: theme.text, borderRadius: 8, cursor: 'pointer', textAlign: 'left', fontSize: 14 }} onClick={() => { if (inFolder) removeChatFromFolder(f.id, chat.id); else addChatToFolder(f.id, chat.id); setFoldersRefresh((k) => k + 1); }}>\r\n                        {inFolder ? '✓ ' : ''}{f.name}\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          aria-label=\"Новое сообщение\"\r\n          onClick={() => setNewChatOpen(true)}\r\n          style={{\r\n            position: 'absolute',\r\n            bottom: 20,\r\n            right: 16,\r\n            width: 54,\r\n            height: 54,\r\n            borderRadius: 27,\r\n            border: 'none',\r\n            background: theme.accent,\r\n            color: '#fff',\r\n            boxShadow: '0 2px 12px rgba(0,0,0,.35)',\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n          }}\r\n        >\r\n          <IconPen width={24} height={24} />\r\n        </button>\r\n      </div>\r\n      <div style={s.mainArea}>\r\n        {selectedChat ? <ChatView chat={selectedChat} onBack={() => setSelectedChat(null)} /> : (\r\n          <div style={s.empty}>\r\n            <div style={s.emptyIconWrap}>\r\n              <IconPen width={36} height={36} style={{ color: theme.textMuted }} />\r\n            </div>\r\n            <div style={s.emptyTitle}>Выберите чат</div>\r\n            <div style={s.emptySub}>Или нажмите кнопку с ручкой выше, чтобы начать новый диалог</div>\r\n            <div style={s.emptyTagline}>AIST — удобный, комфортный и безопасный мессенджер</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}