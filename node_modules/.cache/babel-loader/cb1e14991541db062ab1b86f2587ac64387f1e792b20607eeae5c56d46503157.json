{"ast":null,"code":"import _objectSpread from\"C:/Users/Vladislav/Documents/GitHub/aist-messenger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useMemo,useEffect,useCallback,useRef}from'react';import{useNavigate,useLocation}from'react-router-dom';import{useTheme}from'../context/ThemeContext';import{useUser}from'../context/UserContext';import{IconBack,IconSearch,IconPen,IconChannel,IconChevronRight,IconPhone,IconVideo,IconAttach}from'./Icons';import CallScreen from'./CallScreen';import{getChatList,saveChatList,getMessages,appendMessage,addOrUpdateChat,createChat,getChannelMeta,saveChannelMeta}from'../lib/chatStorage';import{apiGetChats,apiGetMessages,apiSendMessage,apiCreateChat}from'../lib/api';import{getFolders,addChatToFolder,removeChatFromFolder,getChatFolderIds}from'../lib/folderStorage';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const APP_DOMAIN='https://aist-messenger.vercel.app';const FOLDER_ALL='all';function ChatView(_ref){let{chat,onBack}=_ref;const{theme,chatBg}=useTheme();const{displayName}=useUser();const[messages,setMessages]=useState([]);const[inputValue,setInputValue]=useState('');const[attachPreview,setAttachPreview]=useState(null);const[callMode,setCallMode]=useState(null);const[showChannelInfo,setShowChannelInfo]=useState(false);const isMobile=typeof window!=='undefined'&&window.matchMedia('(max-width: 768px)').matches;const messagesAreaBg=chatBg||(theme.isDark?'#0e1621':'#e8ecf1');const messagesAreaPattern=theme.isDark?'radial-gradient(circle at 1px 1px, rgba(255,255,255,.03) 1px, transparent 0); background-size: 24px 24px':'radial-gradient(circle at 1px 1px, rgba(0,0,0,.04) 1px, transparent 0); background-size: 24px 24px';const channelMeta=chat.type==='channel'?getChannelMeta(chat.id):null;const channelLink=(channelMeta===null||channelMeta===void 0?void 0:channelMeta.shareLink)||\"\".concat(APP_DOMAIN,\"/c/\").concat(chat.id);useEffect(()=>{let cancelled=false;(async()=>{const fromApi=await apiGetMessages(chat.id);if(cancelled)return;if(Array.isArray(fromApi)&&fromApi.length>=0){setMessages(fromApi);return;}setMessages(getMessages(chat.id));})();return()=>{cancelled=true;};},[chat.id]);const sendMessage=useCallback(async textOrAttachment=>{const isAttach=typeof textOrAttachment==='object';const text=isAttach?textOrAttachment.caption||'':(textOrAttachment||'').trim();const attachment=isAttach?textOrAttachment:null;if(!text&&!attachment)return;const fallbackMsg={fromMe:true,text:text||(attachment?attachment.type==='image'?'Фото':'Видео':''),time:new Date().toISOString(),senderName:displayName||'Вы',attachment:attachment?{type:attachment.type,url:attachment.url}:undefined};const fromApi=await apiSendMessage(chat.id,{text:fallbackMsg.text,attachment:attachment?{type:attachment.type,url:attachment.url}:null});const msg=fromApi?_objectSpread(_objectSpread({},fromApi),{},{senderName:displayName||'Вы'}):_objectSpread(_objectSpread({},fallbackMsg),{},{id:\"m_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).slice(2,9))});const next=appendMessage(chat.id,msg);setMessages(next);setInputValue('');setAttachPreview(null);addOrUpdateChat(_objectSpread(_objectSpread({},chat),{},{lastMessage:text||'Медиа',lastTime:Date.now()}));},[chat,displayName]);const MAX_FILE_MB=16;const ALLOWED_IMAGE=['image/jpeg','image/png','image/gif','image/webp'];const ALLOWED_VIDEO=['video/mp4','video/webm'];const onAttach=e=>{var _e$target$files;const f=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(!f)return;const sizeMB=f.size/(1024*1024);if(sizeMB>MAX_FILE_MB)return;if(ALLOWED_IMAGE.includes(f.type)){const r=new FileReader();r.onload=()=>setAttachPreview({type:'image',url:r.result});r.readAsDataURL(f);}else if(ALLOWED_VIDEO.includes(f.type)){const r=new FileReader();r.onload=()=>setAttachPreview({type:'video',url:r.result});r.readAsDataURL(f);}};const bubbleIn=theme.bubbleIn||theme.sidebarBg;const bubbleOut=theme.bubbleOut||theme.accent;const bubbleStyleIn={padding:'8px 12px 6px 12px',borderRadius:'12px 12px 12px 4px',background:bubbleIn,color:theme.text,fontSize:15,lineHeight:1.35,maxWidth:'100%'};const bubbleStyleOut=_objectSpread(_objectSpread({},bubbleStyleIn),{},{borderRadius:'12px 12px 4px 12px',background:bubbleOut,color:theme.accentText||'#fff'});const formatDateKey=t=>new Date(t).toDateString();const messagesWithDates=useMemo(()=>{const out=[];let lastDate=null;messages.forEach(m=>{const d=formatDateKey(m.time);if(d!==lastDate){lastDate=d;out.push({type:'date',key:\"date-\".concat(d),date:m.time});}out.push(m);});return out;},[messages]);return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',height:'100%'},children:[/*#__PURE__*/_jsxs(\"header\",{style:{height:54,padding:'0 8px 0 4px',display:'flex',alignItems:'center',gap:8,background:theme.headerBg,borderBottom:'1px solid rgba(255,255,255,.06)'},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:10,cursor:'pointer',display:isMobile?'flex':'none',alignItems:'center',justifyContent:'center'},onClick:onBack,\"aria-label\":\"\\u041D\\u0430\\u0437\\u0430\\u0434\",children:/*#__PURE__*/_jsx(IconBack,{width:24,height:24})}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",onClick:()=>chat.type==='channel'&&setShowChannelInfo(true),style:{flex:1,border:'none',background:'transparent',padding:'8px 4px',cursor:chat.type==='channel'?'pointer':'default',textAlign:'left',minWidth:0},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600,fontSize:16,color:theme.text,display:'block'},children:chat.name}),chat.type!=='channel'&&/*#__PURE__*/_jsx(\"span\",{style:{fontSize:13,color:theme.textMuted,fontWeight:400},children:\"\\u0431\\u044B\\u043B(\\u0430) \\u043D\\u0435\\u0434\\u0430\\u0432\\u043D\\u043E\"})]}),chat.type!=='channel'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',padding:10,color:theme.textMuted,cursor:'pointer'},\"aria-label\":\"\\u0413\\u043E\\u043B\\u043E\\u0441\\u043E\\u0432\\u043E\\u0439 \\u0437\\u0432\\u043E\\u043D\\u043E\\u043A\",onClick:()=>setCallMode('voice'),children:/*#__PURE__*/_jsx(IconPhone,{width:22,height:22})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',padding:10,color:theme.textMuted,cursor:'pointer'},\"aria-label\":\"\\u0412\\u0438\\u0434\\u0435\\u043E\\u0437\\u0432\\u043E\\u043D\\u043E\\u043A\",onClick:()=>setCallMode('video'),children:/*#__PURE__*/_jsx(IconVideo,{width:22,height:22})})]})]}),showChannelInfo&&channelMeta&&/*#__PURE__*/_jsx(\"div\",{role:\"dialog\",\"aria-modal\":\"true\",\"aria-label\":\"\\u0418\\u043D\\u0444\\u043E\\u0440\\u043C\\u0430\\u0446\\u0438\\u044F \\u043E \\u043A\\u0430\\u043D\\u0430\\u043B\\u0435\",style:{position:'fixed',inset:0,zIndex:1000,display:'flex',alignItems:'center',justifyContent:'center',padding:16,background:'rgba(0,0,0,.5)'},onClick:()=>setShowChannelInfo(false),children:/*#__PURE__*/_jsxs(\"div\",{style:{background:theme.cardBg,borderRadius:16,padding:20,maxWidth:360,width:'100%',border:\"1px solid \".concat(theme.border),boxShadow:'0 8px 32px rgba(0,0,0,.2)'},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:18,fontWeight:600,marginBottom:12,color:theme.text},children:chat.name}),channelMeta.description?/*#__PURE__*/_jsx(\"p\",{style:{fontSize:14,color:theme.textMuted,marginBottom:12,whiteSpace:'pre-wrap'},children:channelMeta.description}):null,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:theme.textMuted,marginBottom:8},children:\"\\u0421\\u0441\\u044B\\u043B\\u043A\\u0430 \\u043D\\u0430 \\u043A\\u0430\\u043D\\u0430\\u043B:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{readOnly:true,value:channelLink,style:{flex:1,padding:'8px 12px',borderRadius:8,border:\"1px solid \".concat(theme.border),background:theme.inputBg,color:theme.text,fontSize:13}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{var _navigator$clipboard;(_navigator$clipboard=navigator.clipboard)===null||_navigator$clipboard===void 0?void 0:_navigator$clipboard.writeText(channelLink);},style:{padding:'8px 16px',borderRadius:8,border:'none',background:theme.accent,color:theme.accentText,cursor:'pointer',fontSize:14},children:\"\\u041A\\u043E\\u043F\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowChannelInfo(false),style:{marginTop:16,width:'100%',padding:10,borderRadius:8,border:'none',background:theme.sidebarBg,color:theme.text,cursor:'pointer'},children:\"\\u0417\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C\"})]})}),callMode&&/*#__PURE__*/_jsx(CallScreen,{peerName:chat.name,isVideo:callMode==='video',onEnd:()=>setCallMode(null),peerUserId:chat.peerUserId||chat.otherUserId}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto',padding:'10px 16px 16px',display:'flex',flexDirection:'column',gap:4,background:messagesAreaBg,backgroundImage:messagesAreaPattern},children:[messages.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{color:theme.textMuted,fontSize:14,textAlign:'center',padding:40},children:\"\\u041D\\u0435\\u0442 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0439\"}),messagesWithDates.map(item=>{var _m$attachment;if(item.type==='date'){const label=new Date(item.date).toLocaleDateString('ru-RU',{day:'numeric',month:'long',year:'numeric'});return/*#__PURE__*/_jsx(\"div\",{style:{alignSelf:'center',margin:'12px 0 6px',padding:'5px 14px',borderRadius:8,background:theme.isDark?'rgba(255,255,255,.07)':'rgba(0,0,0,.06)',fontSize:12,color:theme.textMuted,fontWeight:500},children:label},item.key);}const m=item;const timeStr=new Date(m.time).toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});return/*#__PURE__*/_jsxs(\"div\",{style:{alignSelf:m.fromMe?'flex-end':'flex-start',maxWidth:'82%',display:'flex',flexDirection:'column',alignItems:m.fromMe?'flex-end':'flex-start'},children:[((_m$attachment=m.attachment)===null||_m$attachment===void 0?void 0:_m$attachment.url)&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:2,borderRadius:12,overflow:'hidden',boxShadow:'0 1px 3px rgba(0,0,0,.2)'},children:m.attachment.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:m.attachment.url,alt:\"\",style:{maxWidth:260,maxHeight:260,display:'block'}}):/*#__PURE__*/_jsx(\"video\",{src:m.attachment.url,controls:true,style:{maxWidth:260,maxHeight:180}})}),/*#__PURE__*/_jsxs(\"div\",{style:m.fromMe?bubbleStyleOut:bubbleStyleIn,children:[m.text?/*#__PURE__*/_jsx(\"span\",{style:{display:'block',marginBottom:2},children:m.text}):null,/*#__PURE__*/_jsx(\"div\",{style:{fontSize:11,opacity:0.8},children:timeStr})]})]},m.id);})]}),attachPreview&&/*#__PURE__*/_jsx(\"div\",{style:{padding:8,borderTop:\"1px solid \".concat(theme.border),background:theme.headerBg},children:/*#__PURE__*/_jsxs(\"div\",{style:{position:'relative',display:'inline-block'},children:[attachPreview.type==='image'?/*#__PURE__*/_jsx(\"img\",{src:attachPreview.url,alt:\"\",style:{maxHeight:120,borderRadius:8}}):/*#__PURE__*/_jsx(\"video\",{src:attachPreview.url,style:{maxHeight:120,borderRadius:8}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setAttachPreview(null),style:{position:'absolute',top:4,right:4,border:'none',background:'rgba(0,0,0,.5)',color:'#fff',borderRadius:4,padding:4},children:\"\\xD7\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'10px 12px 14px',borderTop:'1px solid rgba(255,255,255,.06)',background:theme.headerBg,display:'flex',gap:10,alignItems:'center'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{cursor:'pointer',color:theme.textMuted,padding:8,flexShrink:0},\"aria-label\":\"\\u041F\\u0440\\u0438\\u043A\\u0440\\u0435\\u043F\\u0438\\u0442\\u044C \\u0444\\u0430\\u0439\\u043B\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*,video/*,.pdf,.doc,.docx\",style:{display:'none'},onChange:onAttach}),/*#__PURE__*/_jsx(IconAttach,{width:24,height:24})]}),/*#__PURE__*/_jsx(\"input\",{style:{flex:1,minWidth:0,padding:'10px 16px',borderRadius:20,border:'none',background:theme.inputBg,color:theme.text,fontSize:15,outline:'none'},placeholder:\"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",value:inputValue,onChange:e=>setInputValue(e.target.value),onKeyDown:e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();if(attachPreview)sendMessage(_objectSpread(_objectSpread({},attachPreview),{},{caption:inputValue}));else sendMessage(inputValue);}}}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>attachPreview?sendMessage(_objectSpread(_objectSpread({},attachPreview),{},{caption:inputValue})):sendMessage(inputValue),style:{width:44,height:44,minWidth:44,minHeight:44,flexShrink:0,padding:0,borderRadius:'50%',border:'none',background:theme.accent,color:theme.accentText||'#fff',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',fontSize:18},\"aria-label\":\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C\",children:\"\\u27A4\"})]})]});}export default function Chats(){var _location$state2;const navigate=useNavigate();const location=useLocation();const{theme}=useTheme();const[chatList,setChatList]=useState(getChatList);const[selectedChat,setSelectedChat]=useState(null);const[searchQuery,setSearchQuery]=useState('');const[newChatOpen,setNewChatOpen]=useState(false);const[activeFolderId,setActiveFolderId]=useState(FOLDER_ALL);const[foldersRefresh,setFoldersRefresh]=useState(0);const[folderMenuChatId,setFolderMenuChatId]=useState(null);const folderMenuRef=useRef(null);const folders=useMemo(()=>getFolders(),[foldersRefresh]);useEffect(()=>{if(!folderMenuChatId)return;const onDocClick=e=>{var _folderMenuRef$curren;if((_folderMenuRef$curren=folderMenuRef.current)!==null&&_folderMenuRef$curren!==void 0&&_folderMenuRef$curren.contains(e.target)||e.target.closest('[data-folder-trigger]'))return;setFolderMenuChatId(null);};document.addEventListener('click',onDocClick);return()=>document.removeEventListener('click',onDocClick);},[folderMenuChatId]);useEffect(()=>{var _location$state;const id=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.openChatId;if(id){const c=getChatList().find(ch=>ch.id===id);if(c)setSelectedChat(c);navigate('/messenger',{replace:true,state:{}});}},[(_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.openChatId,navigate]);const refreshList=useCallback(async()=>{const fromApi=await apiGetChats();if(Array.isArray(fromApi)&&fromApi.length>=0){try{saveChatList(fromApi);}catch(_unused){}setChatList(fromApi);return;}setChatList(getChatList());},[]);useEffect(()=>{refreshList();},[refreshList]);const filteredChats=useMemo(()=>{const q=searchQuery.trim().toLowerCase().replace(/^@/,'');if(!q)return chatList;return chatList.filter(c=>c.name&&c.name.toLowerCase().includes(q)||c.username&&c.username.toLowerCase().includes(q));},[chatList,searchQuery]);const chatsByFolder=useMemo(()=>{var _folder$chatIds;if(activeFolderId===FOLDER_ALL)return filteredChats;const folder=folders.find(f=>f.id===activeFolderId);if(!(folder!==null&&folder!==void 0&&(_folder$chatIds=folder.chatIds)!==null&&_folder$chatIds!==void 0&&_folder$chatIds.length))return[];return filteredChats.filter(c=>folder.chatIds.includes(c.id));},[activeFolderId,filteredChats,folders]);const createNewChat=async type=>{if(type==='channel'){setNewChatOpen(false);navigate('/messenger/new-channel');return;}if(type==='group'){setNewChatOpen(false);navigate('/messenger/new-group');return;}const name=window.prompt('Введите ник @ или имя');if(!(name!==null&&name!==void 0&&name.trim()))return;const created=await apiCreateChat({name:name.trim(),type:'user'});if(created!==null&&created!==void 0&&created.id){addOrUpdateChat({id:created.id,name:created.name||name.trim(),type:'user',lastMessage:'',lastTime:null,unread:0});await refreshList();setSelectedChat(created);}else{const id=createChat({name:name.trim(),type:'user'});await refreshList();setSelectedChat(getChatList().find(c=>c.id===id)||{id,name:name.trim(),type:'user'});}setNewChatOpen(false);};useEffect(()=>{if(!selectedChat)refreshList();},[selectedChat,refreshList]);const isMobile=typeof window!=='undefined'&&window.matchMedia('(max-width: 768px)').matches;const showListOnly=isMobile&&selectedChat;// Стили как в Telegram: сайдбар без тяжёлых границ, компактные строки чатов\nconst s={container:{display:'flex',flexDirection:'column',height:'100%',minHeight:0,background:theme.sidebarBg},header:{height:54,padding:'0 12px 0 16px',display:'flex',alignItems:'center',justifyContent:'space-between',background:theme.headerBg},headerTitle:{fontSize:20,fontWeight:700,color:theme.text},search:{padding:'8px 12px 12px'},searchInput:{width:'100%',padding:'10px 12px 10px 36px',borderRadius:20,border:'none',background:theme.inputBg,color:theme.text,fontSize:14,outline:'none'},searchWrap:{position:'relative'},searchIcon:{position:'absolute',left:14,top:'50%',transform:'translateY(-50%)',color:theme.textMuted,pointerEvents:'none'},sidebar:{width:'100%',maxWidth:420,minWidth:280,flexShrink:0,background:theme.sidebarBg,display:'flex',flexDirection:'column',overflow:'hidden',position:'relative'},chatList:{flex:1,overflowY:'auto',overflowX:'hidden'},chatItem:{padding:'10px 12px 10px 16px',display:'flex',alignItems:'center',gap:12,cursor:'pointer',transition:'background .12s ease',borderBottom:theme.border?\"1px solid \".concat(theme.border):'1px solid rgba(255,255,255,.04)'},chatItemActive:{background:'rgba(255,255,255,.08)'},avatar:{width:54,height:54,borderRadius:'50%',background:theme.accent,color:theme.accentText,display:'flex',alignItems:'center',justifyContent:'center',fontSize:22,fontWeight:600,flexShrink:0},chatInfo:{flex:1,minWidth:0},chatName:{fontSize:16,fontWeight:500,color:theme.text,marginBottom:2,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},lastMsg:{fontSize:14,color:theme.textMuted,overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'},chatMeta:{flexShrink:0,display:'flex',flexDirection:'column',alignItems:'flex-end',gap:4},chatTime:{fontSize:12,color:theme.textMuted},unreadBadge:{minWidth:18,height:18,borderRadius:9,background:theme.accent,color:theme.accentText||'#fff',fontSize:11,fontWeight:600,display:'flex',alignItems:'center',justifyContent:'center',padding:'0 5px'},mainArea:{flex:1,display:'flex',flexDirection:'column',minWidth:0,minHeight:0,background:theme.cardBg,transition:'opacity .2s ease'},empty:{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:48,textAlign:'center'},emptyIconWrap:{width:96,height:96,borderRadius:48,background:'rgba(255,255,255,.06)',display:'flex',alignItems:'center',justifyContent:'center',marginBottom:24},emptyTitle:{fontSize:22,fontWeight:600,color:theme.text,marginBottom:10},emptySub:{fontSize:15,lineHeight:1.5,color:theme.textMuted,maxWidth:260},emptyTagline:{fontSize:14,color:theme.textMuted,marginTop:28}};if(newChatOpen){return/*#__PURE__*/_jsxs(\"div\",{style:s.container,children:[/*#__PURE__*/_jsxs(\"header\",{style:s.header,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:8},onClick:()=>setNewChatOpen(false),children:/*#__PURE__*/_jsx(IconBack,{width:24,height:24})}),/*#__PURE__*/_jsx(\"span\",{style:s.headerTitle,children:\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\"}),/*#__PURE__*/_jsx(\"span\",{style:{width:40}})]}),/*#__PURE__*/_jsx(\"div\",{style:s.search,children:/*#__PURE__*/_jsxs(\"div\",{style:s.searchWrap,children:[/*#__PURE__*/_jsx(\"span\",{style:s.searchIcon,children:/*#__PURE__*/_jsx(IconSearch,{width:20,height:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",style:s.searchInput,placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A \\u043F\\u043E \\u043D\\u0438\\u043A\\u0443 \\u0438\\u043B\\u0438 \\u0438\\u043C\\u0435\\u043D\\u0438\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,overflowY:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.chatItem),{},{flexDirection:'column',alignItems:'flex-start'}),onClick:()=>createNewChat('group'),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.avatar),{},{background:theme.sidebarBg,color:theme.text,fontSize:24}),children:\"\\uD83D\\uDC65\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u0433\\u0440\\u0443\\u043F\\u043F\\u0443\"}),/*#__PURE__*/_jsx(\"div\",{style:s.lastMsg,children:\"\\u041E\\u0431\\u0449\\u0438\\u0439 \\u0447\\u0430\\u0442 \\u0441 \\u043D\\u0435\\u0441\\u043A\\u043E\\u043B\\u044C\\u043A\\u0438\\u043C\\u0438 \\u0443\\u0447\\u0430\\u0441\\u0442\\u043D\\u0438\\u043A\\u0430\\u043C\\u0438\"})]}),/*#__PURE__*/_jsx(IconChevronRight,{width:20,height:20,style:{marginLeft:'auto',color:theme.textMuted}})]})}),/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.chatItem),{},{flexDirection:'column',alignItems:'flex-start'}),onClick:()=>createNewChat('channel'),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12,width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.avatar),{},{background:theme.sidebarBg,color:theme.text}),children:/*#__PURE__*/_jsx(IconChannel,{width:24,height:24})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0442\\u044C \\u043A\\u0430\\u043D\\u0430\\u043B\"}),/*#__PURE__*/_jsx(\"div\",{style:s.lastMsg,children:\"\\u041F\\u0443\\u0431\\u043B\\u0438\\u043A\\u0430\\u0446\\u0438\\u044F \\u043D\\u043E\\u0432\\u043E\\u0441\\u0442\\u0435\\u0439 \\u0434\\u043B\\u044F \\u043F\\u043E\\u0434\\u043F\\u0438\\u0441\\u0447\\u0438\\u043A\\u043E\\u0432\"})]}),/*#__PURE__*/_jsx(IconChevronRight,{width:20,height:20,style:{marginLeft:'auto',color:theme.textMuted}})]})})]})]});}return/*#__PURE__*/_jsxs(\"div\",{style:s.container,children:[/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},s.sidebar),{},{display:showListOnly?'none':'flex'}),children:[/*#__PURE__*/_jsxs(\"header\",{style:s.header,children:[/*#__PURE__*/_jsx(\"span\",{style:s.headerTitle,children:\"\\u0427\\u0430\\u0442\\u044B\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{border:'none',background:'transparent',color:theme.accent,padding:8},onClick:()=>setNewChatOpen(true),\"aria-label\":\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",children:/*#__PURE__*/_jsx(IconPen,{width:24,height:24})})]}),/*#__PURE__*/_jsx(\"div\",{style:s.search,children:/*#__PURE__*/_jsxs(\"div\",{style:s.searchWrap,children:[/*#__PURE__*/_jsx(\"span\",{style:s.searchIcon,children:/*#__PURE__*/_jsx(IconSearch,{width:20,height:20})}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",style:s.searchInput,placeholder:\"\\u041F\\u043E\\u0438\\u0441\\u043A\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value)})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'6px 12px 10px',display:'flex',gap:6,overflowX:'auto',flexShrink:0},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{padding:'6px 14px',borderRadius:18,border:'none',background:activeFolderId===FOLDER_ALL?theme.accent:'rgba(255,255,255,.08)',color:activeFolderId===FOLDER_ALL?'#fff':theme.textMuted,fontSize:13,fontWeight:500,cursor:'pointer',whiteSpace:'nowrap'},onClick:()=>{setFolderMenuChatId(null);setActiveFolderId(FOLDER_ALL);},children:\"\\u0412\\u0441\\u0435 \\u0447\\u0430\\u0442\\u044B\"}),folders.map(f=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:{padding:'6px 14px',borderRadius:18,border:'none',background:activeFolderId===f.id?theme.accent:'rgba(255,255,255,.08)',color:activeFolderId===f.id?'#fff':theme.textMuted,fontSize:13,fontWeight:500,cursor:'pointer',whiteSpace:'nowrap'},onClick:()=>{setFolderMenuChatId(null);setActiveFolderId(f.id);},children:f.name},f.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"scrollable\",style:s.chatList,children:[chatsByFolder.length===0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:24,textAlign:'center',color:theme.textMuted,fontSize:15},children:\"\\u041D\\u0435\\u0442 \\u0447\\u0430\\u0442\\u043E\\u0432 \\u0432 \\u044D\\u0442\\u043E\\u0439 \\u043F\\u0430\\u043F\\u043A\\u0435\"}),chatsByFolder.map(chat=>{var _chat$name,_chat$name$;return/*#__PURE__*/_jsxs(\"div\",{role:\"button\",tabIndex:0,onClick:()=>{setFolderMenuChatId(null);setSelectedChat(chat);},onKeyDown:e=>e.key==='Enter'&&setSelectedChat(chat),onMouseEnter:e=>{if((selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)!==chat.id)e.currentTarget.style.background=theme.isDark?'rgba(255,255,255,.04)':'rgba(0,0,0,.03)';},onMouseLeave:e=>{if((selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)!==chat.id)e.currentTarget.style.background='transparent';},style:_objectSpread(_objectSpread(_objectSpread({},s.chatItem),(selectedChat===null||selectedChat===void 0?void 0:selectedChat.id)===chat.id?s.chatItemActive:{}),{},{position:'relative'}),children:[/*#__PURE__*/_jsx(\"div\",{style:s.avatar,children:chat.photo?/*#__PURE__*/_jsx(\"img\",{src:chat.photo,alt:\"\",style:{width:'100%',height:'100%',borderRadius:'50%',objectFit:'cover'}}):chat.type==='channel'?/*#__PURE__*/_jsx(IconChannel,{width:22,height:22}):((_chat$name=chat.name)===null||_chat$name===void 0?void 0:(_chat$name$=_chat$name[0])===null||_chat$name$===void 0?void 0:_chat$name$.toUpperCase())||'?'}),/*#__PURE__*/_jsxs(\"div\",{style:s.chatInfo,children:[/*#__PURE__*/_jsx(\"div\",{style:s.chatName,children:chat.name}),/*#__PURE__*/_jsx(\"div\",{style:_objectSpread(_objectSpread({},s.lastMsg),chat.unread>0?{fontWeight:500,color:theme.text}:{}),children:chat.lastMessage||(chat.type==='channel'?'Канал':'Нет сообщений')})]}),/*#__PURE__*/_jsxs(\"div\",{style:s.chatMeta,children:[/*#__PURE__*/_jsx(\"span\",{style:s.chatTime,children:chat.lastTime?(()=>{const d=new Date(chat.lastTime);const now=new Date();if(d.toDateString()===now.toDateString())return d.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});if(d.getTime()>now.getTime()-7*86400000)return d.toLocaleDateString('ru-RU',{weekday:'short'});return d.toLocaleDateString('ru-RU',{day:'numeric',month:'short'});})():''}),chat.unread>0&&/*#__PURE__*/_jsx(\"span\",{style:s.unreadBadge,children:chat.unread>99?'99+':chat.unread})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",\"data-folder-trigger\":true,\"aria-label\":\"\\u041F\\u0430\\u043F\\u043A\\u0438\",style:{border:'none',background:'transparent',color:theme.textMuted,padding:6,borderRadius:8,cursor:'pointer',flexShrink:0},onClick:e=>{e.stopPropagation();setFolderMenuChatId(folderMenuChatId===chat.id?null:chat.id);},children:\"\\u22EF\"}),folderMenuChatId===chat.id&&/*#__PURE__*/_jsxs(\"div\",{ref:folderMenuRef,style:{position:'absolute',right:8,top:'100%',zIndex:10,marginTop:2,padding:8,borderRadius:12,background:theme.cardBg||theme.sidebarBg,boxShadow:'0 4px 12px rgba(0,0,0,.2)',minWidth:180},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:12,color:theme.textMuted,marginBottom:6},children:\"\\u0414\\u043E\\u0431\\u0430\\u0432\\u0438\\u0442\\u044C \\u0432 \\u043F\\u0430\\u043F\\u043A\\u0443\"}),folders.length===0?/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:theme.textMuted},children:\"\\u0421\\u043E\\u0437\\u0434\\u0430\\u0439\\u0442\\u0435 \\u043F\\u0430\\u043F\\u043A\\u0438 \\u0432 \\u041D\\u0430\\u0441\\u0442\\u0440\\u043E\\u0439\\u043A\\u0430\\u0445\"}):folders.map(f=>{const inFolder=(f.chatIds||[]).includes(chat.id);return/*#__PURE__*/_jsxs(\"button\",{type:\"button\",style:{display:'block',width:'100%',padding:'8px 10px',border:'none',background:inFolder?'rgba(0,136,204,.15)':'transparent',color:theme.text,borderRadius:8,cursor:'pointer',textAlign:'left',fontSize:14},onClick:()=>{if(inFolder)removeChatFromFolder(f.id,chat.id);else addChatToFolder(f.id,chat.id);setFoldersRefresh(k=>k+1);},children:[inFolder?'✓ ':'',f.name]},f.id);})]})]},chat.id);})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",\"aria-label\":\"\\u041D\\u043E\\u0432\\u043E\\u0435 \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435\",onClick:()=>setNewChatOpen(true),style:{position:'absolute',bottom:20,right:16,width:54,height:54,borderRadius:27,border:'none',background:theme.accent,color:'#fff',boxShadow:'0 2px 12px rgba(0,0,0,.35)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(IconPen,{width:24,height:24})})]}),/*#__PURE__*/_jsx(\"div\",{style:s.mainArea,children:selectedChat?/*#__PURE__*/_jsx(ChatView,{chat:selectedChat,onBack:()=>setSelectedChat(null)}):/*#__PURE__*/_jsxs(\"div\",{style:s.empty,children:[/*#__PURE__*/_jsx(\"div\",{style:s.emptyIconWrap,children:/*#__PURE__*/_jsx(IconPen,{width:36,height:36,style:{color:theme.textMuted}})}),/*#__PURE__*/_jsx(\"div\",{style:s.emptyTitle,children:\"\\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0447\\u0430\\u0442\"}),/*#__PURE__*/_jsx(\"div\",{style:s.emptySub,children:\"\\u0418\\u043B\\u0438 \\u043D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \\u043A\\u043D\\u043E\\u043F\\u043A\\u0443 \\u0441 \\u0440\\u0443\\u0447\\u043A\\u043E\\u0439 \\u0432\\u044B\\u0448\\u0435, \\u0447\\u0442\\u043E\\u0431\\u044B \\u043D\\u0430\\u0447\\u0430\\u0442\\u044C \\u043D\\u043E\\u0432\\u044B\\u0439 \\u0434\\u0438\\u0430\\u043B\\u043E\\u0433\"}),/*#__PURE__*/_jsx(\"div\",{style:s.emptyTagline,children:\"AIST \\u2014 \\u0443\\u0434\\u043E\\u0431\\u043D\\u044B\\u0439, \\u043A\\u043E\\u043C\\u0444\\u043E\\u0440\\u0442\\u043D\\u044B\\u0439 \\u0438 \\u0431\\u0435\\u0437\\u043E\\u043F\\u0430\\u0441\\u043D\\u044B\\u0439 \\u043C\\u0435\\u0441\\u0441\\u0435\\u043D\\u0434\\u0436\\u0435\\u0440\"})]})})]});}","map":{"version":3,"names":["React","useState","useMemo","useEffect","useCallback","useRef","useNavigate","useLocation","useTheme","useUser","IconBack","IconSearch","IconPen","IconChannel","IconChevronRight","IconPhone","IconVideo","IconAttach","CallScreen","getChatList","saveChatList","getMessages","appendMessage","addOrUpdateChat","createChat","getChannelMeta","saveChannelMeta","apiGetChats","apiGetMessages","apiSendMessage","apiCreateChat","getFolders","addChatToFolder","removeChatFromFolder","getChatFolderIds","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","APP_DOMAIN","FOLDER_ALL","ChatView","_ref","chat","onBack","theme","chatBg","displayName","messages","setMessages","inputValue","setInputValue","attachPreview","setAttachPreview","callMode","setCallMode","showChannelInfo","setShowChannelInfo","isMobile","window","matchMedia","matches","messagesAreaBg","isDark","messagesAreaPattern","channelMeta","type","id","channelLink","shareLink","concat","cancelled","fromApi","Array","isArray","length","sendMessage","textOrAttachment","isAttach","text","caption","trim","attachment","fallbackMsg","fromMe","time","Date","toISOString","senderName","url","undefined","msg","_objectSpread","now","Math","random","toString","slice","next","lastMessage","lastTime","MAX_FILE_MB","ALLOWED_IMAGE","ALLOWED_VIDEO","onAttach","e","_e$target$files","f","target","files","sizeMB","size","includes","r","FileReader","onload","result","readAsDataURL","bubbleIn","sidebarBg","bubbleOut","accent","bubbleStyleIn","padding","borderRadius","background","color","fontSize","lineHeight","maxWidth","bubbleStyleOut","accentText","formatDateKey","t","toDateString","messagesWithDates","out","lastDate","forEach","m","d","push","key","date","style","display","flexDirection","height","children","alignItems","gap","headerBg","borderBottom","border","cursor","justifyContent","onClick","width","flex","textAlign","minWidth","fontWeight","name","textMuted","role","position","inset","zIndex","cardBg","boxShadow","stopPropagation","marginBottom","description","whiteSpace","readOnly","value","inputBg","_navigator$clipboard","navigator","clipboard","writeText","marginTop","peerName","isVideo","onEnd","peerUserId","otherUserId","overflowY","backgroundImage","map","item","_m$attachment","label","toLocaleDateString","day","month","year","alignSelf","margin","timeStr","toLocaleTimeString","hour","minute","overflow","src","alt","maxHeight","controls","opacity","borderTop","top","right","flexShrink","accept","onChange","outline","placeholder","onKeyDown","shiftKey","preventDefault","minHeight","Chats","_location$state2","navigate","location","chatList","setChatList","selectedChat","setSelectedChat","searchQuery","setSearchQuery","newChatOpen","setNewChatOpen","activeFolderId","setActiveFolderId","foldersRefresh","setFoldersRefresh","folderMenuChatId","setFolderMenuChatId","folderMenuRef","folders","onDocClick","_folderMenuRef$curren","current","contains","closest","document","addEventListener","removeEventListener","_location$state","state","openChatId","c","find","ch","replace","refreshList","_unused","filteredChats","q","toLowerCase","filter","username","chatsByFolder","_folder$chatIds","folder","chatIds","createNewChat","prompt","created","unread","showListOnly","s","container","header","headerTitle","search","searchInput","searchWrap","searchIcon","left","transform","pointerEvents","sidebar","overflowX","chatItem","transition","chatItemActive","avatar","chatInfo","chatName","textOverflow","lastMsg","chatMeta","chatTime","unreadBadge","mainArea","empty","emptyIconWrap","emptyTitle","emptySub","emptyTagline","marginLeft","className","_chat$name","_chat$name$","tabIndex","onMouseEnter","currentTarget","onMouseLeave","photo","objectFit","toUpperCase","getTime","weekday","ref","inFolder","k","bottom"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/components/Chats.jsx"],"sourcesContent":["import React, { useState, useMemo, useEffect, useCallback, useRef } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useTheme } from '../context/ThemeContext';\r\nimport { useUser } from '../context/UserContext';\r\nimport { IconBack, IconSearch, IconPen, IconChannel, IconChevronRight, IconPhone, IconVideo, IconAttach } from './Icons';\r\nimport CallScreen from './CallScreen';\r\nimport {\r\n  getChatList,\r\n  saveChatList,\r\n  getMessages,\r\n  appendMessage,\r\n  addOrUpdateChat,\r\n  createChat,\r\n  getChannelMeta,\r\n  saveChannelMeta,\r\n} from '../lib/chatStorage';\r\nimport { apiGetChats, apiGetMessages, apiSendMessage, apiCreateChat } from '../lib/api';\r\nimport { getFolders, addChatToFolder, removeChatFromFolder, getChatFolderIds } from '../lib/folderStorage';\r\n\r\nconst APP_DOMAIN = 'https://aist-messenger.vercel.app';\r\nconst FOLDER_ALL = 'all';\r\n\r\nfunction ChatView({ chat, onBack }) {\r\n  const { theme, chatBg } = useTheme();\r\n  const { displayName } = useUser();\r\n  const [messages, setMessages] = useState([]);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [attachPreview, setAttachPreview] = useState(null);\r\n  const [callMode, setCallMode] = useState(null);\r\n  const [showChannelInfo, setShowChannelInfo] = useState(false);\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia('(max-width: 768px)').matches;\r\n  const messagesAreaBg = chatBg || (theme.isDark\r\n    ? '#0e1621'\r\n    : '#e8ecf1');\r\n  const messagesAreaPattern = theme.isDark\r\n    ? 'radial-gradient(circle at 1px 1px, rgba(255,255,255,.03) 1px, transparent 0); background-size: 24px 24px'\r\n    : 'radial-gradient(circle at 1px 1px, rgba(0,0,0,.04) 1px, transparent 0); background-size: 24px 24px';\r\n  const channelMeta = chat.type === 'channel' ? getChannelMeta(chat.id) : null;\r\n  const channelLink = channelMeta?.shareLink || `${APP_DOMAIN}/c/${chat.id}`;\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    (async () => {\r\n      const fromApi = await apiGetMessages(chat.id);\r\n      if (cancelled) return;\r\n      if (Array.isArray(fromApi) && fromApi.length >= 0) {\r\n        setMessages(fromApi);\r\n        return;\r\n      }\r\n      setMessages(getMessages(chat.id));\r\n    })();\r\n    return () => { cancelled = true; };\r\n  }, [chat.id]);\r\n\r\n  const sendMessage = useCallback(async (textOrAttachment) => {\r\n    const isAttach = typeof textOrAttachment === 'object';\r\n    const text = isAttach ? textOrAttachment.caption || '' : (textOrAttachment || '').trim();\r\n    const attachment = isAttach ? textOrAttachment : null;\r\n    if (!text && !attachment) return;\r\n    const fallbackMsg = {\r\n      fromMe: true,\r\n      text: text || (attachment ? (attachment.type === 'image' ? 'Фото' : 'Видео') : ''),\r\n      time: new Date().toISOString(),\r\n      senderName: displayName || 'Вы',\r\n      attachment: attachment ? { type: attachment.type, url: attachment.url } : undefined,\r\n    };\r\n    const fromApi = await apiSendMessage(chat.id, {\r\n      text: fallbackMsg.text,\r\n      attachment: attachment ? { type: attachment.type, url: attachment.url } : null,\r\n    });\r\n    const msg = fromApi\r\n      ? { ...fromApi, senderName: displayName || 'Вы' }\r\n      : { ...fallbackMsg, id: `m_${Date.now()}_${Math.random().toString(36).slice(2, 9)}` };\r\n    const next = appendMessage(chat.id, msg);\r\n    setMessages(next);\r\n    setInputValue('');\r\n    setAttachPreview(null);\r\n    addOrUpdateChat({ ...chat, lastMessage: text || 'Медиа', lastTime: Date.now() });\r\n  }, [chat, displayName]);\r\n\r\n  const MAX_FILE_MB = 16;\r\n  const ALLOWED_IMAGE = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\r\n  const ALLOWED_VIDEO = ['video/mp4', 'video/webm'];\r\n  const onAttach = (e) => {\r\n    const f = e.target.files?.[0];\r\n    if (!f) return;\r\n    const sizeMB = f.size / (1024 * 1024);\r\n    if (sizeMB > MAX_FILE_MB) return;\r\n    if (ALLOWED_IMAGE.includes(f.type)) {\r\n      const r = new FileReader();\r\n      r.onload = () => setAttachPreview({ type: 'image', url: r.result });\r\n      r.readAsDataURL(f);\r\n    } else if (ALLOWED_VIDEO.includes(f.type)) {\r\n      const r = new FileReader();\r\n      r.onload = () => setAttachPreview({ type: 'video', url: r.result });\r\n      r.readAsDataURL(f);\r\n    }\r\n  };\r\n\r\n  const bubbleIn = theme.bubbleIn || theme.sidebarBg;\r\n  const bubbleOut = theme.bubbleOut || theme.accent;\r\n  const bubbleStyleIn = {\r\n    padding: '8px 12px 6px 12px',\r\n    borderRadius: '12px 12px 12px 4px',\r\n    background: bubbleIn,\r\n    color: theme.text,\r\n    fontSize: 15,\r\n    lineHeight: 1.35,\r\n    maxWidth: '100%',\r\n  };\r\n  const bubbleStyleOut = {\r\n    ...bubbleStyleIn,\r\n    borderRadius: '12px 12px 4px 12px',\r\n    background: bubbleOut,\r\n    color: theme.accentText || '#fff',\r\n  };\r\n\r\n  const formatDateKey = (t) => new Date(t).toDateString();\r\n  const messagesWithDates = useMemo(() => {\r\n    const out = [];\r\n    let lastDate = null;\r\n    messages.forEach((m) => {\r\n      const d = formatDateKey(m.time);\r\n      if (d !== lastDate) {\r\n        lastDate = d;\r\n        out.push({ type: 'date', key: `date-${d}`, date: m.time });\r\n      }\r\n      out.push(m);\r\n    });\r\n    return out;\r\n  }, [messages]);\r\n\r\n  return (\r\n    <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n      <header style={{ height: 54, padding: '0 8px 0 4px', display: 'flex', alignItems: 'center', gap: 8, background: theme.headerBg, borderBottom: '1px solid rgba(255,255,255,.06)' }}>\r\n        <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 10, cursor: 'pointer', display: isMobile ? 'flex' : 'none', alignItems: 'center', justifyContent: 'center' }} onClick={onBack} aria-label=\"Назад\">\r\n          <IconBack width={24} height={24} />\r\n        </button>\r\n        <button type=\"button\" onClick={() => chat.type === 'channel' && setShowChannelInfo(true)} style={{ flex: 1, border: 'none', background: 'transparent', padding: '8px 4px', cursor: chat.type === 'channel' ? 'pointer' : 'default', textAlign: 'left', minWidth: 0 }}>\r\n          <span style={{ fontWeight: 600, fontSize: 16, color: theme.text, display: 'block' }}>{chat.name}</span>\r\n          {chat.type !== 'channel' && <span style={{ fontSize: 13, color: theme.textMuted, fontWeight: 400 }}>был(а) недавно</span>}\r\n        </button>\r\n        {chat.type !== 'channel' && (\r\n          <>\r\n            <button type=\"button\" style={{ border: 'none', background: 'transparent', padding: 10, color: theme.textMuted, cursor: 'pointer' }} aria-label=\"Голосовой звонок\" onClick={() => setCallMode('voice')}><IconPhone width={22} height={22} /></button>\r\n            <button type=\"button\" style={{ border: 'none', background: 'transparent', padding: 10, color: theme.textMuted, cursor: 'pointer' }} aria-label=\"Видеозвонок\" onClick={() => setCallMode('video')}><IconVideo width={22} height={22} /></button>\r\n          </>\r\n        )}\r\n      </header>\r\n      {showChannelInfo && channelMeta && (\r\n        <div\r\n          role=\"dialog\"\r\n          aria-modal=\"true\"\r\n          aria-label=\"Информация о канале\"\r\n          style={{ position: 'fixed', inset: 0, zIndex: 1000, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 16, background: 'rgba(0,0,0,.5)' }}\r\n          onClick={() => setShowChannelInfo(false)}\r\n        >\r\n          <div style={{ background: theme.cardBg, borderRadius: 16, padding: 20, maxWidth: 360, width: '100%', border: `1px solid ${theme.border}`, boxShadow: '0 8px 32px rgba(0,0,0,.2)' }} onClick={(e) => e.stopPropagation()}>\r\n            <div style={{ fontSize: 18, fontWeight: 600, marginBottom: 12, color: theme.text }}>{chat.name}</div>\r\n            {channelMeta.description ? <p style={{ fontSize: 14, color: theme.textMuted, marginBottom: 12, whiteSpace: 'pre-wrap' }}>{channelMeta.description}</p> : null}\r\n            <div style={{ fontSize: 13, color: theme.textMuted, marginBottom: 8 }}>Ссылка на канал:</div>\r\n            <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n              <input readOnly value={channelLink} style={{ flex: 1, padding: '8px 12px', borderRadius: 8, border: `1px solid ${theme.border}`, background: theme.inputBg, color: theme.text, fontSize: 13 }} />\r\n              <button type=\"button\" onClick={() => { navigator.clipboard?.writeText(channelLink); }} style={{ padding: '8px 16px', borderRadius: 8, border: 'none', background: theme.accent, color: theme.accentText, cursor: 'pointer', fontSize: 14 }}>Копировать</button>\r\n            </div>\r\n            <button type=\"button\" onClick={() => setShowChannelInfo(false)} style={{ marginTop: 16, width: '100%', padding: 10, borderRadius: 8, border: 'none', background: theme.sidebarBg, color: theme.text, cursor: 'pointer' }}>Закрыть</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {callMode && (\r\n        <CallScreen peerName={chat.name} isVideo={callMode === 'video'} onEnd={() => setCallMode(null)} peerUserId={chat.peerUserId || chat.otherUserId} />\r\n      )}\r\n      <div style={{ flex: 1, overflowY: 'auto', padding: '10px 16px 16px', display: 'flex', flexDirection: 'column', gap: 4, background: messagesAreaBg, backgroundImage: messagesAreaPattern }}>\r\n        {messages.length === 0 && (\r\n          <div style={{ color: theme.textMuted, fontSize: 14, textAlign: 'center', padding: 40 }}>Нет сообщений</div>\r\n        )}\r\n        {messagesWithDates.map((item) => {\r\n          if (item.type === 'date') {\r\n            const label = new Date(item.date).toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });\r\n            return (\r\n              <div key={item.key} style={{ alignSelf: 'center', margin: '12px 0 6px', padding: '5px 14px', borderRadius: 8, background: theme.isDark ? 'rgba(255,255,255,.07)' : 'rgba(0,0,0,.06)', fontSize: 12, color: theme.textMuted, fontWeight: 500 }}>\r\n                {label}\r\n              </div>\r\n            );\r\n          }\r\n          const m = item;\r\n          const timeStr = new Date(m.time).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n          return (\r\n            <div key={m.id} style={{ alignSelf: m.fromMe ? 'flex-end' : 'flex-start', maxWidth: '82%', display: 'flex', flexDirection: 'column', alignItems: m.fromMe ? 'flex-end' : 'flex-start' }}>\r\n              {m.attachment?.url && (\r\n                <div style={{ marginBottom: 2, borderRadius: 12, overflow: 'hidden', boxShadow: '0 1px 3px rgba(0,0,0,.2)' }}>\r\n                  {m.attachment.type === 'image' ? (\r\n                    <img src={m.attachment.url} alt=\"\" style={{ maxWidth: 260, maxHeight: 260, display: 'block' }} />\r\n                  ) : (\r\n                    <video src={m.attachment.url} controls style={{ maxWidth: 260, maxHeight: 180 }} />\r\n                  )}\r\n                </div>\r\n              )}\r\n              <div style={m.fromMe ? bubbleStyleOut : bubbleStyleIn}>\r\n                {m.text ? <span style={{ display: 'block', marginBottom: 2 }}>{m.text}</span> : null}\r\n                <div style={{ fontSize: 11, opacity: 0.8 }}>{timeStr}</div>\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n      {attachPreview && (\r\n        <div style={{ padding: 8, borderTop: `1px solid ${theme.border}`, background: theme.headerBg }}>\r\n          <div style={{ position: 'relative', display: 'inline-block' }}>\r\n            {attachPreview.type === 'image' ? <img src={attachPreview.url} alt=\"\" style={{ maxHeight: 120, borderRadius: 8 }} /> : <video src={attachPreview.url} style={{ maxHeight: 120, borderRadius: 8 }} />}\r\n            <button type=\"button\" onClick={() => setAttachPreview(null)} style={{ position: 'absolute', top: 4, right: 4, border: 'none', background: 'rgba(0,0,0,.5)', color: '#fff', borderRadius: 4, padding: 4 }}>×</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      <div style={{ padding: '10px 12px 14px', borderTop: '1px solid rgba(255,255,255,.06)', background: theme.headerBg, display: 'flex', gap: 10, alignItems: 'center' }}>\r\n        <label style={{ cursor: 'pointer', color: theme.textMuted, padding: 8, flexShrink: 0 }} aria-label=\"Прикрепить файл\">\r\n          <input type=\"file\" accept=\"image/*,video/*,.pdf,.doc,.docx\" style={{ display: 'none' }} onChange={onAttach} />\r\n          <IconAttach width={24} height={24} />\r\n        </label>\r\n        <input\r\n          style={{ flex: 1, minWidth: 0, padding: '10px 16px', borderRadius: 20, border: 'none', background: theme.inputBg, color: theme.text, fontSize: 15, outline: 'none' }}\r\n          placeholder=\"Сообщение\"\r\n          value={inputValue}\r\n          onChange={(e) => setInputValue(e.target.value)}\r\n          onKeyDown={(e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); if (attachPreview) sendMessage({ ...attachPreview, caption: inputValue }); else sendMessage(inputValue); } }}\r\n        />\r\n        <button\r\n          type=\"button\"\r\n          onClick={() => attachPreview ? sendMessage({ ...attachPreview, caption: inputValue }) : sendMessage(inputValue)}\r\n          style={{\r\n            width: 44,\r\n            height: 44,\r\n            minWidth: 44,\r\n            minHeight: 44,\r\n            flexShrink: 0,\r\n            padding: 0,\r\n            borderRadius: '50%',\r\n            border: 'none',\r\n            background: theme.accent,\r\n            color: theme.accentText || '#fff',\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            fontSize: 18,\r\n          }}\r\n          aria-label=\"Отправить\"\r\n        >\r\n          ➤\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Chats() {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { theme } = useTheme();\r\n  const [chatList, setChatList] = useState(getChatList);\r\n  const [selectedChat, setSelectedChat] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [newChatOpen, setNewChatOpen] = useState(false);\r\n  const [activeFolderId, setActiveFolderId] = useState(FOLDER_ALL);\r\n  const [foldersRefresh, setFoldersRefresh] = useState(0);\r\n  const [folderMenuChatId, setFolderMenuChatId] = useState(null);\r\n  const folderMenuRef = useRef(null);\r\n  const folders = useMemo(() => getFolders(), [foldersRefresh]);\r\n\r\n  useEffect(() => {\r\n    if (!folderMenuChatId) return;\r\n    const onDocClick = (e) => {\r\n      if (folderMenuRef.current?.contains(e.target) || e.target.closest('[data-folder-trigger]')) return;\r\n      setFolderMenuChatId(null);\r\n    };\r\n    document.addEventListener('click', onDocClick);\r\n    return () => document.removeEventListener('click', onDocClick);\r\n  }, [folderMenuChatId]);\r\n\r\n  useEffect(() => {\r\n    const id = location.state?.openChatId;\r\n    if (id) {\r\n      const c = getChatList().find((ch) => ch.id === id);\r\n      if (c) setSelectedChat(c);\r\n      navigate('/messenger', { replace: true, state: {} });\r\n    }\r\n  }, [location.state?.openChatId, navigate]);\r\n\r\n  const refreshList = useCallback(async () => {\r\n    const fromApi = await apiGetChats();\r\n    if (Array.isArray(fromApi) && fromApi.length >= 0) {\r\n      try {\r\n        saveChatList(fromApi);\r\n      } catch {}\r\n      setChatList(fromApi);\r\n      return;\r\n    }\r\n    setChatList(getChatList());\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    refreshList();\r\n  }, [refreshList]);\r\n\r\n  const filteredChats = useMemo(() => {\r\n    const q = searchQuery.trim().toLowerCase().replace(/^@/, '');\r\n    if (!q) return chatList;\r\n    return chatList.filter((c) => (c.name && c.name.toLowerCase().includes(q)) || (c.username && c.username.toLowerCase().includes(q)));\r\n  }, [chatList, searchQuery]);\r\n\r\n  const chatsByFolder = useMemo(() => {\r\n    if (activeFolderId === FOLDER_ALL) return filteredChats;\r\n    const folder = folders.find((f) => f.id === activeFolderId);\r\n    if (!folder?.chatIds?.length) return [];\r\n    return filteredChats.filter((c) => folder.chatIds.includes(c.id));\r\n  }, [activeFolderId, filteredChats, folders]);\r\n\r\n  const createNewChat = async (type) => {\r\n    if (type === 'channel') {\r\n      setNewChatOpen(false);\r\n      navigate('/messenger/new-channel');\r\n      return;\r\n    }\r\n    if (type === 'group') {\r\n      setNewChatOpen(false);\r\n      navigate('/messenger/new-group');\r\n      return;\r\n    }\r\n    const name = window.prompt('Введите ник @ или имя');\r\n    if (!name?.trim()) return;\r\n    const created = await apiCreateChat({ name: name.trim(), type: 'user' });\r\n    if (created?.id) {\r\n      addOrUpdateChat({ id: created.id, name: created.name || name.trim(), type: 'user', lastMessage: '', lastTime: null, unread: 0 });\r\n      await refreshList();\r\n      setSelectedChat(created);\r\n    } else {\r\n      const id = createChat({ name: name.trim(), type: 'user' });\r\n      await refreshList();\r\n      setSelectedChat(getChatList().find((c) => c.id === id) || { id, name: name.trim(), type: 'user' });\r\n    }\r\n    setNewChatOpen(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!selectedChat) refreshList();\r\n  }, [selectedChat, refreshList]);\r\n\r\n  const isMobile = typeof window !== 'undefined' && window.matchMedia('(max-width: 768px)').matches;\r\n  const showListOnly = isMobile && selectedChat;\r\n\r\n  // Стили как в Telegram: сайдбар без тяжёлых границ, компактные строки чатов\r\n  const s = {\r\n    container: { display: 'flex', flexDirection: 'column', height: '100%', minHeight: 0, background: theme.sidebarBg },\r\n    header: { height: 54, padding: '0 12px 0 16px', display: 'flex', alignItems: 'center', justifyContent: 'space-between', background: theme.headerBg },\r\n    headerTitle: { fontSize: 20, fontWeight: 700, color: theme.text },\r\n    search: { padding: '8px 12px 12px' },\r\n    searchInput: { width: '100%', padding: '10px 12px 10px 36px', borderRadius: 20, border: 'none', background: theme.inputBg, color: theme.text, fontSize: 14, outline: 'none' },\r\n    searchWrap: { position: 'relative' },\r\n    searchIcon: { position: 'absolute', left: 14, top: '50%', transform: 'translateY(-50%)', color: theme.textMuted, pointerEvents: 'none' },\r\n    sidebar: { width: '100%', maxWidth: 420, minWidth: 280, flexShrink: 0, background: theme.sidebarBg, display: 'flex', flexDirection: 'column', overflow: 'hidden', position: 'relative' },\r\n    chatList: { flex: 1, overflowY: 'auto', overflowX: 'hidden' },\r\n    chatItem: { padding: '10px 12px 10px 16px', display: 'flex', alignItems: 'center', gap: 12, cursor: 'pointer', transition: 'background .12s ease', borderBottom: theme.border ? `1px solid ${theme.border}` : '1px solid rgba(255,255,255,.04)' },\r\n    chatItemActive: { background: 'rgba(255,255,255,.08)' },\r\n    avatar: { width: 54, height: 54, borderRadius: '50%', background: theme.accent, color: theme.accentText, display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 22, fontWeight: 600, flexShrink: 0 },\r\n    chatInfo: { flex: 1, minWidth: 0 },\r\n    chatName: { fontSize: 16, fontWeight: 500, color: theme.text, marginBottom: 2, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' },\r\n    lastMsg: { fontSize: 14, color: theme.textMuted, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' },\r\n    chatMeta: { flexShrink: 0, display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: 4 },\r\n    chatTime: { fontSize: 12, color: theme.textMuted },\r\n    unreadBadge: { minWidth: 18, height: 18, borderRadius: 9, background: theme.accent, color: theme.accentText || '#fff', fontSize: 11, fontWeight: 600, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '0 5px' },\r\n    mainArea: { flex: 1, display: 'flex', flexDirection: 'column', minWidth: 0, minHeight: 0, background: theme.cardBg, transition: 'opacity .2s ease' },\r\n    empty: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: 48, textAlign: 'center' },\r\n    emptyIconWrap: { width: 96, height: 96, borderRadius: 48, background: 'rgba(255,255,255,.06)', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 24 },\r\n    emptyTitle: { fontSize: 22, fontWeight: 600, color: theme.text, marginBottom: 10 },\r\n    emptySub: { fontSize: 15, lineHeight: 1.5, color: theme.textMuted, maxWidth: 260 },\r\n    emptyTagline: { fontSize: 14, color: theme.textMuted, marginTop: 28 },\r\n  };\r\n\r\n  if (newChatOpen) {\r\n    return (\r\n      <div style={s.container}>\r\n        <header style={s.header}>\r\n          <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 8 }} onClick={() => setNewChatOpen(false)}>\r\n            <IconBack width={24} height={24} />\r\n          </button>\r\n          <span style={s.headerTitle}>Новое сообщение</span>\r\n          <span style={{ width: 40 }} />\r\n        </header>\r\n        <div style={s.search}>\r\n          <div style={s.searchWrap}>\r\n            <span style={s.searchIcon}><IconSearch width={20} height={20} /></span>\r\n            <input type=\"text\" style={s.searchInput} placeholder=\"Поиск по нику или имени\" />\r\n          </div>\r\n        </div>\r\n        <div style={{ flex: 1, overflowY: 'auto' }}>\r\n          <div style={{ ...s.chatItem, flexDirection: 'column', alignItems: 'flex-start' }} onClick={() => createNewChat('group')}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, width: '100%' }}>\r\n              <div style={{ ...s.avatar, background: theme.sidebarBg, color: theme.text, fontSize: 24 }}>👥</div>\r\n              <div><div style={s.chatName}>Создать группу</div><div style={s.lastMsg}>Общий чат с несколькими участниками</div></div>\r\n              <IconChevronRight width={20} height={20} style={{ marginLeft: 'auto', color: theme.textMuted }} />\r\n            </div>\r\n          </div>\r\n          <div style={{ ...s.chatItem, flexDirection: 'column', alignItems: 'flex-start' }} onClick={() => createNewChat('channel')}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, width: '100%' }}>\r\n              <div style={{ ...s.avatar, background: theme.sidebarBg, color: theme.text }}><IconChannel width={24} height={24} /></div>\r\n              <div><div style={s.chatName}>Создать канал</div><div style={s.lastMsg}>Публикация новостей для подписчиков</div></div>\r\n              <IconChevronRight width={20} height={20} style={{ marginLeft: 'auto', color: theme.textMuted }} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={s.container}>\r\n      <div style={{ ...s.sidebar, display: showListOnly ? 'none' : 'flex' }}>\r\n        <header style={s.header}>\r\n          <span style={s.headerTitle}>Чаты</span>\r\n          <button type=\"button\" style={{ border: 'none', background: 'transparent', color: theme.accent, padding: 8 }} onClick={() => setNewChatOpen(true)} aria-label=\"Новое сообщение\">\r\n            <IconPen width={24} height={24} />\r\n          </button>\r\n        </header>\r\n        <div style={s.search}>\r\n          <div style={s.searchWrap}>\r\n            <span style={s.searchIcon}><IconSearch width={20} height={20} /></span>\r\n            <input type=\"text\" style={s.searchInput} placeholder=\"Поиск\" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />\r\n          </div>\r\n        </div>\r\n        <div style={{ padding: '6px 12px 10px', display: 'flex', gap: 6, overflowX: 'auto', flexShrink: 0 }}>\r\n          <button type=\"button\" style={{ padding: '6px 14px', borderRadius: 18, border: 'none', background: activeFolderId === FOLDER_ALL ? theme.accent : 'rgba(255,255,255,.08)', color: activeFolderId === FOLDER_ALL ? '#fff' : theme.textMuted, fontSize: 13, fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap' }} onClick={() => { setFolderMenuChatId(null); setActiveFolderId(FOLDER_ALL); }}>Все чаты</button>\r\n          {folders.map((f) => (\r\n            <button key={f.id} type=\"button\" style={{ padding: '6px 14px', borderRadius: 18, border: 'none', background: activeFolderId === f.id ? theme.accent : 'rgba(255,255,255,.08)', color: activeFolderId === f.id ? '#fff' : theme.textMuted, fontSize: 13, fontWeight: 500, cursor: 'pointer', whiteSpace: 'nowrap' }} onClick={() => { setFolderMenuChatId(null); setActiveFolderId(f.id); }}>{f.name}</button>\r\n          ))}\r\n        </div>\r\n        <div className=\"scrollable\" style={s.chatList}>\r\n          {chatsByFolder.length === 0 && (\r\n            <div style={{ padding: 24, textAlign: 'center', color: theme.textMuted, fontSize: 15 }}>Нет чатов в этой папке</div>\r\n          )}\r\n          {chatsByFolder.map((chat) => (\r\n            <div\r\n              key={chat.id}\r\n              role=\"button\"\r\n              tabIndex={0}\r\n              onClick={() => { setFolderMenuChatId(null); setSelectedChat(chat); }}\r\n              onKeyDown={(e) => e.key === 'Enter' && setSelectedChat(chat)}\r\n              onMouseEnter={(e) => { if (selectedChat?.id !== chat.id) e.currentTarget.style.background = theme.isDark ? 'rgba(255,255,255,.04)' : 'rgba(0,0,0,.03)'; }}\r\n              onMouseLeave={(e) => { if (selectedChat?.id !== chat.id) e.currentTarget.style.background = 'transparent'; }}\r\n              style={{ ...s.chatItem, ...(selectedChat?.id === chat.id ? s.chatItemActive : {}), position: 'relative' }}\r\n            >\r\n              <div style={s.avatar}>{chat.photo ? <img src={chat.photo} alt=\"\" style={{ width: '100%', height: '100%', borderRadius: '50%', objectFit: 'cover' }} /> : (chat.type === 'channel' ? <IconChannel width={22} height={22} /> : (chat.name?.[0]?.toUpperCase() || '?'))}</div>\r\n              <div style={s.chatInfo}>\r\n                <div style={s.chatName}>{chat.name}</div>\r\n                <div style={{ ...s.lastMsg, ...(chat.unread > 0 ? { fontWeight: 500, color: theme.text } : {}) }}>{chat.lastMessage || (chat.type === 'channel' ? 'Канал' : 'Нет сообщений')}</div>\r\n              </div>\r\n              <div style={s.chatMeta}>\r\n                <span style={s.chatTime}>\r\n                  {chat.lastTime\r\n                    ? (() => {\r\n                        const d = new Date(chat.lastTime);\r\n                        const now = new Date();\r\n                        if (d.toDateString() === now.toDateString()) return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });\r\n                        if (d.getTime() > now.getTime() - 7 * 86400000) return d.toLocaleDateString('ru-RU', { weekday: 'short' });\r\n                        return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' });\r\n                      })()\r\n                    : ''}\r\n                </span>\r\n                {chat.unread > 0 && <span style={s.unreadBadge}>{chat.unread > 99 ? '99+' : chat.unread}</span>}\r\n              </div>\r\n              <button type=\"button\" data-folder-trigger aria-label=\"Папки\" style={{ border: 'none', background: 'transparent', color: theme.textMuted, padding: 6, borderRadius: 8, cursor: 'pointer', flexShrink: 0 }} onClick={(e) => { e.stopPropagation(); setFolderMenuChatId(folderMenuChatId === chat.id ? null : chat.id); }}>⋯</button>\r\n              {folderMenuChatId === chat.id && (\r\n                <div ref={folderMenuRef} style={{ position: 'absolute', right: 8, top: '100%', zIndex: 10, marginTop: 2, padding: 8, borderRadius: 12, background: theme.cardBg || theme.sidebarBg, boxShadow: '0 4px 12px rgba(0,0,0,.2)', minWidth: 180 }} onClick={(e) => e.stopPropagation()}>\r\n                  <div style={{ fontSize: 12, color: theme.textMuted, marginBottom: 6 }}>Добавить в папку</div>\r\n                  {folders.length === 0 ? <div style={{ fontSize: 13, color: theme.textMuted }}>Создайте папки в Настройках</div> : folders.map((f) => {\r\n                    const inFolder = (f.chatIds || []).includes(chat.id);\r\n                    return (\r\n                      <button key={f.id} type=\"button\" style={{ display: 'block', width: '100%', padding: '8px 10px', border: 'none', background: inFolder ? 'rgba(0,136,204,.15)' : 'transparent', color: theme.text, borderRadius: 8, cursor: 'pointer', textAlign: 'left', fontSize: 14 }} onClick={() => { if (inFolder) removeChatFromFolder(f.id, chat.id); else addChatToFolder(f.id, chat.id); setFoldersRefresh((k) => k + 1); }}>\r\n                        {inFolder ? '✓ ' : ''}{f.name}\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <button\r\n          type=\"button\"\r\n          aria-label=\"Новое сообщение\"\r\n          onClick={() => setNewChatOpen(true)}\r\n          style={{\r\n            position: 'absolute',\r\n            bottom: 20,\r\n            right: 16,\r\n            width: 54,\r\n            height: 54,\r\n            borderRadius: 27,\r\n            border: 'none',\r\n            background: theme.accent,\r\n            color: '#fff',\r\n            boxShadow: '0 2px 12px rgba(0,0,0,.35)',\r\n            cursor: 'pointer',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n          }}\r\n        >\r\n          <IconPen width={24} height={24} />\r\n        </button>\r\n      </div>\r\n      <div style={s.mainArea}>\r\n        {selectedChat ? <ChatView chat={selectedChat} onBack={() => setSelectedChat(null)} /> : (\r\n          <div style={s.empty}>\r\n            <div style={s.emptyIconWrap}>\r\n              <IconPen width={36} height={36} style={{ color: theme.textMuted }} />\r\n            </div>\r\n            <div style={s.emptyTitle}>Выберите чат</div>\r\n            <div style={s.emptySub}>Или нажмите кнопку с ручкой выше, чтобы начать новый диалог</div>\r\n            <div style={s.emptyTagline}>AIST — удобный, комфортный и безопасный мессенджер</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}