{"ast":null,"code":"import _objectSpread from\"C:/Users/Vladislav/Documents/GitHub/aist-messenger/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _window$location;import React,{useEffect,useMemo,useRef,useState}from\"react\";import{Link,useSearchParams}from\"react-router-dom\";import{QRCodeSVG}from\"qrcode.react\";import{useTheme}from\"../context/ThemeContext\";/**\r\n * AIST PWA Messenger — Register/Login screen\r\n * Вход по коду из Telegram или (в будущем) по СМС. При входе по коду из ТГ — пользовательское соглашение (законы РФ).\r\n */import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE_URL=process.env.REACT_APP_API_URL||(typeof window!==\"undefined\"&&((_window$location=window.location)===null||_window$location===void 0?void 0:_window$location.hostname)===\"localhost\"?\"http://localhost:3001\":\"https://api.get-aist.ru\");const USER_AGREEMENT_URL=\"/user-agreement\";function normalizePhone(input){if(!input)return\"\";const digitsOnly=String(input).replace(/\\D/g,\"\");if(digitsOnly.length===11&&digitsOnly.startsWith(\"7\")){return\"+\"+digitsOnly;}else if(digitsOnly.length===10){return\"+7\"+digitsOnly;}else if(digitsOnly.length===11&&digitsOnly.startsWith(\"8\")){return\"+7\"+digitsOnly.substring(1);}return\"\";}function isValidPhone(value){const normalized=normalizePhone(value);if(!normalized)return false;return /^\\+7\\d{10}$/.test(normalized);}function formatPhone(value){const normalized=normalizePhone(value);if(!normalized)return value;return normalized.replace(/^(\\+7)(\\d{3})(\\d{3})(\\d{2})(\\d{2})$/,\"$1 ($2) $3-$4-$5\");}function digitsOnly(value){return String(value!==null&&value!==void 0?value:\"\").replace(/\\D+/g,\"\");}async function postJson(url,body){var _json;let{signal}=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};let res;try{res=await fetch(url,{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify(body!==null&&body!==void 0?body:{}),signal});}catch(e){if(e.name===\"AbortError\")throw e;const msg=e.message||\"\";if(msg.includes(\"Failed to fetch\")||msg.includes(\"Load failed\")||msg.includes(\"NetworkError\")){throw new Error(\"Нет связи с сервером. Проверьте интернет и что бэкенд запущен (например http://localhost:3001). В .env задайте REACT_APP_API_URL.\");}throw new Error(msg||\"Ошибка сети\");}let json=null;try{json=await res.json();}catch(_unused){// ignore\n}if(!res.ok){const message=json&&(json.message||json.error)||\"HTTP \".concat(res.status,\" \").concat(res.statusText).trim();const err=new Error(message);err.status=res.status;err.payload=json;throw err;}return(_json=json)!==null&&_json!==void 0?_json:{};}export default function Register(){const{theme,isDark}=useTheme();const[authMethod,setAuthMethod]=useState(\"telegram\");// 'telegram' | 'sms' (sms пока заглушка)\nconst[step,setStep]=useState(\"request\");const[phoneInput,setPhoneInput]=useState(\"\");const[phone,setPhone]=useState(\"\");const[code,setCode]=useState(\"\");const[agreementAccepted,setAgreementAccepted]=useState(false);const[busy,setBusy]=useState(false);const[message,setMessage]=useState(\"\");const[maskedDestination,setMaskedDestination]=useState(\"\");const[ttlSeconds,setTtlSeconds]=useState(null);const[remaining,setRemaining]=useState(null);const[cooldown,setCooldown]=useState(0);const[debugCode,setDebugCode]=useState(\"\");const[searchParams,setSearchParams]=useSearchParams();const confirmQrCode=searchParams.get(\"confirm-qr\")||\"\";const[qrCode,setQrCode]=useState(\"\");const[qrStatus,setQrStatus]=useState(\"\");const[qrConfirming,setQrConfirming]=useState(false);const[qrConfirmed,setQrConfirmed]=useState(false);const token=typeof window!==\"undefined\"?localStorage.getItem(\"aist_token\"):null;const abortRef=useRef(null);const codeInputRef=useRef(null);const qrPollRef=useRef(null);const canRequest=useMemo(()=>{if(busy)return false;if(cooldown>0)return false;return isValidPhone(phoneInput);},[busy,cooldown,phoneInput]);const canVerify=useMemo(()=>{if(busy)return false;if(!agreementAccepted)return false;const d=digitsOnly(code);return d.length>=4&&d.length<=8;},[busy,agreementAccepted,code]);useEffect(()=>{return()=>{if(abortRef.current)abortRef.current.abort();};},[]);useEffect(()=>{if(remaining==null)return;if(remaining<=0)return;const t=setInterval(()=>setRemaining(r=>r==null?r:r-1),1000);return()=>clearInterval(t);},[remaining]);useEffect(()=>{if(cooldown<=0)return;const t=setInterval(()=>setCooldown(c=>c<=0?0:c-1),1000);return()=>clearInterval(t);},[cooldown]);useEffect(()=>{if(step!==\"verify\")return;const t=setTimeout(()=>{var _codeInputRef$current,_codeInputRef$current2;return(_codeInputRef$current=codeInputRef.current)===null||_codeInputRef$current===void 0?void 0:(_codeInputRef$current2=_codeInputRef$current.focus)===null||_codeInputRef$current2===void 0?void 0:_codeInputRef$current2.call(_codeInputRef$current);},50);return()=>clearTimeout(t);},[step]);// QR: запрос кода при открытии вкладки «По QR» (на ПК)\nuseEffect(()=>{if(authMethod!==\"qr\"||confirmQrCode)return;let cancelled=false;(async()=>{try{const res=await fetch(\"\".concat(API_BASE_URL,\"/api/auth/qr/request\"),{method:\"POST\"});const data=await res.json();if(cancelled||!(data!==null&&data!==void 0&&data.code))return;setQrCode(data.code);setQrStatus(\"pending\");}catch(_unused2){setQrStatus(\"error\");}})();return()=>{cancelled=true;};},[authMethod,confirmQrCode]);// QR: опрос готовности (на ПК)\nuseEffect(()=>{if(!qrCode||qrStatus!==\"pending\")return;const poll=async()=>{try{const res=await fetch(\"\".concat(API_BASE_URL,\"/api/auth/qr/check?code=\").concat(encodeURIComponent(qrCode)));const data=await res.json();if((data===null||data===void 0?void 0:data.status)===\"ready\"&&data!==null&&data!==void 0&&data.token){localStorage.setItem(\"aist_token\",data.token);window.location.assign(\"/messenger\");return;}if((data===null||data===void 0?void 0:data.status)===\"expired\")setQrStatus(\"expired\");}catch(_unused3){}};poll();const id=setInterval(poll,2000);qrPollRef.current=id;return()=>clearInterval(id);},[qrCode,qrStatus]);// Сброс опроса при смене вкладки\nuseEffect(()=>{if(authMethod!==\"qr\"){if(qrPollRef.current)clearInterval(qrPollRef.current);}},[authMethod]);async function requestCode(){var _abortRef$current,_abortRef$current$abo;setMessage(\"\");const normalized=normalizePhone(phoneInput);if(!isValidPhone(normalized)){setMessage(\"Введите корректный номер телефона (например, +7 999 123-45-67 или 8 999 123-45-67).\");return;}setBusy(true);(_abortRef$current=abortRef.current)===null||_abortRef$current===void 0?void 0:(_abortRef$current$abo=_abortRef$current.abort)===null||_abortRef$current$abo===void 0?void 0:_abortRef$current$abo.call(_abortRef$current);const controller=new AbortController();abortRef.current=controller;try{const data=await postJson(\"\".concat(API_BASE_URL,\"/api/auth/request-code\"),{phone:normalized},{signal:controller.signal});if((data===null||data===void 0?void 0:data.ok)===false){const errorMsg=(data===null||data===void 0?void 0:data.message)||\"Не удалось отправить код. Попробуйте ещё раз.\";setMessage(errorMsg);if(errorMsg.includes(\"не найден\")||errorMsg.includes(\"активируйте\")){setMessage(errorMsg+\" После активации попробуйте снова.\");}return;}setPhone(normalized);setMaskedDestination((data===null||data===void 0?void 0:data.masked)||\"\");setTtlSeconds(typeof(data===null||data===void 0?void 0:data.ttlSeconds)===\"number\"?data.ttlSeconds:300);setRemaining(typeof(data===null||data===void 0?void 0:data.ttlSeconds)===\"number\"?data.ttlSeconds:300);setCooldown(15);const devCode=(data===null||data===void 0?void 0:data.debugCode)!=null?String(data.debugCode):\"\";setDebugCode(devCode);setCode(devCode);setAgreementAccepted(false);setStep(\"verify\");if(devCode){setMessage(\"Код для входа (режим разработки): введите его ниже или скопируйте.\");}else{setMessage(data!==null&&data!==void 0&&data.masked?\"\\u041A\\u043E\\u0434 \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D \\u0432 Telegram \\u043D\\u0430 \\u043D\\u043E\\u043C\\u0435\\u0440 \".concat(data.masked,\".\"):\"Код отправлен в Telegram-бот @AIST_SMS_BOT. Введите его здесь.\");}}catch(err){if((err===null||err===void 0?void 0:err.name)===\"AbortError\")return;setMessage((err===null||err===void 0?void 0:err.message)||\"Ошибка сети при отправке кода. Проверьте REACT_APP_API_URL и что бэкенд запущен.\");}finally{setBusy(false);}}async function verifyCode(){var _abortRef$current2,_abortRef$current2$ab;setMessage(\"\");const normalizedPhone=normalizePhone(phone);const d=digitsOnly(code);if(!normalizedPhone){setStep(\"request\");setMessage(\"Сначала укажите номер телефона и запросите код.\");return;}if(d.length<4||d.length>8){setMessage(\"Введите код из 4–8 цифр.\");return;}if(!agreementAccepted){setMessage(\"Необходимо принять пользовательское соглашение.\");return;}setBusy(true);(_abortRef$current2=abortRef.current)===null||_abortRef$current2===void 0?void 0:(_abortRef$current2$ab=_abortRef$current2.abort)===null||_abortRef$current2$ab===void 0?void 0:_abortRef$current2$ab.call(_abortRef$current2);const controller=new AbortController();abortRef.current=controller;try{const data=await postJson(\"\".concat(API_BASE_URL,\"/api/auth/verify-code\"),{phone:normalizedPhone,code:d},{signal:controller.signal});if((data===null||data===void 0?void 0:data.ok)===false){const errorMsg=(data===null||data===void 0?void 0:data.message)||\"Неверный код или он истёк. Попробуйте ещё раз.\";if(typeof(data===null||data===void 0?void 0:data.retryAfterSeconds)===\"number\"){const retrySec=Math.max(0,Math.floor(data.retryAfterSeconds));setCooldown(retrySec);setMessage(\"\".concat(errorMsg,\" \\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043C\\u043E\\u0436\\u043D\\u043E \\u0447\\u0435\\u0440\\u0435\\u0437 \").concat(retrySec,\" \\u0441\\u0435\\u043A\\u0443\\u043D\\u0434.\"));}else{setMessage(errorMsg);}return;}const token=data===null||data===void 0?void 0:data.token;if(token){localStorage.setItem(\"aist_token\",token);}window.location.assign(\"/messenger\");}catch(err){if((err===null||err===void 0?void 0:err.name)===\"AbortError\")return;setMessage((err===null||err===void 0?void 0:err.message)||\"Ошибка сети при проверке кода.\");}finally{setBusy(false);}}function onCodeChange(e){const next=digitsOnly(e.target.value).slice(0,8);setCode(next);}const glassStyle=useMemo(()=>({page:{minHeight:\"100vh\",width:\"100vw\",display:\"grid\",placeItems:\"center\",padding:\"20px 0\",margin:0,color:theme.text,background:theme.pageBg,backgroundAttachment:\"fixed\",overflow:\"auto\"},card:{width:\"min(460px, 92vw)\",borderRadius:22,padding:22,background:theme.cardBg,border:\"1px solid \".concat(theme.cardBorder),boxShadow:isDark?\"0 18px 60px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.08)\":\"0 20px 60px rgba(80,120,180,.18), inset 0 1px 0 rgba(255,255,255,.7)\",backdropFilter:\"blur(16px) saturate(140%)\",WebkitBackdropFilter:\"blur(16px) saturate(140%)\",position:\"relative\",overflow:\"hidden\"},shine:{position:\"absolute\",inset:\"-2px\",background:isDark?\"radial-gradient(500px 240px at 20% 10%, rgba(255,255,255,.12), transparent 60%)\":\"radial-gradient(400px 200px at 80% 0%, rgba(255,255,255,.4), transparent 55%)\",pointerEvents:\"none\",mixBlendMode:\"overlay\"},header:{display:\"flex\",gap:12,alignItems:\"center\"},logo:{width:44,height:44,borderRadius:14,background:theme.accent,border:\"1px solid rgba(255,255,255,.35)\",boxShadow:\"0 8px 24px rgba(0,0,0,.2)\",display:\"grid\",placeItems:\"center\",fontWeight:800,fontSize:16,color:theme.accentText,userSelect:\"none\"},titleWrap:{display:\"flex\",flexDirection:\"column\"},title:{margin:0,fontSize:18,fontWeight:700,lineHeight:1.15,color:theme.text},subtitle:{margin:\"6px 0 0\",fontSize:13,color:theme.textMuted,lineHeight:1.25},tabs:{display:\"flex\",gap:8,marginBottom:16,borderBottom:\"1px solid \".concat(theme.border),paddingBottom:12},tab:{padding:\"8px 14px\",borderRadius:12,border:\"none\",background:\"transparent\",color:theme.textMuted,fontSize:14,cursor:\"pointer\"},tabActive:{color:theme.text,background:theme.sidebarBg||theme.cardBg,fontWeight:600},tabDisabled:{opacity:0.5,cursor:\"not-allowed\"},divider:{height:1,background:\"linear-gradient(90deg, transparent, \".concat(theme.border,\", transparent)\"),margin:\"16px 0\"},field:{display:\"grid\",gap:8,marginTop:12},label:{fontSize:12,color:theme.textMuted,display:\"flex\",justifyContent:\"space-between\",gap:12},helper:{fontSize:12,color:theme.textMuted,opacity:0.9},input:{width:\"100%\",padding:\"12px 14px\",borderRadius:14,outline:\"none\",color:theme.text,background:theme.inputBg,border:\"1px solid \".concat(theme.inputBorder),fontSize:14},inputRow:{display:\"grid\",gridTemplateColumns:\"1fr\",gap:10},buttonsRow:{display:\"flex\",gap:10,marginTop:14,flexWrap:\"wrap\"},primaryBtn:{flex:\"1 1 160px\",padding:\"12px 14px\",borderRadius:14,border:\"1px solid rgba(255,255,255,.25)\",color:theme.accentText,background:theme.accent,boxShadow:\"0 10px 30px rgba(0,0,0,.2)\",fontWeight:600,cursor:\"pointer\"},secondaryBtn:{flex:\"1 1 160px\",padding:\"12px 14px\",borderRadius:14,border:\"1px solid \".concat(theme.border),color:theme.text,background:theme.sidebarBg||\"rgba(255,255,255,.08)\",cursor:\"pointer\",fontSize:14},disabled:{opacity:0.55,cursor:\"not-allowed\"},hintBox:{marginTop:12,padding:\"10px 12px\",borderRadius:14,background:theme.sidebarBg||\"rgba(255,255,255,.06)\",border:\"1px solid \".concat(theme.border),color:theme.textMuted,fontSize:13,lineHeight:1.35},agreementRow:{display:\"flex\",alignItems:\"flex-start\",gap:10,marginTop:12,marginBottom:8},agreementLabel:{fontSize:13,color:theme.textMuted,lineHeight:1.4,cursor:\"pointer\"},agreementLink:{color:theme.text,textDecoration:\"underline\",marginLeft:2},footer:{marginTop:14,display:\"flex\",justifyContent:\"space-between\",gap:12,color:theme.textMuted,fontSize:12,flexWrap:\"wrap\"},pill:{padding:\"6px 10px\",borderRadius:999,border:\"1px solid \".concat(theme.border),background:theme.sidebarBg||\"rgba(255,255,255,.06)\"},backLink:{color:theme.textMuted,fontSize:14,marginTop:16,display:\"block\"}}),[theme,isDark]);return/*#__PURE__*/_jsx(\"div\",{style:glassStyle.page,children:/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},glassStyle.card),{},{margin:\"20px\"}),role:\"region\",\"aria-label\":\"AIST \\u0432\\u0445\\u043E\\u0434\",children:[/*#__PURE__*/_jsx(\"div\",{style:glassStyle.shine}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.header,children:[/*#__PURE__*/_jsx(\"div\",{style:glassStyle.logo,\"aria-hidden\":\"true\",children:\"AI\"}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.titleWrap,children:[/*#__PURE__*/_jsx(\"h1\",{style:glassStyle.title,children:\"AIST\"}),/*#__PURE__*/_jsxs(\"p\",{style:glassStyle.subtitle,children:[\"\\u0412\\u0445\\u043E\\u0434 \\u043F\\u043E \\u043A\\u043E\\u0434\\u0443 \\u0438\\u0437 Telegram-\\u0431\\u043E\\u0442\\u0430\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"https://t.me/AIST_SMS_BOT\",target:\"_blank\",rel:\"noopener noreferrer\",style:{color:theme.accent,textDecoration:'none',fontWeight:600},children:\"@AIST_SMS_BOT\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.tabs,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:_objectSpread(_objectSpread({},glassStyle.tab),authMethod===\"telegram\"?glassStyle.tabActive:{}),onClick:()=>setAuthMethod(\"telegram\"),children:\"\\u041F\\u043E \\u043A\\u043E\\u0434\\u0443 \\u0438\\u0437 Telegram\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:_objectSpread(_objectSpread({},glassStyle.tab),authMethod===\"qr\"?glassStyle.tabActive:{}),onClick:()=>setAuthMethod(\"qr\"),children:\"\\u041F\\u043E QR\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",style:_objectSpread(_objectSpread({},glassStyle.tab),glassStyle.tabDisabled),disabled:true,title:\"\\u0421\\u043A\\u043E\\u0440\\u043E\",children:\"\\u041F\\u043E \\u0421\\u041C\\u0421 (\\u0441\\u043A\\u043E\\u0440\\u043E)\"})]}),/*#__PURE__*/_jsx(\"div\",{style:glassStyle.divider}),confirmQrCode?/*#__PURE__*/_jsx(\"div\",{style:glassStyle.field,children:token?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{style:_objectSpread(_objectSpread({},glassStyle.helper),{},{marginBottom:12}),children:\"\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0445\\u043E\\u0434 \\u043D\\u0430 \\u0434\\u0440\\u0443\\u0433\\u043E\\u043C \\u0443\\u0441\\u0442\\u0440\\u043E\\u0439\\u0441\\u0442\\u0432\\u0435 (\\u041F\\u041A). \\u041F\\u043E\\u0441\\u043B\\u0435 \\u043F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u044F \\u0447\\u0430\\u0442\\u044B \\u0441\\u0438\\u043D\\u0445\\u0440\\u043E\\u043D\\u0438\\u0437\\u0438\\u0440\\u0443\\u044E\\u0442\\u0441\\u044F.\"}),qrConfirmed?/*#__PURE__*/_jsx(\"p\",{style:{color:theme.accent,fontWeight:600},children:\"\\u0413\\u043E\\u0442\\u043E\\u0432\\u043E. \\u041C\\u043E\\u0436\\u0435\\u0442\\u0435 \\u0437\\u0430\\u043A\\u0440\\u044B\\u0442\\u044C \\u044D\\u0442\\u0443 \\u0432\\u043A\\u043B\\u0430\\u0434\\u043A\\u0443.\"}):/*#__PURE__*/_jsx(\"button\",{type:\"button\",disabled:qrConfirming,style:glassStyle.primaryBtn,onClick:async()=>{setQrConfirming(true);try{const res=await fetch(\"\".concat(API_BASE_URL,\"/api/auth/qr/confirm\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({code:confirmQrCode})});const data=await res.json();if(data!==null&&data!==void 0&&data.ok)setQrConfirmed(true);else setMessage((data===null||data===void 0?void 0:data.message)||\"Ошибка подтверждения\");}catch(e){setMessage((e===null||e===void 0?void 0:e.message)||\"Ошибка сети\");}setQrConfirming(false);},children:qrConfirming?\"Отправка…\":\"Подтвердить вход на ПК\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"p\",{style:_objectSpread(_objectSpread({},glassStyle.helper),{},{marginBottom:12}),children:\"\\u0421\\u043D\\u0430\\u0447\\u0430\\u043B\\u0430 \\u0432\\u043E\\u0439\\u0434\\u0438\\u0442\\u0435 \\u0432 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442 \\u043D\\u0430 \\u044D\\u0442\\u043E\\u043C \\u0443\\u0441\\u0442\\u0440\\u043E\\u0439\\u0441\\u0442\\u0432\\u0435, \\u0437\\u0430\\u0442\\u0435\\u043C \\u043F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u0435 \\u0432\\u0445\\u043E\\u0434 \\u043D\\u0430 \\u041F\\u041A.\"}),/*#__PURE__*/_jsx(Link,{to:\"/login\",style:glassStyle.link,children:\"\\u041F\\u0435\\u0440\\u0435\\u0439\\u0442\\u0438 \\u043A \\u0432\\u0445\\u043E\\u0434\\u0443\"})]})}):authMethod===\"qr\"?/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.field,children:[/*#__PURE__*/_jsx(\"p\",{style:_objectSpread(_objectSpread({},glassStyle.helper),{},{marginBottom:12}),children:\"\\u041E\\u0442\\u043A\\u0440\\u043E\\u0439\\u0442\\u0435 \\u044D\\u0442\\u0443 \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0443 \\u043D\\u0430 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0435 (\\u0443\\u0436\\u0435 \\u0432\\u043E\\u0439\\u0434\\u044F \\u0432 \\u0430\\u043A\\u043A\\u0430\\u0443\\u043D\\u0442) \\u0438\\u043B\\u0438 \\u043E\\u0442\\u0441\\u043A\\u0430\\u043D\\u0438\\u0440\\u0443\\u0439\\u0442\\u0435 QR \\u043A\\u0430\\u043C\\u0435\\u0440\\u043E\\u0439 \\u2014 \\u0437\\u0430\\u0442\\u0435\\u043C \\u043D\\u0430 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0435 \\u043D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \\xAB\\u041F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0434\\u0438\\u0442\\u044C \\u0432\\u0445\\u043E\\u0434 \\u043D\\u0430 \\u041F\\u041A\\xBB.\"}),qrCode?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:16,background:theme.inputBg,borderRadius:14,display:\"inline-block\",marginBottom:12},children:/*#__PURE__*/_jsx(QRCodeSVG,{value:typeof window!==\"undefined\"?\"\".concat(window.location.origin).concat(window.location.pathname||\"/login\",\"?confirm-qr=\").concat(qrCode):\"\",size:200,level:\"M\"})}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:14,color:theme.textMuted,marginBottom:8},children:[\"\\u041A\\u043E\\u0434: \",/*#__PURE__*/_jsx(\"strong\",{style:{letterSpacing:2},children:qrCode})]}),/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:13,color:theme.textMuted},children:[qrStatus===\"pending\"&&\"Ожидание подтверждения на телефоне…\",qrStatus===\"expired\"&&\"Код истёк. Обновите страницу для нового кода.\",qrStatus===\"error\"&&\"Не удалось получить код. Проверьте связь с сервером.\"]})]}):/*#__PURE__*/_jsx(\"p\",{style:{color:theme.textMuted},children:qrStatus===\"error\"?\"Ошибка загрузки кода\":\"Загрузка кода…\"})]}):null,!confirmQrCode&&authMethod!==\"qr\"&&step===\"request\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.field,children:[/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.label,children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430\"}),/*#__PURE__*/_jsx(\"span\",{style:glassStyle.helper,children:\"\\u043D\\u0430\\u043F\\u0440\\u0438\\u043C\\u0435\\u0440, +7 999 123-45-67\"})]}),/*#__PURE__*/_jsx(\"div\",{style:glassStyle.inputRow,children:/*#__PURE__*/_jsx(\"input\",{style:glassStyle.input,inputMode:\"tel\",autoComplete:\"tel\",placeholder:\"+7 999 123-45-67\",value:phoneInput,onChange:e=>setPhoneInput(e.target.value),onKeyDown:e=>{if(e.key===\"Enter\")requestCode();},\"aria-label\":\"\\u041D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430\"})})]}),/*#__PURE__*/_jsx(\"div\",{style:glassStyle.buttonsRow,children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:requestCode,disabled:!canRequest,style:_objectSpread(_objectSpread({},glassStyle.primaryBtn),!canRequest?glassStyle.disabled:null),children:busy?\"Отправляем…\":cooldown>0?\"\\u041F\\u043E\\u0434\\u043E\\u0436\\u0434\\u0438\\u0442\\u0435 \".concat(cooldown,\"\\u0441\"):\"Получить код\"})}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.hintBox,children:[/*#__PURE__*/_jsx(\"b\",{children:\"\\u0412\\u0430\\u0436\\u043D\\u043E:\"}),\" \\u0421\\u043D\\u0430\\u0447\\u0430\\u043B\\u0430 \\u043E\\u0442\\u043A\\u0440\\u043E\\u0439\\u0442\\u0435 \\u0431\\u043E\\u0442\\u0430 \\u0432 Telegram \\u0438 \\u0430\\u043A\\u0442\\u0438\\u0432\\u0438\\u0440\\u0443\\u0439\\u0442\\u0435 \\u043D\\u043E\\u043C\\u0435\\u0440:\",/*#__PURE__*/_jsx(\"br\",{}),\"1. \\u041D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435:\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"https://t.me/AIST_SMS_BOT\",target:\"_blank\",rel:\"noopener noreferrer\",style:{color:theme.accent,fontWeight:600},children:\"\\u041E\\u0442\\u043A\\u0440\\u044B\\u0442\\u044C \\u0431\\u043E\\u0442\\u0430 @AIST_SMS_BOT\"}),/*#__PURE__*/_jsx(\"br\",{}),\"2. \\u0412 \\u0431\\u043E\\u0442\\u0435 \\u043D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \",/*#__PURE__*/_jsx(\"b\",{children:\"/start\"}),/*#__PURE__*/_jsx(\"br\",{}),\"3. \\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u044C\\u0442\\u0435 \\u043D\\u043E\\u043C\\u0435\\u0440 \\u0442\\u0435\\u043B\\u0435\\u0444\\u043E\\u043D\\u0430 \\u0447\\u0435\\u0440\\u0435\\u0437 \\u043A\\u043D\\u043E\\u043F\\u043A\\u0443 \\u0432 \\u0431\\u043E\\u0442\\u0435\",/*#__PURE__*/_jsx(\"br\",{}),\"4. \\u0417\\u0430\\u0442\\u0435\\u043C \\u0432\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043D\\u043E\\u043C\\u0435\\u0440 \\u0437\\u0434\\u0435\\u0441\\u044C \\u0438 \\u043D\\u0430\\u0436\\u043C\\u0438\\u0442\\u0435 \\xAB\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043A\\u043E\\u0434\\xBB\"]})]}),!confirmQrCode&&authMethod!==\"qr\"&&step===\"verify\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[debugCode&&/*#__PURE__*/_jsxs(\"div\",{style:_objectSpread(_objectSpread({},glassStyle.field),{},{padding:\"12px 16px\",borderRadius:12,background:\"rgba(0,136,204,0.12)\",marginBottom:8}),children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:14,color:theme.textMuted,marginBottom:4},children:\"\\u041A\\u043E\\u0434 \\u0434\\u043B\\u044F \\u0432\\u0445\\u043E\\u0434\\u0430 (\\u0442\\u043E\\u043B\\u044C\\u043A\\u043E \\u0434\\u043B\\u044F \\u0442\\u0435\\u0441\\u0442\\u0430)\"}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:20,fontWeight:700,letterSpacing:4},children:debugCode})]}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.field,children:[/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.label,children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u041A\\u043E\\u0434 \\u0438\\u0437 Telegram\"}),/*#__PURE__*/_jsxs(\"span\",{style:glassStyle.helper,children:[\"\\u0434\\u043B\\u044F \",formatPhone(phone)]})]}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.agreementRow,children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"agreement\",checked:agreementAccepted,onChange:e=>setAgreementAccepted(e.target.checked),style:{marginTop:4,cursor:\"pointer\"},\"aria-describedby\":\"agreement-text\"}),/*#__PURE__*/_jsxs(\"label\",{id:\"agreement-text\",htmlFor:\"agreement\",style:glassStyle.agreementLabel,children:[\"\\u042F \\u043F\\u0440\\u0438\\u043D\\u0438\\u043C\\u0430\\u044E\",\" \",/*#__PURE__*/_jsx(\"a\",{href:USER_AGREEMENT_URL,target:\"_blank\",rel:\"noopener noreferrer\",style:glassStyle.agreementLink,children:\"\\u043F\\u043E\\u043B\\u044C\\u0437\\u043E\\u0432\\u0430\\u0442\\u0435\\u043B\\u044C\\u0441\\u043A\\u043E\\u0435 \\u0441\\u043E\\u0433\\u043B\\u0430\\u0448\\u0435\\u043D\\u0438\\u0435\"}),\" \",\"\\u0438 \\u0443\\u0441\\u043B\\u043E\\u0432\\u0438\\u044F \\u043E\\u0431\\u0440\\u0430\\u0431\\u043E\\u0442\\u043A\\u0438 \\u043F\\u0435\\u0440\\u0441\\u043E\\u043D\\u0430\\u043B\\u044C\\u043D\\u044B\\u0445 \\u0434\\u0430\\u043D\\u043D\\u044B\\u0445 (\\u0432 \\u0441\\u043E\\u043E\\u0442\\u0432\\u0435\\u0442\\u0441\\u0442\\u0432\\u0438\\u0438 \\u0441 \\u0437\\u0430\\u043A\\u043E\\u043D\\u043E\\u0434\\u0430\\u0442\\u0435\\u043B\\u044C\\u0441\\u0442\\u0432\\u043E\\u043C \\u0420\\u0424).\"]})]}),/*#__PURE__*/_jsx(\"input\",{ref:codeInputRef,style:glassStyle.input,inputMode:\"numeric\",autoComplete:\"one-time-code\",placeholder:\"\\u0412\\u0432\\u0435\\u0434\\u0438\\u0442\\u0435 \\u043A\\u043E\\u0434\",value:code,onChange:onCodeChange,onKeyDown:e=>{if(e.key===\"Enter\")verifyCode();},\"aria-label\":\"\\u041A\\u043E\\u0434 \\u043F\\u043E\\u0434\\u0442\\u0432\\u0435\\u0440\\u0436\\u0434\\u0435\\u043D\\u0438\\u044F\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.buttonsRow,children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:verifyCode,disabled:!canVerify,style:_objectSpread(_objectSpread({},glassStyle.primaryBtn),!canVerify?glassStyle.disabled:null),children:busy?\"Проверяем…\":\"Войти\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>{setStep(\"request\");setPhoneInput(phone);setMessage(\"\");},disabled:busy,style:_objectSpread(_objectSpread({},glassStyle.secondaryBtn),busy?glassStyle.disabled:null),children:\"\\u0418\\u0437\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C \\u043D\\u043E\\u043C\\u0435\\u0440\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:requestCode,disabled:busy||cooldown>0,style:_objectSpread(_objectSpread({},glassStyle.secondaryBtn),busy||cooldown>0?glassStyle.disabled:null),title:cooldown>0?\"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u043C\\u043E\\u0436\\u043D\\u043E \\u0447\\u0435\\u0440\\u0435\\u0437 \".concat(cooldown,\"\\u0441\"):\"Отправить новый код\",children:cooldown>0?\"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u044C \\u0447\\u0435\\u0440\\u0435\\u0437 \".concat(cooldown,\"\\u0441\"):\"Отправить ещё раз\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:glassStyle.footer,children:[/*#__PURE__*/_jsx(\"span\",{style:glassStyle.pill,children:maskedDestination?\"\\u0414\\u043E\\u0441\\u0442\\u0430\\u0432\\u043A\\u0430: \".concat(maskedDestination):\"Доставка: @AIST_SMS_BOT\"}),/*#__PURE__*/_jsx(\"span\",{style:glassStyle.pill,children:remaining==null?ttlSeconds?\"\\u0421\\u0440\\u043E\\u043A: ~\".concat(ttlSeconds,\"\\u0441\"):\"Срок: 5 минут\":remaining>0?\"\\u0418\\u0441\\u0442\\u0435\\u043A\\u0430\\u0435\\u0442 \\u0447\\u0435\\u0440\\u0435\\u0437: \".concat(remaining,\"\\u0441\"):\"Код истёк — запросите новый\"})]})]}),message?/*#__PURE__*/_jsx(\"div\",{style:glassStyle.hintBox,role:\"status\",\"aria-live\":\"polite\",children:message}):null,/*#__PURE__*/_jsx(Link,{to:\"/\",style:glassStyle.backLink,children:\"\\u2190 \\u041D\\u0430 \\u0433\\u043B\\u0430\\u0432\\u043D\\u0443\\u044E\"})]})});}","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","Link","useSearchParams","QRCodeSVG","useTheme","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE_URL","process","env","REACT_APP_API_URL","window","_window$location","location","hostname","USER_AGREEMENT_URL","normalizePhone","input","digitsOnly","String","replace","length","startsWith","substring","isValidPhone","value","normalized","test","formatPhone","postJson","url","body","_json","signal","arguments","undefined","res","fetch","method","headers","JSON","stringify","e","name","msg","message","includes","Error","json","_unused","ok","error","concat","status","statusText","trim","err","payload","Register","theme","isDark","authMethod","setAuthMethod","step","setStep","phoneInput","setPhoneInput","phone","setPhone","code","setCode","agreementAccepted","setAgreementAccepted","busy","setBusy","setMessage","maskedDestination","setMaskedDestination","ttlSeconds","setTtlSeconds","remaining","setRemaining","cooldown","setCooldown","debugCode","setDebugCode","searchParams","setSearchParams","confirmQrCode","get","qrCode","setQrCode","qrStatus","setQrStatus","qrConfirming","setQrConfirming","qrConfirmed","setQrConfirmed","token","localStorage","getItem","abortRef","codeInputRef","qrPollRef","canRequest","canVerify","d","current","abort","t","setInterval","r","clearInterval","c","setTimeout","_codeInputRef$current","_codeInputRef$current2","focus","call","clearTimeout","cancelled","data","_unused2","poll","encodeURIComponent","setItem","assign","_unused3","id","requestCode","_abortRef$current","_abortRef$current$abo","controller","AbortController","errorMsg","masked","devCode","verifyCode","_abortRef$current2","_abortRef$current2$ab","normalizedPhone","retryAfterSeconds","retrySec","Math","max","floor","onCodeChange","next","target","slice","glassStyle","page","minHeight","width","display","placeItems","padding","margin","color","text","background","pageBg","backgroundAttachment","overflow","card","borderRadius","cardBg","border","cardBorder","boxShadow","backdropFilter","WebkitBackdropFilter","position","shine","inset","pointerEvents","mixBlendMode","header","gap","alignItems","logo","height","accent","fontWeight","fontSize","accentText","userSelect","titleWrap","flexDirection","title","lineHeight","subtitle","textMuted","tabs","marginBottom","borderBottom","paddingBottom","tab","cursor","tabActive","sidebarBg","tabDisabled","opacity","divider","field","marginTop","label","justifyContent","helper","outline","inputBg","inputBorder","inputRow","gridTemplateColumns","buttonsRow","flexWrap","primaryBtn","flex","secondaryBtn","disabled","hintBox","agreementRow","agreementLabel","agreementLink","textDecoration","marginLeft","footer","pill","backLink","style","children","_objectSpread","role","href","rel","type","onClick","Authorization","to","link","origin","pathname","size","level","letterSpacing","inputMode","autoComplete","placeholder","onChange","onKeyDown","key","checked","htmlFor","ref"],"sources":["C:/Users/Vladislav/Documents/GitHub/aist-messenger/src/pages/Register.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\r\nimport { Link, useSearchParams } from \"react-router-dom\";\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\nimport { useTheme } from \"../context/ThemeContext\";\r\n\r\n/**\r\n * AIST PWA Messenger — Register/Login screen\r\n * Вход по коду из Telegram или (в будущем) по СМС. При входе по коду из ТГ — пользовательское соглашение (законы РФ).\r\n */\r\n\r\nconst API_BASE_URL = process.env.REACT_APP_API_URL || (typeof window !== \"undefined\" && window.location?.hostname === \"localhost\" ? \"http://localhost:3001\" : \"https://api.get-aist.ru\");\r\n\r\nconst USER_AGREEMENT_URL = \"/user-agreement\";\r\n\r\nfunction normalizePhone(input) {\r\n  if (!input) return \"\";\r\n  const digitsOnly = String(input).replace(/\\D/g, \"\");\r\n  \r\n  if (digitsOnly.length === 11 && digitsOnly.startsWith(\"7\")) {\r\n    return \"+\" + digitsOnly;\r\n  } else if (digitsOnly.length === 10) {\r\n    return \"+7\" + digitsOnly;\r\n  } else if (digitsOnly.length === 11 && digitsOnly.startsWith(\"8\")) {\r\n    return \"+7\" + digitsOnly.substring(1);\r\n  }\r\n  return \"\";\r\n}\r\n\r\nfunction isValidPhone(value) {\r\n  const normalized = normalizePhone(value);\r\n  if (!normalized) return false;\r\n  return /^\\+7\\d{10}$/.test(normalized);\r\n}\r\n\r\nfunction formatPhone(value) {\r\n  const normalized = normalizePhone(value);\r\n  if (!normalized) return value;\r\n  return normalized.replace(/^(\\+7)(\\d{3})(\\d{3})(\\d{2})(\\d{2})$/, \"$1 ($2) $3-$4-$5\");\r\n}\r\n\r\nfunction digitsOnly(value) {\r\n  return String(value ?? \"\").replace(/\\D+/g, \"\");\r\n}\r\n\r\nasync function postJson(url, body, { signal } = {}) {\r\n  let res;\r\n  try {\r\n    res = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(body ?? {}),\r\n      signal,\r\n    });\r\n  } catch (e) {\r\n    if (e.name === \"AbortError\") throw e;\r\n    const msg = e.message || \"\";\r\n    if (msg.includes(\"Failed to fetch\") || msg.includes(\"Load failed\") || msg.includes(\"NetworkError\")) {\r\n      throw new Error(\"Нет связи с сервером. Проверьте интернет и что бэкенд запущен (например http://localhost:3001). В .env задайте REACT_APP_API_URL.\");\r\n    }\r\n    throw new Error(msg || \"Ошибка сети\");\r\n  }\r\n\r\n  let json = null;\r\n  try {\r\n    json = await res.json();\r\n  } catch {\r\n    // ignore\r\n  }\r\n\r\n  if (!res.ok) {\r\n    const message =\r\n      (json && (json.message || json.error)) ||\r\n      `HTTP ${res.status} ${res.statusText}`.trim();\r\n    const err = new Error(message);\r\n    err.status = res.status;\r\n    err.payload = json;\r\n    throw err;\r\n  }\r\n\r\n  return json ?? {};\r\n}\r\n\r\nexport default function Register() {\r\n  const { theme, isDark } = useTheme();\r\n  const [authMethod, setAuthMethod] = useState(\"telegram\"); // 'telegram' | 'sms' (sms пока заглушка)\r\n  const [step, setStep] = useState(\"request\");\r\n  const [phoneInput, setPhoneInput] = useState(\"\");\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [code, setCode] = useState(\"\");\r\n  const [agreementAccepted, setAgreementAccepted] = useState(false);\r\n  const [busy, setBusy] = useState(false);\r\n  const [message, setMessage] = useState(\"\");\r\n  const [maskedDestination, setMaskedDestination] = useState(\"\");\r\n  const [ttlSeconds, setTtlSeconds] = useState(null);\r\n  const [remaining, setRemaining] = useState(null);\r\n  const [cooldown, setCooldown] = useState(0);\r\n  const [debugCode, setDebugCode] = useState(\"\");\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  const confirmQrCode = searchParams.get(\"confirm-qr\") || \"\";\r\n  const [qrCode, setQrCode] = useState(\"\");\r\n  const [qrStatus, setQrStatus] = useState(\"\");\r\n  const [qrConfirming, setQrConfirming] = useState(false);\r\n  const [qrConfirmed, setQrConfirmed] = useState(false);\r\n  const token = typeof window !== \"undefined\" ? localStorage.getItem(\"aist_token\") : null;\r\n\r\n  const abortRef = useRef(null);\r\n  const codeInputRef = useRef(null);\r\n  const qrPollRef = useRef(null);\r\n\r\n  const canRequest = useMemo(() => {\r\n    if (busy) return false;\r\n    if (cooldown > 0) return false;\r\n    return isValidPhone(phoneInput);\r\n  }, [busy, cooldown, phoneInput]);\r\n\r\n  const canVerify = useMemo(() => {\r\n    if (busy) return false;\r\n    if (!agreementAccepted) return false;\r\n    const d = digitsOnly(code);\r\n    return d.length >= 4 && d.length <= 8;\r\n  }, [busy, agreementAccepted, code]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (abortRef.current) abortRef.current.abort();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (remaining == null) return;\r\n    if (remaining <= 0) return;\r\n    const t = setInterval(() => setRemaining((r) => (r == null ? r : r - 1)), 1000);\r\n    return () => clearInterval(t);\r\n  }, [remaining]);\r\n\r\n  useEffect(() => {\r\n    if (cooldown <= 0) return;\r\n    const t = setInterval(() => setCooldown((c) => (c <= 0 ? 0 : c - 1)), 1000);\r\n    return () => clearInterval(t);\r\n  }, [cooldown]);\r\n\r\n  useEffect(() => {\r\n    if (step !== \"verify\") return;\r\n    const t = setTimeout(() => codeInputRef.current?.focus?.(), 50);\r\n    return () => clearTimeout(t);\r\n  }, [step]);\r\n\r\n  // QR: запрос кода при открытии вкладки «По QR» (на ПК)\r\n  useEffect(() => {\r\n    if (authMethod !== \"qr\" || confirmQrCode) return;\r\n    let cancelled = false;\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(`${API_BASE_URL}/api/auth/qr/request`, { method: \"POST\" });\r\n        const data = await res.json();\r\n        if (cancelled || !data?.code) return;\r\n        setQrCode(data.code);\r\n        setQrStatus(\"pending\");\r\n      } catch {\r\n        setQrStatus(\"error\");\r\n      }\r\n    })();\r\n    return () => { cancelled = true; };\r\n  }, [authMethod, confirmQrCode]);\r\n\r\n  // QR: опрос готовности (на ПК)\r\n  useEffect(() => {\r\n    if (!qrCode || qrStatus !== \"pending\") return;\r\n    const poll = async () => {\r\n      try {\r\n        const res = await fetch(`${API_BASE_URL}/api/auth/qr/check?code=${encodeURIComponent(qrCode)}`);\r\n        const data = await res.json();\r\n        if (data?.status === \"ready\" && data?.token) {\r\n          localStorage.setItem(\"aist_token\", data.token);\r\n          window.location.assign(\"/messenger\");\r\n          return;\r\n        }\r\n        if (data?.status === \"expired\") setQrStatus(\"expired\");\r\n      } catch {}\r\n    };\r\n    poll();\r\n    const id = setInterval(poll, 2000);\r\n    qrPollRef.current = id;\r\n    return () => clearInterval(id);\r\n  }, [qrCode, qrStatus]);\r\n\r\n  // Сброс опроса при смене вкладки\r\n  useEffect(() => {\r\n    if (authMethod !== \"qr\") {\r\n      if (qrPollRef.current) clearInterval(qrPollRef.current);\r\n    }\r\n  }, [authMethod]);\r\n\r\n  async function requestCode() {\r\n    setMessage(\"\");\r\n    const normalized = normalizePhone(phoneInput);\r\n    if (!isValidPhone(normalized)) {\r\n      setMessage(\"Введите корректный номер телефона (например, +7 999 123-45-67 или 8 999 123-45-67).\");\r\n      return;\r\n    }\r\n\r\n    setBusy(true);\r\n    abortRef.current?.abort?.();\r\n    const controller = new AbortController();\r\n    abortRef.current = controller;\r\n\r\n    try {\r\n      const data = await postJson(\r\n        `${API_BASE_URL}/api/auth/request-code`,\r\n        { phone: normalized },\r\n        { signal: controller.signal }\r\n      );\r\n\r\n      if (data?.ok === false) {\r\n        const errorMsg = data?.message || \"Не удалось отправить код. Попробуйте ещё раз.\";\r\n        setMessage(errorMsg);\r\n        if (errorMsg.includes(\"не найден\") || errorMsg.includes(\"активируйте\")) {\r\n          setMessage(errorMsg + \" После активации попробуйте снова.\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      setPhone(normalized);\r\n      setMaskedDestination(data?.masked || \"\");\r\n      setTtlSeconds(typeof data?.ttlSeconds === \"number\" ? data.ttlSeconds : 300);\r\n      setRemaining(typeof data?.ttlSeconds === \"number\" ? data.ttlSeconds : 300);\r\n      setCooldown(15);\r\n      const devCode = data?.debugCode != null ? String(data.debugCode) : \"\";\r\n      setDebugCode(devCode);\r\n      setCode(devCode);\r\n      setAgreementAccepted(false);\r\n      setStep(\"verify\");\r\n      if (devCode) {\r\n        setMessage(\"Код для входа (режим разработки): введите его ниже или скопируйте.\");\r\n      } else {\r\n        setMessage(\r\n          data?.masked\r\n            ? `Код отправлен в Telegram на номер ${data.masked}.`\r\n            : \"Код отправлен в Telegram-бот @AIST_SMS_BOT. Введите его здесь.\"\r\n        );\r\n      }\r\n    } catch (err) {\r\n      if (err?.name === \"AbortError\") return;\r\n      setMessage(err?.message || \"Ошибка сети при отправке кода. Проверьте REACT_APP_API_URL и что бэкенд запущен.\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  async function verifyCode() {\r\n    setMessage(\"\");\r\n    const normalizedPhone = normalizePhone(phone);\r\n    const d = digitsOnly(code);\r\n    if (!normalizedPhone) {\r\n      setStep(\"request\");\r\n      setMessage(\"Сначала укажите номер телефона и запросите код.\");\r\n      return;\r\n    }\r\n    if (d.length < 4 || d.length > 8) {\r\n      setMessage(\"Введите код из 4–8 цифр.\");\r\n      return;\r\n    }\r\n    if (!agreementAccepted) {\r\n      setMessage(\"Необходимо принять пользовательское соглашение.\");\r\n      return;\r\n    }\r\n\r\n    setBusy(true);\r\n    abortRef.current?.abort?.();\r\n    const controller = new AbortController();\r\n    abortRef.current = controller;\r\n\r\n    try {\r\n      const data = await postJson(\r\n        `${API_BASE_URL}/api/auth/verify-code`,\r\n        { phone: normalizedPhone, code: d },\r\n        { signal: controller.signal }\r\n      );\r\n\r\n      if (data?.ok === false) {\r\n        const errorMsg = data?.message || \"Неверный код или он истёк. Попробуйте ещё раз.\";\r\n        if (typeof data?.retryAfterSeconds === \"number\") {\r\n          const retrySec = Math.max(0, Math.floor(data.retryAfterSeconds));\r\n          setCooldown(retrySec);\r\n          setMessage(`${errorMsg} Повторить можно через ${retrySec} секунд.`);\r\n        } else {\r\n          setMessage(errorMsg);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const token = data?.token;\r\n      if (token) {\r\n        localStorage.setItem(\"aist_token\", token);\r\n      }\r\n\r\n      window.location.assign(\"/messenger\");\r\n    } catch (err) {\r\n      if (err?.name === \"AbortError\") return;\r\n      setMessage(err?.message || \"Ошибка сети при проверке кода.\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  }\r\n\r\n  function onCodeChange(e) {\r\n    const next = digitsOnly(e.target.value).slice(0, 8);\r\n    setCode(next);\r\n  }\r\n\r\n  const glassStyle = useMemo(\r\n    () => ({\r\n      page: {\r\n        minHeight: \"100vh\",\r\n        width: \"100vw\",\r\n        display: \"grid\",\r\n        placeItems: \"center\",\r\n        padding: \"20px 0\",\r\n        margin: 0,\r\n        color: theme.text,\r\n        background: theme.pageBg,\r\n        backgroundAttachment: \"fixed\",\r\n        overflow: \"auto\",\r\n      },\r\n      card: {\r\n        width: \"min(460px, 92vw)\",\r\n        borderRadius: 22,\r\n        padding: 22,\r\n        background: theme.cardBg,\r\n        border: `1px solid ${theme.cardBorder}`,\r\n        boxShadow: isDark\r\n          ? \"0 18px 60px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.08)\"\r\n          : \"0 20px 60px rgba(80,120,180,.18), inset 0 1px 0 rgba(255,255,255,.7)\",\r\n        backdropFilter: \"blur(16px) saturate(140%)\",\r\n        WebkitBackdropFilter: \"blur(16px) saturate(140%)\",\r\n        position: \"relative\",\r\n        overflow: \"hidden\",\r\n      },\r\n      shine: {\r\n        position: \"absolute\",\r\n        inset: \"-2px\",\r\n        background: isDark\r\n          ? \"radial-gradient(500px 240px at 20% 10%, rgba(255,255,255,.12), transparent 60%)\"\r\n          : \"radial-gradient(400px 200px at 80% 0%, rgba(255,255,255,.4), transparent 55%)\",\r\n        pointerEvents: \"none\",\r\n        mixBlendMode: \"overlay\",\r\n      },\r\n      header: { display: \"flex\", gap: 12, alignItems: \"center\" },\r\n      logo: {\r\n        width: 44,\r\n        height: 44,\r\n        borderRadius: 14,\r\n        background: theme.accent,\r\n        border: \"1px solid rgba(255,255,255,.35)\",\r\n        boxShadow: \"0 8px 24px rgba(0,0,0,.2)\",\r\n        display: \"grid\",\r\n        placeItems: \"center\",\r\n        fontWeight: 800,\r\n        fontSize: 16,\r\n        color: theme.accentText,\r\n        userSelect: \"none\",\r\n      },\r\n      titleWrap: { display: \"flex\", flexDirection: \"column\" },\r\n      title: { margin: 0, fontSize: 18, fontWeight: 700, lineHeight: 1.15, color: theme.text },\r\n      subtitle: { margin: \"6px 0 0\", fontSize: 13, color: theme.textMuted, lineHeight: 1.25 },\r\n      tabs: {\r\n        display: \"flex\",\r\n        gap: 8,\r\n        marginBottom: 16,\r\n        borderBottom: `1px solid ${theme.border}`,\r\n        paddingBottom: 12,\r\n      },\r\n      tab: {\r\n        padding: \"8px 14px\",\r\n        borderRadius: 12,\r\n        border: \"none\",\r\n        background: \"transparent\",\r\n        color: theme.textMuted,\r\n        fontSize: 14,\r\n        cursor: \"pointer\",\r\n      },\r\n      tabActive: { color: theme.text, background: theme.sidebarBg || theme.cardBg, fontWeight: 600 },\r\n      tabDisabled: { opacity: 0.5, cursor: \"not-allowed\" },\r\n      divider: {\r\n        height: 1,\r\n        background: `linear-gradient(90deg, transparent, ${theme.border}, transparent)`,\r\n        margin: \"16px 0\",\r\n      },\r\n      field: { display: \"grid\", gap: 8, marginTop: 12 },\r\n      label: { fontSize: 12, color: theme.textMuted, display: \"flex\", justifyContent: \"space-between\", gap: 12 },\r\n      helper: { fontSize: 12, color: theme.textMuted, opacity: 0.9 },\r\n      input: {\r\n        width: \"100%\",\r\n        padding: \"12px 14px\",\r\n        borderRadius: 14,\r\n        outline: \"none\",\r\n        color: theme.text,\r\n        background: theme.inputBg,\r\n        border: `1px solid ${theme.inputBorder}`,\r\n        fontSize: 14,\r\n      },\r\n      inputRow: { display: \"grid\", gridTemplateColumns: \"1fr\", gap: 10 },\r\n      buttonsRow: { display: \"flex\", gap: 10, marginTop: 14, flexWrap: \"wrap\" },\r\n      primaryBtn: {\r\n        flex: \"1 1 160px\",\r\n        padding: \"12px 14px\",\r\n        borderRadius: 14,\r\n        border: \"1px solid rgba(255,255,255,.25)\",\r\n        color: theme.accentText,\r\n        background: theme.accent,\r\n        boxShadow: \"0 10px 30px rgba(0,0,0,.2)\",\r\n        fontWeight: 600,\r\n        cursor: \"pointer\",\r\n      },\r\n      secondaryBtn: {\r\n        flex: \"1 1 160px\",\r\n        padding: \"12px 14px\",\r\n        borderRadius: 14,\r\n        border: `1px solid ${theme.border}`,\r\n        color: theme.text,\r\n        background: theme.sidebarBg || \"rgba(255,255,255,.08)\",\r\n        cursor: \"pointer\",\r\n        fontSize: 14,\r\n      },\r\n      disabled: { opacity: 0.55, cursor: \"not-allowed\" },\r\n      hintBox: {\r\n        marginTop: 12,\r\n        padding: \"10px 12px\",\r\n        borderRadius: 14,\r\n        background: theme.sidebarBg || \"rgba(255,255,255,.06)\",\r\n        border: `1px solid ${theme.border}`,\r\n        color: theme.textMuted,\r\n        fontSize: 13,\r\n        lineHeight: 1.35,\r\n      },\r\n      agreementRow: {\r\n        display: \"flex\",\r\n        alignItems: \"flex-start\",\r\n        gap: 10,\r\n        marginTop: 12,\r\n        marginBottom: 8,\r\n      },\r\n      agreementLabel: { fontSize: 13, color: theme.textMuted, lineHeight: 1.4, cursor: \"pointer\" },\r\n      agreementLink: { color: theme.text, textDecoration: \"underline\", marginLeft: 2 },\r\n      footer: {\r\n        marginTop: 14,\r\n        display: \"flex\",\r\n        justifyContent: \"space-between\",\r\n        gap: 12,\r\n        color: theme.textMuted,\r\n        fontSize: 12,\r\n        flexWrap: \"wrap\",\r\n      },\r\n      pill: {\r\n        padding: \"6px 10px\",\r\n        borderRadius: 999,\r\n        border: `1px solid ${theme.border}`,\r\n        background: theme.sidebarBg || \"rgba(255,255,255,.06)\",\r\n      },\r\n      backLink: { color: theme.textMuted, fontSize: 14, marginTop: 16, display: \"block\" },\r\n    }),\r\n    [theme, isDark]\r\n  );\r\n\r\n  return (\r\n    <div style={glassStyle.page}>\r\n      <div style={{ ...glassStyle.card, margin: \"20px\" }} role=\"region\" aria-label=\"AIST вход\">\r\n        <div style={glassStyle.shine} />\r\n\r\n        <div style={glassStyle.header}>\r\n          <div style={glassStyle.logo} aria-hidden=\"true\">\r\n            AI\r\n          </div>\r\n          <div style={glassStyle.titleWrap}>\r\n            <h1 style={glassStyle.title}>AIST</h1>\r\n            <p style={glassStyle.subtitle}>\r\n              Вход по коду из Telegram-бота{\" \"}\r\n              <a href=\"https://t.me/AIST_SMS_BOT\" target=\"_blank\" rel=\"noopener noreferrer\" style={{ color: theme.accent, textDecoration: 'none', fontWeight: 600 }}>\r\n                @AIST_SMS_BOT\r\n              </a>\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        <div style={glassStyle.tabs}>\r\n          <button\r\n            type=\"button\"\r\n            style={{\r\n              ...glassStyle.tab,\r\n              ...(authMethod === \"telegram\" ? glassStyle.tabActive : {}),\r\n            }}\r\n            onClick={() => setAuthMethod(\"telegram\")}\r\n          >\r\n            По коду из Telegram\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            style={{\r\n              ...glassStyle.tab,\r\n              ...(authMethod === \"qr\" ? glassStyle.tabActive : {}),\r\n            }}\r\n            onClick={() => setAuthMethod(\"qr\")}\r\n          >\r\n            По QR\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            style={{ ...glassStyle.tab, ...glassStyle.tabDisabled }}\r\n            disabled\r\n            title=\"Скоро\"\r\n          >\r\n            По СМС (скоро)\r\n          </button>\r\n        </div>\r\n        <div style={glassStyle.divider} />\r\n\r\n        {confirmQrCode ? (\r\n          <div style={glassStyle.field}>\r\n            {token ? (\r\n              <>\r\n                <p style={{ ...glassStyle.helper, marginBottom: 12 }}>\r\n                  Подтвердите вход на другом устройстве (ПК). После подтверждения чаты синхронизируются.\r\n                </p>\r\n                {qrConfirmed ? (\r\n                  <p style={{ color: theme.accent, fontWeight: 600 }}>Готово. Можете закрыть эту вкладку.</p>\r\n                ) : (\r\n                  <button\r\n                    type=\"button\"\r\n                    disabled={qrConfirming}\r\n                    style={glassStyle.primaryBtn}\r\n                    onClick={async () => {\r\n                      setQrConfirming(true);\r\n                      try {\r\n                        const res = await fetch(`${API_BASE_URL}/api/auth/qr/confirm`, {\r\n                          method: \"POST\",\r\n                          headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${token}` },\r\n                          body: JSON.stringify({ code: confirmQrCode }),\r\n                        });\r\n                        const data = await res.json();\r\n                        if (data?.ok) setQrConfirmed(true);\r\n                        else setMessage(data?.message || \"Ошибка подтверждения\");\r\n                      } catch (e) {\r\n                        setMessage(e?.message || \"Ошибка сети\");\r\n                      }\r\n                      setQrConfirming(false);\r\n                    }}\r\n                  >\r\n                    {qrConfirming ? \"Отправка…\" : \"Подтвердить вход на ПК\"}\r\n                  </button>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <>\r\n                <p style={{ ...glassStyle.helper, marginBottom: 12 }}>\r\n                  Сначала войдите в аккаунт на этом устройстве, затем подтвердите вход на ПК.\r\n                </p>\r\n                <Link to=\"/login\" style={glassStyle.link}>Перейти к входу</Link>\r\n              </>\r\n            )}\r\n          </div>\r\n        ) : authMethod === \"qr\" ? (\r\n          <div style={glassStyle.field}>\r\n            <p style={{ ...glassStyle.helper, marginBottom: 12 }}>\r\n              Откройте эту страницу на телефоне (уже войдя в аккаунт) или отсканируйте QR камерой — затем на телефоне нажмите «Подтвердить вход на ПК».\r\n            </p>\r\n            {qrCode ? (\r\n              <>\r\n                <div style={{ padding: 16, background: theme.inputBg, borderRadius: 14, display: \"inline-block\", marginBottom: 12 }}>\r\n                  <QRCodeSVG\r\n                    value={typeof window !== \"undefined\" ? `${window.location.origin}${window.location.pathname || \"/login\"}?confirm-qr=${qrCode}` : \"\"}\r\n                    size={200}\r\n                    level=\"M\"\r\n                  />\r\n                </div>\r\n                <p style={{ fontSize: 14, color: theme.textMuted, marginBottom: 8 }}>Код: <strong style={{ letterSpacing: 2 }}>{qrCode}</strong></p>\r\n                <p style={{ fontSize: 13, color: theme.textMuted }}>\r\n                  {qrStatus === \"pending\" && \"Ожидание подтверждения на телефоне…\"}\r\n                  {qrStatus === \"expired\" && \"Код истёк. Обновите страницу для нового кода.\"}\r\n                  {qrStatus === \"error\" && \"Не удалось получить код. Проверьте связь с сервером.\"}\r\n                </p>\r\n              </>\r\n            ) : (\r\n              <p style={{ color: theme.textMuted }}>{qrStatus === \"error\" ? \"Ошибка загрузки кода\" : \"Загрузка кода…\"}</p>\r\n            )}\r\n          </div>\r\n        ) : null}\r\n\r\n        {!confirmQrCode && authMethod !== \"qr\" && step === \"request\" && (\r\n          <>\r\n            <div style={glassStyle.field}>\r\n              <div style={glassStyle.label}>\r\n                <span>Номер телефона</span>\r\n                <span style={glassStyle.helper}>например, +7 999 123-45-67</span>\r\n              </div>\r\n              <div style={glassStyle.inputRow}>\r\n                <input\r\n                  style={glassStyle.input}\r\n                  inputMode=\"tel\"\r\n                  autoComplete=\"tel\"\r\n                  placeholder=\"+7 999 123-45-67\"\r\n                  value={phoneInput}\r\n                  onChange={(e) => setPhoneInput(e.target.value)}\r\n                  onKeyDown={(e) => {\r\n                    if (e.key === \"Enter\") requestCode();\r\n                  }}\r\n                  aria-label=\"Номер телефона\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={glassStyle.buttonsRow}>\r\n              <button\r\n                type=\"button\"\r\n                onClick={requestCode}\r\n                disabled={!canRequest}\r\n                style={{\r\n                  ...glassStyle.primaryBtn,\r\n                  ...(!canRequest ? glassStyle.disabled : null),\r\n                }}\r\n              >\r\n                {busy ? \"Отправляем…\" : cooldown > 0 ? `Подождите ${cooldown}с` : \"Получить код\"}\r\n              </button>\r\n            </div>\r\n\r\n            <div style={glassStyle.hintBox}>\r\n              <b>Важно:</b> Сначала откройте бота в Telegram и активируйте номер:\r\n              <br />1. Нажмите:{\" \"}\r\n              <a href=\"https://t.me/AIST_SMS_BOT\" target=\"_blank\" rel=\"noopener noreferrer\" style={{ color: theme.accent, fontWeight: 600 }}>\r\n                Открыть бота @AIST_SMS_BOT\r\n              </a>\r\n              <br />2. В боте нажмите <b>/start</b>\r\n              <br />3. Отправьте номер телефона через кнопку в боте\r\n              <br />4. Затем введите номер здесь и нажмите «Получить код»\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {!confirmQrCode && authMethod !== \"qr\" && step === \"verify\" && (\r\n          <>\r\n            {debugCode && (\r\n              <div style={{ ...glassStyle.field, padding: \"12px 16px\", borderRadius: 12, background: \"rgba(0,136,204,0.12)\", marginBottom: 8 }}>\r\n                <div style={{ fontSize: 14, color: theme.textMuted, marginBottom: 4 }}>Код для входа (только для теста)</div>\r\n                <div style={{ fontSize: 20, fontWeight: 700, letterSpacing: 4 }}>{debugCode}</div>\r\n              </div>\r\n            )}\r\n            <div style={glassStyle.field}>\r\n              <div style={glassStyle.label}>\r\n                <span>Код из Telegram</span>\r\n                <span style={glassStyle.helper}>для {formatPhone(phone)}</span>\r\n              </div>\r\n              <div style={glassStyle.agreementRow}>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"agreement\"\r\n                  checked={agreementAccepted}\r\n                  onChange={(e) => setAgreementAccepted(e.target.checked)}\r\n                  style={{ marginTop: 4, cursor: \"pointer\" }}\r\n                  aria-describedby=\"agreement-text\"\r\n                />\r\n                <label id=\"agreement-text\" htmlFor=\"agreement\" style={glassStyle.agreementLabel}>\r\n                  Я принимаю{\" \"}\r\n                  <a href={USER_AGREEMENT_URL} target=\"_blank\" rel=\"noopener noreferrer\" style={glassStyle.agreementLink}>\r\n                    пользовательское соглашение\r\n                  </a>{\" \"}\r\n                  и условия обработки персональных данных (в соответствии с законодательством РФ).\r\n                </label>\r\n              </div>\r\n              <input\r\n                ref={codeInputRef}\r\n                style={glassStyle.input}\r\n                inputMode=\"numeric\"\r\n                autoComplete=\"one-time-code\"\r\n                placeholder=\"Введите код\"\r\n                value={code}\r\n                onChange={onCodeChange}\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\") verifyCode();\r\n                }}\r\n                aria-label=\"Код подтверждения\"\r\n              />\r\n            </div>\r\n\r\n            <div style={glassStyle.buttonsRow}>\r\n              <button\r\n                type=\"button\"\r\n                onClick={verifyCode}\r\n                disabled={!canVerify}\r\n                style={{\r\n                  ...glassStyle.primaryBtn,\r\n                  ...(!canVerify ? glassStyle.disabled : null),\r\n                }}\r\n              >\r\n                {busy ? \"Проверяем…\" : \"Войти\"}\r\n              </button>\r\n\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => {\r\n                  setStep(\"request\");\r\n                  setPhoneInput(phone);\r\n                  setMessage(\"\");\r\n                }}\r\n                disabled={busy}\r\n                style={{\r\n                  ...glassStyle.secondaryBtn,\r\n                  ...(busy ? glassStyle.disabled : null),\r\n                }}\r\n              >\r\n                Изменить номер\r\n              </button>\r\n\r\n              <button\r\n                type=\"button\"\r\n                onClick={requestCode}\r\n                disabled={busy || cooldown > 0}\r\n                style={{\r\n                  ...glassStyle.secondaryBtn,\r\n                  ...(busy || cooldown > 0 ? glassStyle.disabled : null),\r\n                }}\r\n                title={cooldown > 0 ? `Повторить можно через ${cooldown}с` : \"Отправить новый код\"}\r\n              >\r\n                {cooldown > 0 ? `Повторить через ${cooldown}с` : \"Отправить ещё раз\"}\r\n              </button>\r\n            </div>\r\n\r\n            <div style={glassStyle.footer}>\r\n              <span style={glassStyle.pill}>\r\n                {maskedDestination\r\n                  ? `Доставка: ${maskedDestination}`\r\n                  : \"Доставка: @AIST_SMS_BOT\"}\r\n              </span>\r\n              <span style={glassStyle.pill}>\r\n                {remaining == null\r\n                  ? ttlSeconds\r\n                    ? `Срок: ~${ttlSeconds}с`\r\n                    : \"Срок: 5 минут\"\r\n                  : remaining > 0\r\n                    ? `Истекает через: ${remaining}с`\r\n                    : \"Код истёк — запросите новый\"}\r\n              </span>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {message ? (\r\n          <div style={glassStyle.hintBox} role=\"status\" aria-live=\"polite\">\r\n            {message}\r\n          </div>\r\n        ) : null}\r\n        <Link to=\"/\" style={glassStyle.backLink}>\r\n          ← На главную\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}